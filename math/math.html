<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Simbólica</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.5.0/math.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, select, button { margin-top: 10px; padding: 5px; }
        .output { margin-top: 20px; }
    </style>
</head>
<body>

<h2>Calculadora Simbólica</h2>

<label for="calcType">Tipo de Cálculo:</label>
<select id="calcType">
    <option value="integral">Integral</option>
    <option value="derivative">Derivada</option>
</select><br>

<label for="variableCount">Número de Variáveis:</label>
<select id="variableCount">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
</select><br>

<label for="expr">Função:</label>
<input type="text" id="expr" placeholder="Digite a função, ex: x^2 + y^2"><br>

<label for="variables">Variáveis (separadas por vírgula):</label>
<input type="text" id="variables" placeholder="Ex: x,y"><br>

<button onclick="performCalculation()">Calcular</button>

<div class="output" id="output"></div>

<div id="plot" style="width:600px;height:400px;"></div>

<script>
    function performCalculation() {
        const calcType = document.getElementById('calcType').value;
        const variableCount = parseInt(document.getElementById('variableCount').value);
        const exprInput = document.getElementById('expr').value;
        const variablesInput = document.getElementById('variables').value.split(',').slice(0, variableCount);
        
        const expr = math.parse(exprInput);
        const outputDiv = document.getElementById('output');
        outputDiv.innerHTML = '';

        if (calcType === 'integral') {
            const result = calculateIntegral(expr, variablesInput);
            outputDiv.innerHTML = `\\[ \\int ${exprInput} \\, d${variablesInput.join('')} = ${result} \\]`;
        } else if (calcType === 'derivative') {
            const result = calculateDerivative(expr, variablesInput);
            outputDiv.innerHTML = `\\[ \\frac{d}{d${variablesInput.join('}} \\left(${exprInput}\\right) = ${result} \\]`;
        }
        
        MathJax.typeset();  // Atualiza a renderização MathJax
        
        if (variablesInput.length === 1) {
            plotGraph(exprInput, variablesInput[0]);
        }
    }

    function calculateIntegral(expr, variables) {
        try {
            let result = expr.integrate(variables[0]).toString();
            for (let i = 1; i < variables.length; i++) {
                result = math.integral(result, variables[i]).toString();
            }
            return result;
        } catch (error) {
            throw new Error("Erro na integral indefinida: " + error.message);
        }
    }

    function calculateDerivative(expr, variables) {
        try {
            let result = expr.derivative(variables[0]).toString();
            for (let i = 1; i < variables.length; i++) {
                result = math.derivative(result, variables[i]).toString();
            }
            return result;
        } catch (error) {
            throw new Error("Erro na derivada: " + error.message);
        }
    }

    function plotGraph(expr, variable) {
        try {
            const xValues = [];
            const yValues = [];
            for (let x = -10; x <= 10; x += 0.1) {
                const value = math.evaluate(expr, { [variable]: x });
                xValues.push(x);
                yValues.push(value);
            }
            const trace = {
                x: xValues,
                y: yValues,
                type: 'scatter',
                mode: 'lines',
                name: 'Função'
            };
            const layout = {
                title: 'Gráfico da Função',
                xaxis: { title: variable },
                yaxis: { title: 'Valor' }
            };
            Plotly.newPlot('plot', [trace], layout);
        } catch (error) {
            throw new Error("Erro ao plotar gráfico: " + error.message);
        }
    }
</script>

</body>
</html>
