<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Avançada de Limites</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            text-align: center;
        }
        .input-area {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 8px;
            background-color: #fff;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input[type="number"], input[type="text"] {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            width: calc(100% - 18px);
        }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .input-row label {
            width: 200px;
        }
        .math-output {
            font-size: 1.2em;
            font-family: 'Courier New', Courier, monospace;
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            white-space: pre-wrap;
            margin-top: 10px;
        }
        .example {
            font-size: 0.9em;
            color: #555;
        }
        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
        }
        .fraction .numerator {
            border-bottom: 1px solid #333;
            padding: 0 4px;
            display: block;
        }
        .fraction .denominator {
            padding: 0 4px;
            display: block;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<h1>Calculadora Avançada de Limites</h1>

<div class="input-area">
    <label>Tipo de Função:</label>
    <select id="functionType" onchange="updateForm()">
        <option value="single">Função Única</option>
        <option value="fraction">Função com Fração</option>
    </select>

    <div id="variableInputs"></div>

    <div id="numeratorContainer" class="hidden">
        <label for="numerator">Função Numerador:</label>
        <input type="text" id="numerator" placeholder="Ex: 2*x1 + x2^2" oninput="updateOutput()">
    </div>

    <div id="denominatorContainer" class="hidden">
        <label for="denominator">Função Denominador:</label>
        <input type="text" id="denominator" placeholder="Ex: x1 + x2" oninput="updateOutput()">
    </div>

    <div id="singleFunctionContainer">
        <label for="singleFunction">Função Única:</label>
        <input type="text" id="singleFunction" placeholder="Ex: 2*x1 + x2^2" oninput="updateOutput()">
    </div>

    <label for="limitPoint">Ponto do Limite:</label>
    <input type="number" id="limitPoint" placeholder="Ex: 1" oninput="updateOutput()">

    <button onclick="calculateLimit()">Calcular Limite</button>
</div>

<div id="result">
    <h2>Resultado:</h2>
    <p class="math-output" id="output"></p>
    <p class="example" id="example"></p>
</div>

<script>
    function updateForm() {
        const functionType = document.getElementById('functionType').value;
        const singleFunctionContainer = document.getElementById('singleFunctionContainer');
        const numeratorContainer = document.getElementById('numeratorContainer');
        const denominatorContainer = document.getElementById('denominatorContainer');
        const variableInputs = document.getElementById('variableInputs');

        if (functionType === 'fraction') {
            singleFunctionContainer.classList.add('hidden');
            numeratorContainer.classList.remove('hidden');
            denominatorContainer.classList.remove('hidden');
        } else {
            singleFunctionContainer.classList.remove('hidden');
            numeratorContainer.classList.add('hidden');
            denominatorContainer.classList.add('hidden');
        }

        updateVariableInputs();
    }

    function updateVariableInputs() {
        const numVars = parseInt(document.getElementById('numVars').value);
        const variableInputs = document.getElementById('variableInputs');
        variableInputs.innerHTML = '';

        for (let i = 1; i <= numVars; i++) {
            const inputRow = document.createElement('div');
            inputRow.className = 'input-row';
            inputRow.innerHTML = `
                <label for="coef_${i}">Coeficiente para x${i}:</label>
                <input type="text" id="coef_${i}" placeholder="Coeficiente" oninput="updateOutput()">
            `;
            variableInputs.appendChild(inputRow);
        }

        updateOutput(); // Atualiza a saída quando o formulário muda
    }

    function updateOutput() {
        const functionType = document.getElementById('functionType').value;
        const numVars = parseInt(document.getElementById('numVars').value);
        const coefficients = [];
        for (let i = 1; i <= numVars; i++) {
            const coef = document.getElementById(`coef_${i}`).value.trim();
            coefficients.push(coef);
        }

        const limitPoint = parseFloat(document.getElementById('limitPoint').value);
        let numerator = document.getElementById('numerator')?.value || '';
        let denominator = document.getElementById('denominator')?.value || '';
        const singleFunction = document.getElementById('singleFunction')?.value || '';

        let formula;
        if (functionType === 'fraction') {
            formula = buildFraction(numerator, denominator);
        } else {
            formula = singleFunction;
        }

        if ((functionType === 'fraction' && numerator && denominator || functionType === 'single' && singleFunction) && !isNaN(limitPoint)) {
            try {
                const result = functionType === 'fraction' 
                    ? calculateFractionLimit(numerator, denominator, limitPoint) 
                    : calculateSingleLimit(singleFunction, limitPoint);
                
                document.getElementById('output').innerHTML = 
                    `O limite de <span>${formula}</span> \n` +
                    `no ponto ${limitPoint} é ${result}`;
            } catch (error) {
                document.getElementById('output').textContent = `Erro: ${error.message}`;
            }
        } else {
            document.getElementById('output').textContent = '';
        }
    }

    function buildFraction(numerator, denominator) {
        return `<div class="fraction">
                    <div class="numerator">${numerator}</div>
                    <div class="denominator">${denominator}</div>
                </div>`;
    }

    function calculateFractionLimit(numerator, denominator, limitPoint) {
        try {
            const numFunc = new Function('x', 'return ' + numerator.replace(/x(\d+)/g, 'x$1'));
            const denFunc = new Function('x', 'return ' + denominator.replace(/x(\d+)/g, 'x$1'));

            const numResult = numFunc(limitPoint);
            const denResult = denFunc(limitPoint);

            if (denResult === 0) {
                throw new Error("Denominador não pode ser zero");
            }

            return numResult / denResult;
        } catch (error) {
            throw new Error("Erro ao calcular o limite: " + error.message);
        }
    }

    function calculateSingleLimit(singleFunction, limitPoint) {
        try {
            const func = new Function('x', 'return ' + singleFunction.replace(/x(\d+)/g, 'x$1'));
            return func(limitPoint);
        } catch (error) {
            throw new Error("Erro ao calcular o limite: " + error.message);
        }
    }

    function setExample() {
        document.getElementById('functionType').value = 'fraction';
        updateForm(); // Atualiza o formulário com a opção de fração

        document.getElementById('numerator').value = "2*x1 + x2^2";
        document.getElementById('denominator').value = "x1 + x2";
        document.getElementById('limitPoint').value = "1";

        updateOutput(); // Atualiza a saída com o exemplo
    }
</script>

</body>
</html>
