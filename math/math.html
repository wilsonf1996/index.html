<!DOCTYPE html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Avançada de Derivadas e Integrais</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.5.0/math.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .input-area {
            margin-bottom: 20px;
        }
        label, input, select, button {
            display: block;
            margin-bottom: 10px;
        }
        #plot {
            margin-top: 30px;
        }
        .math-output {
            font-size: 1.2em;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h1>Calculadora Avançada de Derivadas e Integrais</h1>

<div class="input-area">
    <label for="operation">Escolha a operação:</label>
    <select id="operation" onchange="updateForm()">
        <option value="derivada">Derivada</option>
        <option value="integral">Integral</option>
    </select>

    <div id="variableSection">
        <label for="numVariables">Escolha o número de variáveis (1 a 6):</label>
        <select id="numVariables" onchange="updateVariableInputs()">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
        </select>

        <div id="variableInputs"></div>
    </div>

    <div id="integralSection" style="display: none;">
        <label for="limits">Limites (somente para integrais definidas, no formato a,b):</label>
        <input type="text" id="limits" placeholder="Ex: 0,10" oninput="updateOutput()">
    </div>

    <label for="order">Ordem (somente para derivadas):</label>
    <input type="number" id="order" value="1" min="1" max="10" oninput="updateOutput()">

    <button onclick="calculate()">Calcular</button>
</div>

<div id="result">
    <h2>Resultado:</h2>
    <p class="math-output" id="output"></p>
</div>

<div id="plot"></div>

<script>
    function updateForm() {
        const operation = document.getElementById('operation').value;
        const integralSection = document.getElementById('integralSection');

        if (operation === 'integral') {
            integralSection.style.display = 'block';
        } else {
            integralSection.style.display = 'none';
        }
        
        updateVariableInputs(); // Atualiza os campos de variáveis conforme a seleção
    }

    function updateVariableInputs() {
        const numVariables = parseInt(document.getElementById('numVariables').value, 10);
        const variableInputs = document.getElementById('variableInputs');
        variableInputs.innerHTML = ''; // Limpa entradas anteriores

        let html = '<label for="coefficients">Digite os coeficientes (separados por vírgula):</label>';
        html += '<input type="text" id="coefficients" placeholder="Ex: 1,2,3" oninput="updateOutput()">';

        variableInputs.innerHTML = html;
        updateOutput(); // Atualiza a visualização com as variáveis atuais
    }

    function updateOutput() {
        const operation = document.getElementById('operation').value;
        const numVariables = parseInt(document.getElementById('numVariables').value, 10);
        const coefficients = document.getElementById('coefficients').value.split(',').map(c => parseFloat(c.trim()));
        const order = parseInt(document.getElementById('order').value, 10);
        const limits = document.getElementById('limits').value.split(',').map(c => parseFloat(c.trim()));
        const variables = [];
        for (let i = 0; i < numVariables; i++) {
            variables.push(String.fromCharCode(120 + i)); // x, y, z, ...
        }

        let expr = '';
        for (let i = 0; i < coefficients.length; i++) {
            expr += (coefficients[i] || 1) + (variables[i] ? '*' + variables[i] : '') + (i < coefficients.length - 1 ? ' + ' : '');
        }

        let result;
        if (operation === 'integral') {
            if (limits.length === 2 && !isNaN(limits[0]) && !isNaN(limits[1])) {
                result = `\\int_{${limits[0]}}^{${limits[1]}} ${expr}`;
            } else {
                result = `\\int ${expr}`;
            }
        } else if (operation === 'derivada') {
            result = expr;
            for (let i = 0; i < numVariables; i++) {
                for (let j = 0; j < order; j++) {
                    result = math.derivative(result, variables[i]).toString();
                }
            }
            result = `\\frac{d^${order}}{d${variables[0]}^${order}} ${expr}`;
        }

        document.getElementById('output').innerHTML = `\\(${result}\\)`;
        MathJax.typeset(); // Renderiza a notação matemática
    }

    function calculate() {
        const operation = document.getElementById('operation').value;
        const numVariables = parseInt(document.getElementById('numVariables').value, 10);
        const coefficients = document.getElementById('coefficients').value.split(',').map(c => parseFloat(c.trim()));
        const order = parseInt(document.getElementById('order').value, 10);
        const limits = document.getElementById('limits').value.split(',').map(c => parseFloat(c.trim()));
        const variables = [];
        for (let i = 0; i < numVariables; i++) {
            variables.push(String.fromCharCode(120 + i)); // x, y, z, ...
        }

        let expr = '';
        for (let i = 0; i < coefficients.length; i++) {
            expr += (coefficients[i] || 1) + (variables[i] ? '*' + variables[i] : '') + (i < coefficients.length - 1 ? ' + ' : '');
        }

        let result;
        try {
            if (operation === 'integral') {
                result = calculateIntegral(expr, variables, limits);
            } else if (operation === 'derivada') {
                result = calculateDerivative(expr, variables, order);
            }

            document.getElementById('output').innerHTML = `\\(${result}\\)`;
            MathJax.typeset(); // Renderiza a notação matemática
        } catch (error) {
            document.getElementById('output').innerHTML = `Erro: ${error.message}`;
        }
    }

    function calculateIntegral(expr, variables, limits) {
        try {
            let result = expr;
            if (limits.length === 2) {
                result = `\\int_{${limits[0]}}^{${limits[1]}} ${expr}`;
            } else {
                result = expr;
                for (let i = 0; i < variables.length; i++) {
                    result = math.integral(result, variables[i]).toString();
                }
            }
            return result;
        } catch (error) {
            throw new Error("Erro na integral: " + error.message);
        }
    }

    function calculateDerivative(expr, variables, order) {
        try {
            let result = expr;
            for (let i = 0; i < variables.length; i++) {
                for (let j = 0; j < order; j++) {
                    result = math.derivative(result, variables[i]).toString();
                }
            }
            return `\\frac{d^${order}}{d${variables[0]}^${order}} ${expr}`;
        } catch (error) {
            throw new Error("Erro na derivada: " + error.message);
        }
    }
</script>

</body>
</html>
