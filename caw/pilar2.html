<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Pilar CA ‚Äì NBR 6118 (N + Mx + My + 2¬™ ordem)</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Arial, Helvetica, sans-serif;
    }
    html, body { margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #020617 0%, #020617 45%, #000 100%);
      color: #e5e7eb;
      font-size: 14px;
      line-height: 1.5;
    }
    .container {
      max-width: 1380px;
      margin: 20px auto 40px;
      padding: 22px 22px 26px;
      background: rgba(15, 23, 42, 0.97);
      border-radius: 20px;
      border: 1px solid #1f2937;
      box-shadow: 0 24px 70px rgba(0,0,0,0.9);
    }
    h1,h2,h3,h4 { margin-top: 0; font-weight: 700; letter-spacing: 0.01em; }
    h1 { text-align:center; font-size:26px; margin-bottom:4px; }
    .subtitle { text-align:center; font-size:13px; color:#9ca3af; margin-bottom:6px; }
    .credit { text-align:center; font-size:11px; color:#6b7280; margin-bottom:12px; }
    .badge {
      display:inline-flex; align-items:center; gap:6px;
      padding:3px 10px; border-radius:999px; font-size:11px;
      border:1px solid rgba(148,163,184,0.5);
      background:radial-gradient(circle at top left,#0f172a,#020617);
      color:#e5e7eb;
    }
    .badge-dot {
      width:6px;height:6px;border-radius:999px;
      background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,0.6);
    }
    .project-bar {
      display:grid;grid-template-columns:1.4fr 1.2fr 1.1fr 0.9fr;
      gap:10px;margin-bottom:14px;align-items:center;
      border-radius:16px;padding:10px 14px;
      background:radial-gradient(circle at top left,#020617,#020617 50%,#020617 100%);
      border:1px solid #111827;
    }
    .project-field label {
      display:block;font-size:11px;margin-bottom:2px;color:#e5e7eb;
    }
    .project-field input {
      width:100%;padding:5px 10px;border-radius:999px;
      border:1px solid #374151;background:#020617;color:#e5e7eb;font-size:12px;
    }
    .project-field input:focus {
      outline:none;border-color:#22c55e;
      box-shadow:0 0 0 1px #22c55e55;background:#02081b;
    }
    .layout-grid {
      display:grid;grid-template-columns:1.1fr 1.1fr 1.2fr;
      gap:16px;align-items:flex-start;
    }
    .card {
      background:radial-gradient(circle at top left,#020617,#020617 40%,#020617 100%);
      border-radius:16px;padding:12px 14px 14px;
      border:1px solid #111827;position:relative;overflow:hidden;
    }
    .card::before {
      content:"";position:absolute;inset:0;
      background:linear-gradient(135deg,
        rgba(34,197,94,0.05),
        transparent 40%,
        transparent 60%,
        rgba(59,130,246,0.04)
      );
      pointer-events:none;
    }
    .card-header {
      display:flex;align-items:center;justify-content:space-between;
      margin-bottom:6px;position:relative;z-index:1;
    }
    .card-header h2 { font-size:15px;margin:0;display:flex;align-items:center;gap:6px; }
    .card-header h2 span.icon { font-size:14px;opacity:0.9; }
    .card-subtitle {
      font-size:11px;color:#9ca3af;margin-bottom:8px;position:relative;z-index:1;
    }
    .chip {
      padding:2px 8px;border-radius:999px;font-size:10px;
      border:1px solid #374151;color:#9ca3af;background:rgba(15,23,42,0.9);
    }
    label { display:block;font-size:11px;margin-bottom:3px;color:#e5e7eb; }
    input[type="number"], select {
      width:100%;padding:6px 8px;border-radius:8px;border:1px solid #374151;
      background:#020617;color:#e5e7eb;font-size:12px;
      transition:border-color 0.1s, box-shadow 0.1s, background 0.1s;
    }
    input[type="number"]:focus, select:focus {
      outline:none;border-color:#22c55e;
      box-shadow:0 0 0 1px #22c55e55;background:#02081b;
    }
    .field { margin-bottom:8px;position:relative;z-index:1; }
    .units { font-size:10px;color:#9ca3af; }
    .two-cols { display:grid;grid-template-columns:1fr 1fr;gap:8px; }
    .three-cols { display:grid;grid-template-columns:repeat(3,1fr);gap:8px; }
    .field-group-title {
      margin:8px 0 4px;font-size:11px;text-transform:uppercase;
      letter-spacing:0.08em;color:#9ca3af;display:flex;align-items:center;gap:6px;
    }
    .field-group-title::before {
      content:"";width:10px;height:2px;border-radius:999px;
      background:linear-gradient(90deg,#22c55e,transparent);
    }
    .btn-row {
      display:flex;gap:10px;margin-top:8px;margin-bottom:6px;
      justify-content:center;flex-wrap:wrap;
    }
    button {
      border-radius:999px;border:none;padding:8px 16px;font-size:13px;
      cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:6px;
      transition:transform 0.1s,box-shadow 0.1s,background 0.15s,border-color 0.1s;
    }
    button.primary {
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#022c22;box-shadow:0 10px 26px rgba(34,197,94,0.4);
    }
    button.secondary {
      background:#020617;color:#e5e7eb;border:1px solid #374151;
    }
    button.tertiary {
      background:#020617;color:#e5e7eb;border:1px dashed #4b5563;
      font-size:12px;padding-inline:12px;
    }
    button span.icon { font-size:14px; }
    button:hover { transform:translateY(-1px);box-shadow:0 15px 32px rgba(0,0,0,0.6); }
    button:active { transform:translateY(0);box-shadow:none; }
    .results {
      margin-top:4px;border-radius:14px;background:#020617;border:1px solid #111827;
      padding:12px 14px 14px;font-size:13px;line-height:1.6;
      max-height:620px;overflow-y:auto;position:relative;
    }
    .results h3 {
      margin-top:0;font-size:15px;display:flex;align-items:center;gap:8px;
    }
    .results h3::before {
      content:"";width:5px;height:18px;border-radius:999px;
      background:linear-gradient(180deg,#22c55e,#0ea5e9);
    }
    .tag {
      display:inline-block;padding:2px 8px;border-radius:999px;
      font-size:11px;margin-left:4px;
    }
    .tag-ok { background:rgba(22,163,74,0.12);color:#4ade80;border:1px solid rgba(22,163,74,0.7); }
    .tag-warn { background:rgba(234,179,8,0.12);color:#facc15;border:1px solid rgba(234,179,8,0.7); }
    .tag-err { background:rgba(239,68,68,0.12);color:#f87171;border:1px solid rgba(239,68,68,0.7); }
    .note { font-size:11px;color:#9ca3af;margin-top:6px; }
    .section-title {
      margin-top:10px;margin-bottom:4px;font-weight:700;font-size:13px;
      display:flex;align-items:center;gap:6px;
    }
    .section-title::before {
      content:"";width:8px;height:8px;border-radius:999px;
      background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,0.6);
    }
    ul { margin-top:4px;margin-bottom:6px;padding-left:18px; }
    ul li { margin-bottom:2px; }
    .results hr {
      border:none;border-top:1px dashed #1f2937;margin:10px 0;
    }
    .result-pill-row { display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px; }
    .result-pill {
      padding:3px 9px;border-radius:999px;font-size:11px;
      background:rgba(15,23,42,0.9);border:1px solid #1f2937;color:#cbd5f5;
    }
    .result-pill strong { color:#e5e7eb; }
    .footer-credit {
      margin-top:18px;text-align:right;font-size:11px;color:#6b7280;
    }
    ::-webkit-scrollbar { width:7px; }
    ::-webkit-scrollbar-track { background:#020617;border-radius:999px; }
    ::-webkit-scrollbar-thumb { background:#111827;border-radius:999px; }
    ::-webkit-scrollbar-thumb:hover { background:#1f2937; }

    @media (max-width:1100px){
      .layout-grid{grid-template-columns:1fr 1fr;}
      .layout-grid>.card:nth-child(3){grid-column:1/-1;}
      .project-bar{grid-template-columns:1.4fr 1.2fr;}
    }
    @media (max-width:800px){
      .layout-grid{grid-template-columns:1fr;}
      .project-bar{grid-template-columns:1fr;border-radius:14px;}
    }

    @media print {
      *{box-shadow:none!important;}
      body{background:#fff;color:#000;font-size:10pt;line-height:1.4;}
      .container{box-shadow:none;border-radius:0;border:none;background:#fff;padding:10mm 8mm;}
      .project-bar{background:#fff;border-color:#000;}
      .card{border-color:#000;background:#fff;}
      .results{max-height:none;border-color:#000;}
      h1,h2,h3,h4{color:#000;}
      .subtitle,.credit{color:#000;}
      .badge,.btn-row,.chip{display:none!important;}
      .section-title::before,.results h3::before{background:#000;box-shadow:none;}
      .tag-ok,.tag-warn,.tag-err{border-color:#000;color:#000;background:#fff;}
      input,select{border:1px solid #000;background:#fff;color:#000;}
      .footer-credit{color:#000;}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Pilar de Concreto Armado ‚Äì NBR 6118</h1>
  <div class="subtitle">
    ULS (N + Mx + My, 2¬™ ordem nas duas dire√ß√µes, cisalhamento) + taxas de a√ßo e estribos.<br>
    Se√ß√£o retangular ou circular, concreto normal, armadura passiva.
  </div>
  <div class="credit">
    N√∫cleo de c√°lculo especificado por <b>Wilson Fernandes Junior</b>.
  </div>

  <div style="display:flex;justify-content:center;margin-bottom:10px;">
    <div class="badge">
      <span class="badge-dot"></span>
      N‚ÄìMx‚ÄìMy com 2¬™ ordem (Œ≥z,x / Œ≥z,y) para 1 pilar qualquer
    </div>
  </div>

  <!-- Identifica√ß√£o -->
  <div class="project-bar">
    <div class="project-field">
      <label>Nome da obra</label>
      <input type="text" id="obra" placeholder="Ex: Residencial / Galp√£o / Infraestrutura">
    </div>
    <div class="project-field">
      <label>Nome do projeto</label>
      <input type="text" id="projeto" placeholder="Ex: Estruturas ‚Äì Bloco B">
    </div>
    <div class="project-field">
      <label>Identifica√ß√£o do pilar</label>
      <input type="text" id="pilar" placeholder="Ex: P1-E1">
    </div>
    <div class="project-field">
      <label>Eng. respons√°vel / CREA</label>
      <input type="text" id="engenheiro" placeholder="Ex: Eng. Fulano ‚Äì CREA 000000-0">
    </div>
  </div>

  <div class="layout-grid">
    <!-- Coluna 1 ‚Äì Materiais & Se√ß√£o -->
    <div class="card">
      <div class="card-header">
        <h2><span class="icon">üß±</span> Materiais & Se√ß√£o</h2>
        <span class="chip">Concreto, a√ßo, geometria</span>
      </div>
      <div class="card-subtitle">
        Pilar com se√ß√£o retangular ou circular, armadura longitudinal total, estribos b√°sicos.
      </div>

      <div class="field-group-title">Materiais</div>
      <div class="two-cols">
        <div class="field">
          <label>fck (MPa)</label>
          <input type="number" id="fck" value="30" step="1">
        </div>
        <div class="field">
          <label>fyk barras (MPa)</label>
          <input type="number" id="fyk" value="500" step="10">
        </div>
        <div class="field">
          <label>fyk estribos (MPa)</label>
          <input type="number" id="fyk_st" value="500" step="10">
        </div>
        <div class="field">
          <label>Es (MPa) ‚Äì m√≥dulo do a√ßo</label>
          <input type="number" id="Es" value="210000" step="1000">
        </div>
      </div>

      <div class="field-group-title">Tipo de se√ß√£o</div>
      <div class="field">
        <label>Se√ß√£o transversal</label>
        <select id="tipo_secao">
          <option value="ret">Retangular (b √ó h)</option>
          <option value="circ">Circular (di√¢metro)</option>
        </select>
      </div>

      <div id="secao_ret" class="two-cols">
        <div class="field">
          <label>Largura b (cm)</label>
          <input type="number" id="b" value="25" step="0.5">
        </div>
        <div class="field">
          <label>Altura h (cm)</label>
          <input type="number" id="h" value="45" step="0.5">
        </div>
      </div>

      <div id="secao_circ" class="field" style="display:none;">
        <label>Di√¢metro D (cm)</label>
        <input type="number" id="D" value="35" step="0.5">
      </div>

      <div class="two-cols">
        <div class="field">
          <label>Cobrimento (cm)</label>
          <input type="number" id="cobertura" value="3" step="0.5">
        </div>
        <div class="field">
          <label>√ò barras longitudinais (mm)</label>
          <input type="number" id="phi_long" value="16" step="2">
        </div>
      </div>

      <div class="field-group-title">Armadura longitudinal global</div>
      <div class="two-cols">
        <div class="field">
          <label>As,total (cm¬≤) ‚Äì soma de todas as barras</label>
          <input type="number" id="As_tot" value="12.0" step="0.1">
        </div>
        <div class="field">
          <label>N¬∫ de barras longitudinais</label>
          <input type="number" id="n_barras" value="8" step="1">
        </div>
      </div>

      <div class="field-group-title">Estribos</div>
      <div class="two-cols">
        <div class="field">
          <label>√ò estribo (mm)</label>
          <input type="number" id="phi_stirrup" value="6.3" step="0.1">
        </div>
        <div class="field">
          <label>s (cm) ‚Äì espa√ßamento adotado</label>
          <input type="number" id="s_st" value="10" step="0.5">
        </div>
      </div>

      <div class="note">
        Suposi√ß√£o: armadura distribu√≠da aproximadamente sim√©trica, metade ‚Äútracionada‚Äù e metade ‚Äúcomprimida‚Äù em cada dire√ß√£o.
      </div>
    </div>

    <!-- Coluna 2 ‚Äì Esfor√ßos, comprimentos, 2¬™ ordem -->
    <div class="card">
      <div class="card-header">
        <h2><span class="icon">‚öôÔ∏è</span> Esfor√ßos & 2¬™ Ordem (X/Y)</h2>
        <span class="chip">N + Mx + My + Œ≥z,x / Œ≥z,y</span>
      </div>
      <div class="card-subtitle">
        Nsd, Msd em duas dire√ß√µes, Vsd, comprimentos equivalentes e fatores de engastamento.
      </div>

      <div class="field-group-title">ULS ‚Äì Esfor√ßos de c√°lculo (primeira ordem)</div>
      <div class="two-cols">
        <div class="field">
          <label>Nsd (kN) ‚Äì compress√£o positiva</label>
          <input type="number" id="Nsd" value="1200" step="10">
        </div>
        <div class="field">
          <label>Vsd (kN) ‚Äì cortante</label>
          <input type="number" id="Vsd" value="50" step="1">
        </div>
        <div class="field">
          <label>Msd,x (kN¬∑m)</label>
          <input type="number" id="Msdx" value="80" step="1">
          <span class="units">Momento em torno do eixo X (normal a h, tra√ß√£o numa face).</span>
        </div>
        <div class="field">
          <label>Msd,y (kN¬∑m)</label>
          <input type="number" id="Msdy" value="40" step="1">
          <span class="units">Momento em torno do eixo Y (normal a b, outra dire√ß√£o principal).</span>
        </div>
      </div>

      <div class="field-group-title">Comprimentos equivalentes e engastamentos</div>
      <div class="two-cols">
        <div class="field">
          <label>L (m) ‚Äì altura real do pilar</label>
          <input type="number" id="L" value="3.0" step="0.1">
        </div>
        <div class="field">
          <label>Tipo de quadro (global)</label>
          <select id="tipo_quadro">
            <option value="n√£o-deslocavel">N√£o-desloc√°vel</option>
            <option value="deslocavel">Desloc√°vel</option>
          </select>
        </div>
      </div>

      <div class="field-group-title">Fatores kx / ky (condi√ß√µes de apoio)</div>
      <div class="two-cols">
        <div class="field">
          <label>k<sub>x</sub> ‚Äì fator de comprimento em X</label>
          <select id="kx_sel">
            <option value="0.7">Engastado‚ÄìEngastado (‚âà0,7)</option>
            <option value="0.85">Engastado‚ÄìRotulado (‚âà0,85)</option>
            <option value="1.0" selected>Rotulado‚ÄìRotulado (‚âà1,0)</option>
            <option value="2.0">Engastado‚ÄìLivre (‚âà2,0)</option>
          </select>
          <span class="units">Pode editar o valor num√©rico abaixo se quiser algo fora da tabela.</span>
        </div>
        <div class="field">
          <label>k<sub>x</sub> num√©rico</label>
          <input type="number" id="kx" value="1.0" step="0.05">
        </div>
        <div class="field">
          <label>k<sub>y</sub> ‚Äì fator de comprimento em Y</label>
          <select id="ky_sel">
            <option value="0.7">Engastado‚ÄìEngastado (‚âà0,7)</option>
            <option value="0.85">Engastado‚ÄìRotulado (‚âà0,85)</option>
            <option value="1.0" selected>Rotulado‚ÄìRotulado (‚âà1,0)</option>
            <option value="2.0">Engastado‚ÄìLivre (‚âà2,0)</option>
          </select>
        </div>
        <div class="field">
          <label>k<sub>y</sub> num√©rico</label>
          <input type="number" id="ky" value="1.0" step="0.05">
        </div>
      </div>

      <div class="field-group-title">Servi√ßo (para excentricidades / checagem r√°pida)</div>
      <div class="two-cols">
        <div class="field">
          <label>Nser (kN)</label>
          <input type="number" id="Nser" value="900" step="10">
        </div>
        <div class="field">
          <label>Mser,x (kN¬∑m)</label>
          <input type="number" id="Mserx" value="60" step="1">
        </div>
        <div class="field">
          <label>Mser,y (kN¬∑m)</label>
          <input type="number" id="Msery" value="30" step="1">
        </div>
      </div>

      <div class="note">
        2¬™ ordem em cada dire√ß√£o: Œ≥z,x e Œ≥z,y ‚âà 1/(1 ‚àí Nsd/Ncr,x) e 1/(1 ‚àí Nsd/Ncr,y),
        limitados conforme tipo de quadro. Msd,2,x = Œ≥z,x¬∑Msd,x, Msd,2,y = Œ≥z,y¬∑Msd,y.  
        Intera√ß√£o biaxial: Mx,2/MRx + My,2/MRy ‚â§ 1 (Bresler).
      </div>
    </div>

    <!-- Coluna 3 ‚Äì Resultados -->
    <div class="card">
      <div class="card-header">
        <h2><span class="icon">üìä</span> Resultados</h2>
        <span class="chip">N‚ÄìMx‚ÄìMy + Œ≥z,x / Œ≥z,y</span>
      </div>

      <div class="btn-row">
        <button class="primary" onclick="calcular()">
          <span class="icon">‚öôÔ∏è</span> Calcular
        </button>
        <button class="secondary" onclick="limparResultados()">
          <span class="icon">üßπ</span> Limpar
        </button>
        <button class="tertiary" onclick="window.print()">
          <span class="icon">üßæ</span> Gerar PDF
        </button>
        <button class="tertiary" onclick="exportarTXT()">
          <span class="icon">üìÑ</span> Exportar TXT
        </button>
      </div>

      <div class="results" id="resultados">
        <h3>Resultados aparecer√£o aqui‚Ä¶</h3>
        <p class="note">
          Preencha materiais, se√ß√£o, armaduras, esfor√ßos (N, Mx, My, V) e comprimentos (L, kx, ky) e clique em <b>Calcular</b>.  
          Use <b>Gerar PDF</b> (print em PDF) e <b>Exportar TXT</b> para relat√≥rio t√©cnico em texto.
        </p>
      </div>
    </div>
  </div>

  <div class="footer-credit">
    App de pilares em concreto armado ‚Äì n√∫cleo especificado por <b>Wilson Fernandes Junior</b>.
  </div>
</div>

<script>
  let lastReportTxt = "";

  function format(n, dec = 2) {
    if (isNaN(n) || !isFinite(n)) return "-";
    return n.toLocaleString("pt-BR", {
      minimumFractionDigits: dec,
      maximumFractionDigits: dec
    });
  }

  function limparResultados() {
    document.getElementById("resultados").innerHTML = `
      <h3>Resultados aparecer√£o aqui‚Ä¶</h3>
      <p class="note">
        Preencha dados de identifica√ß√£o, materiais, se√ß√£o, esfor√ßos e comprimentos e clique em <b>Calcular</b>.
      </p>
    `;
    lastReportTxt = "";
  }

  // troca visual da se√ß√£o
  document.addEventListener("DOMContentLoaded", () => {
    const tipo = document.getElementById("tipo_secao");
    tipo.addEventListener("change", () => {
      const val = tipo.value;
      document.getElementById("secao_ret").style.display = (val === "ret") ? "grid" : "none";
      document.getElementById("secao_circ").style.display = (val === "circ") ? "block" : "none";
    });

    // sincronizar seletores kx/ky com campos num√©ricos
    document.getElementById("kx_sel").addEventListener("change", e => {
      document.getElementById("kx").value = e.target.value;
    });
    document.getElementById("ky_sel").addEventListener("change", e => {
      document.getElementById("ky").value = e.target.value;
    });
  });

  function rhoMinPilar() { return 0.004; } // 0,4%
  function rhoMaxPilar() { return 0.08; }  // 8%

  // Equil√≠brio N -> x e Mrd, para se√ß√£o ret/circ aproximada, uniaxial
  function calc_Mrd_uniaxial(Nsd_N, b_mm, d_mm, dLinha_mm, fcd, fyd, x_lim_ratio, As_tot_mm2) {
    const As_t = As_tot_mm2 / 2;
    const As_c = As_tot_mm2 / 2;
    const maxIter = 60;
    const tol = 1e-6;
    const x_max = x_lim_ratio * d_mm;
    let a = 1e-6;
    let c = x_max;

    function f(x) {
      const Cc = 0.68 * fcd * b_mm * x;
      const Cs = As_c * fyd;
      const T  = As_t * fyd;
      const Nres = Cc + Cs - T;
      return Nres - Nsd_N;
    }

    let fa = f(a);
    let fc = f(c);
    if (fa * fc > 0) return null;

    let x = 0;
    for (let i = 0; i < maxIter; i++) {
      x = 0.5*(a+c);
      const fx = f(x);
      if (Math.abs(fx) < tol) break;
      if (fa*fx < 0){ c = x; fc = fx; } else { a = x; fa = fx; }
    }

    const Cc_N = 0.68 * fcd * b_mm * x;
    const Cs_N = As_c * fyd;
    const T_N  = As_t * fyd;

    const yC = 0.4 * x;
    const yS = dLinha_mm;
    const yT = d_mm;

    const N_int = Cc_N + Cs_N - T_N;
    const Mrd_Nmm = Cc_N*yC + Cs_N*yS - T_N*yT;
    const errN = Math.abs(N_int - Nsd_N)/Math.max(Math.abs(Nsd_N),1e-3)*100;

    return {
      x_mm: x,
      Cc_N, Cs_N, T_N,
      N_int,
      Mrd_Nmm,
      errN
    };
  }

  function calcular() {
    const fck = parseFloat(document.getElementById("fck").value);
    const fyk = parseFloat(document.getElementById("fyk").value);
    const fyk_st = parseFloat(document.getElementById("fyk_st").value);
    const Es = parseFloat(document.getElementById("Es").value);
    const tipo_secao = document.getElementById("tipo_secao").value;

    const b_cm = parseFloat(document.getElementById("b").value || "0");
    const h_cm = parseFloat(document.getElementById("h").value || "0");
    const D_cm = parseFloat(document.getElementById("D").value || "0");
    const cob_cm = parseFloat(document.getElementById("cobertura").value);
    const phi_long = parseFloat(document.getElementById("phi_long").value);
    const As_tot_cm2 = parseFloat(document.getElementById("As_tot").value);
    const n_barras = parseInt(document.getElementById("n_barras").value,10);
    const phi_st = parseFloat(document.getElementById("phi_stirrup").value);
    const s_st_cm = parseFloat(document.getElementById("s_st").value);

    const Nsd_kN = parseFloat(document.getElementById("Nsd").value);
    const Vsd_kN = parseFloat(document.getElementById("Vsd").value);
    const Msdx_kNm = parseFloat(document.getElementById("Msdx").value);
    const Msdy_kNm = parseFloat(document.getElementById("Msdy").value);
    const L_m = parseFloat(document.getElementById("L").value);
    const tipo_quadro = document.getElementById("tipo_quadro").value;
    const kx = parseFloat(document.getElementById("kx").value);
    const ky = parseFloat(document.getElementById("ky").value);

    const Nser_kN = parseFloat(document.getElementById("Nser").value);
    const Mserx_kNm = parseFloat(document.getElementById("Mserx").value);
    const Msery_kNm = parseFloat(document.getElementById("Msery").value);

    const obra = document.getElementById("obra").value || "-";
    const projeto = document.getElementById("projeto").value || "-";
    const pilarID = document.getElementById("pilar").value || "-";
    const engenheiro = document.getElementById("engenheiro").value || "-";

    const resDiv = document.getElementById("resultados");

    if (
      [fck,fyk,fyk_st,Es,cob_cm,phi_long,As_tot_cm2,n_barras,
       Nsd_kN,Msdx_kNm,Msdy_kNm,L_m,kx,ky].some(v => isNaN(v) || v <= 0)
    ) {
      resDiv.innerHTML = `
        <h3>Erro de entrada</h3>
        <p class="note">Verifique se todos os campos principais (materiais, se√ß√£o, armadura, N, Mx, My, L, kx, ky) est√£o preenchidos com valores v√°lidos.</p>
      `;
      lastReportTxt = "";
      return;
    }
    if (Nsd_kN <= 0) {
      resDiv.innerHTML = `
        <h3>Erro ‚Äì Nsd</h3>
        <p class="note">O modelo considera apenas pilar em compress√£o (Nsd &gt; 0). Verifique o sinal da for√ßa normal.</p>
      `;
      lastReportTxt = "";
      return;
    }

    const cob_mm = cob_cm*10;
    const phi_long_mm = phi_long;

    let b_mm, h_mm, D_mm, tipoDesc;
    if (tipo_secao === "ret") {
      if (b_cm<=0 || h_cm<=0) {
        resDiv.innerHTML = `<h3>Erro na se√ß√£o retangular</h3><p class="note">b e h devem ser &gt; 0.</p>`;
        lastReportTxt = "";
        return;
      }
      b_mm = b_cm*10;
      h_mm = h_cm*10;
      D_mm = null;
      tipoDesc = `Retangular ${format(b_cm,1)} √ó ${format(h_cm,1)} cm`;
    } else {
      if (D_cm<=0) {
        resDiv.innerHTML = `<h3>Erro na se√ß√£o circular</h3><p class="note">Di√¢metro deve ser &gt; 0.</p>`;
        lastReportTxt = "";
        return;
      }
      D_mm = D_cm*10;
      b_mm = D_mm;
      h_mm = D_mm;
      tipoDesc = `Circular D = ${format(D_cm,1)} cm`;
    }

    const d_mm = h_mm - cob_mm - phi_long_mm/2;
    const dLinha_mm = cob_mm + phi_long_mm/2;
    if (d_mm <= 0) {
      resDiv.innerHTML = `<h3>Geometria inv√°lida</h3><p class="note">d ficou negativo ou muito pequeno. Verifique h, cobrimento e di√¢metro das barras.</p>`;
      lastReportTxt = "";
      return;
    }

    const gamma_c = 1.4;
    const gamma_s = 1.15;
    const alpha_cc = 0.85;

    const fcd = alpha_cc * fck / gamma_c;
    const fyd = fyk / gamma_s;
    const fydw_lim = 435;
    const fydw = Math.min(fyk_st / gamma_s, fydw_lim);

    const fctm = 0.3 * Math.pow(fck,2.0/3.0);
    const fctk_inf = 0.7*fctm;
    const fctd = fctk_inf/gamma_c;

    const Nsd_N = Nsd_kN*1e3;
    const Vsd_N = Vsd_kN*1e3;
    const Msdx_Nmm = Msdx_kNm*1e6;
    const Msdy_Nmm = Msdy_kNm*1e6;

    let Ac_mm2, Ix_m4, Iy_m4;
    if (tipo_secao === "ret") {
      Ac_mm2 = b_mm*h_mm;
      const b_m = b_mm/1000, h_m = h_mm/1000;
      Ix_m4 = b_m*Math.pow(h_m,3)/12;
      Iy_m4 = h_m*Math.pow(b_m,3)/12;
    } else {
      Ac_mm2 = Math.PI*Math.pow(D_mm,2)/4;
      const D_m = D_mm/1000;
      const I_m4 = Math.PI*Math.pow(D_m,4)/64;
      Ix_m4 = I_m4;
      Iy_m4 = I_m4;
    }

    const As_tot_mm2 = As_tot_cm2*100;
    const rho = As_tot_mm2/Ac_mm2;
    const rho_min = rhoMinPilar();
    const rho_max = rhoMaxPilar();
    let taxaTag = "";
    if (rho < rho_min-1e-6){
      taxaTag = `<span class="tag tag-err">œÅ &lt; œÅm√≠n (0,4% para pilares)</span>`;
    } else if (rho > rho_max+1e-6){
      taxaTag = `<span class="tag tag-err">œÅ &gt; œÅm√°x (8% para pilares)</span>`;
    } else {
      taxaTag = `<span class="tag tag-ok">Taxa de armadura dentro de 0,4%‚Äì8%</span>`;
    }

    const x_lim_ratio = 0.45;
    const x_lim_mm = x_lim_ratio*d_mm;

    // Mrd uniaxial em X (eixo normal √† h, usando profundidade h)
    const Mx_res = calc_Mrd_uniaxial(Nsd_N, b_mm, d_mm, dLinha_mm, fcd, fyd, x_lim_ratio, As_tot_mm2);
    if (!Mx_res || Mx_res.x_mm<=0 || Mx_res.x_mm>x_lim_mm) {
      resDiv.innerHTML = `
        <h3>Falha no equil√≠brio N‚ÄìMx</h3>
        <p class="note">Com a se√ß√£o e armadura informadas, n√£o foi poss√≠vel equilibrar Nsd em flexo-compress√£o uniaxial em X com x/d ‚â§ ${format(x_lim_ratio,2)}.</p>
      `;
      lastReportTxt = "";
      return;
    }

    // Para My: se retangular, considerar profundidade ‚âà b, largura ‚âà h; se circular, igual
    let d_y_mm, dLinha_y_mm, bw_y_mm;
    if (tipo_secao === "ret") {
      // trocamos papel de b e h para eixo Y
      bw_y_mm = h_mm;
      d_y_mm = b_mm - cob_mm - phi_long_mm/2;
      dLinha_y_mm = cob_mm + phi_long_mm/2;
    } else {
      bw_y_mm = b_mm;
      d_y_mm = d_mm;
      dLinha_y_mm = dLinha_mm;
    }
    const My_res = calc_Mrd_uniaxial(Nsd_N, bw_y_mm, d_y_mm, dLinha_y_mm, fcd, fyd, x_lim_ratio, As_tot_mm2);
    if (!My_res || My_res.x_mm<=0 || My_res.x_mm> x_lim_ratio*d_y_mm) {
      resDiv.innerHTML = `
        <h3>Falha no equil√≠brio N‚ÄìMy</h3>
        <p class="note">Com a se√ß√£o e armadura informadas, n√£o foi poss√≠vel equilibrar Nsd em flexo-compress√£o uniaxial em Y com x/d ‚â§ ${format(x_lim_ratio,2)}.</p>
      `;
      lastReportTxt = "";
      return;
    }

    const x_mm = Mx_res.x_mm; // adotamos x do eixo X como refer√™ncia para deforma√ß√µes
    const x_d = x_mm/d_mm;

    const eps_cu = 0.0035;
    const eps_c = eps_cu;
    const eps_y = fyd/Es;
    const eps_s = (eps_c*(d_mm - x_mm))/x_mm;
    const eps_s_comp = (eps_c*(x_mm - dLinha_mm))/x_mm;
    const status_eps_s = (eps_s >= eps_y) ? "a√ßo tracionado no escoamento" : "a√ßo tracionado abaixo do escoamento";
    const status_eps_s_comp = (eps_s_comp >= eps_y) ? "a√ßo comprimido no escoamento" : "a√ßo comprimido abaixo do escoamento";

    let dominio_msg = "";
    if (x_d <= 0.259) dominio_msg = "Dom√≠nio 2 (flexo-compress√£o moderada).";
    else if (x_d <= 0.628) dominio_msg = "Dom√≠nio 3.";
    else dominio_msg = "Dom√≠nio 4 (n√£o desej√°vel).";

    let dominio_tag = "";
    if (x_d <= x_lim_ratio+1e-4){
      dominio_tag = `<span class="tag tag-ok">x/d ‚â§ ${format(x_lim_ratio,2)} (ductilidade m√≠nima atendida)</span>`;
    } else {
      dominio_tag = `<span class="tag tag-err">x/d &gt; limite de ductilidade adotado</span>`;
    }

    const Eci = 5600*Math.sqrt(fck);
    const Ec = 0.85*Eci;
    const Lx_m = kx*L_m;
    const Ly_m = ky*L_m;

    const Ncrx_kN = Math.PI*Math.PI*Ec*Ix_m4/(Lx_m*Lx_m)/1e3;
    const Ncry_kN = Math.PI*Math.PI*Ec*Iy_m4/(Ly_m*Ly_m)/1e3;

    let gamma_zx = 1.0, gamma_zy = 1.0;
    let gammaTagX="", gammaTagY="";
    let gamma_max = (tipo_quadro === "deslocavel") ? 1.4 : 1.3;

    if (Ncrx_kN > 0) {
      gamma_zx = 1/(1 - Nsd_kN/Ncrx_kN);
      if (gamma_zx<1) gamma_zx = 1;
      if (gamma_zx>gamma_max) gamma_zx = gamma_max;
      gammaTagX = (gamma_zx>1) ? `<span class="tag tag-warn">2¬™ ordem em X (Œ≥z,x ‚âà ${format(gamma_zx,2)})</span>`
                               : `<span class="tag tag-ok">2¬™ ordem pequena em X (Œ≥z,x ‚âà 1,0)</span>`;
    } else {
      gammaTagX = `<span class="tag tag-err">Ncr,x n√£o definido (verifique dados).</span>`;
    }

    if (Ncry_kN > 0) {
      gamma_zy = 1/(1 - Nsd_kN/Ncry_kN);
      if (gamma_zy<1) gamma_zy = 1;
      if (gamma_zy>gamma_max) gamma_zy = gamma_max;
      gammaTagY = (gamma_zy>1) ? `<span class="tag tag-warn">2¬™ ordem em Y (Œ≥z,y ‚âà ${format(gamma_zy,2)})</span>`
                               : `<span class="tag tag-ok">2¬™ ordem pequena em Y (Œ≥z,y ‚âà 1,0)</span>`;
    } else {
      gammaTagY = `<span class="tag tag-err">Ncr,y n√£o definido (verifique dados).</span>`;
    }

    const Msdx2_Nmm = gamma_zx*Msdx_Nmm;
    const Msdy2_Nmm = gamma_zy*Msdy_Nmm;

    const Mrdx_Nmm = Mx_res.Mrd_Nmm;
    const Mrdy_Nmm = My_res.Mrd_Nmm;
    const FS_Mx_1 = Mrdx_Nmm/Msdx_Nmm;
    const FS_Mx_2 = Mrdx_Nmm/Msdx2_Nmm;
    const FS_My_1 = Mrdy_Nmm/Msdy_Nmm;
    const FS_My_2 = Mrdy_Nmm/Msdy2_Nmm;

    const biax_ratio = (Msdx2_Nmm/Mrdx_Nmm) + (Msdy2_Nmm/Mrdy_Nmm);
    const FS_biax = 1/biax_ratio;
    let biax_tag = "";
    if (biax_ratio <= 1) {
      biax_tag = `<span class="tag tag-ok">Intera√ß√£o biaxial atendida (Mx,2/MRx + My,2/MRy ‚â§ 1)</span>`;
    } else {
      biax_tag = `<span class="tag tag-err">Intera√ß√£o biaxial ULTRA-solicitada (Mx,2/MRx + My,2/MRy &gt; 1)</span>`;
    }

    const e1x_cm = Msdx_kNm/Nsd_kN*100;
    const e1y_cm = Msdy_kNm/Nsd_kN*100;
    const e0x_cm = Mserx_kNm/Math.max(Nser_kN,1e-3)*100;
    const e0y_cm = Msery_kNm/Math.max(Nser_kN,1e-3)*100;
    const e_min_geom_x_cm = Math.max(h_cm/30, b_cm/30, 2);
    const e_min_geom_y_cm = Math.max(b_cm/30, h_cm/30, 2);
    const e_min_norm_x_cm = Math.max(e_min_geom_x_cm, 2);
    const e_min_norm_y_cm = Math.max(e_min_geom_y_cm, 2);

    const alpha_v2 = 1.0 - fck/250.0;
    const VRd2_N = 0.27*alpha_v2*fcd*b_mm*d_mm;
    const Vc0_N = 0.6*fctd*b_mm*d_mm;
    const vEd_MPa = Vsd_N/(b_mm*d_mm);
    const vRd2_MPa = VRd2_N/(b_mm*d_mm);
    const FS_V = VRd2_N/Math.max(Vsd_N,1e-3);

    let cis_tag="", cis_msg="";
    if (Vsd_N <= 1e-3) {
      cis_tag = `<span class="tag tag-ok">Vsd ‚âà 0 (cisalhamento irrelevante)</span>`;
      cis_msg = "Sem esfor√ßo cortante significativo informado.";
    } else if (Vsd_N > VRd2_N) {
      cis_tag = `<span class="tag tag-err">Vsd &gt; VRd2 (compress√£o diagonal n√£o verificada)</span>`;
      cis_msg = "Rever se√ß√£o / fck ou modelo resistente para cisalhamento.";
    } else {
      cis_tag = `<span class="tag tag-ok">Vsd ‚â§ VRd2 (cisalhamento ok)</span>`;
      cis_msg = "VRd2 suficiente para o Vsd informado.";
    }

    const s_st_mm = s_st_cm*10;
    const s_lim1_mm = 16*phi_long_mm;
    const s_lim2_mm = 48*phi_st;
    const s_lim3_mm = h_mm;
    const s_lim4_mm = 200;
    const s_lim_mm = Math.min(s_lim1_mm,s_lim2_mm,s_lim3_mm,s_lim4_mm);
    let estriboTag="";
    if (s_st_mm <= s_lim_mm+1e-6){
      estriboTag = `<span class="tag tag-ok">Espa√ßamento de estribos dentro dos limites usuais (‚â§ ${format(s_lim_mm/10,1)} cm)</span>`;
    } else {
      estriboTag = `<span class="tag tag-err">s adotado &gt; limites t√≠picos de estribos (m√°x ‚âà ${format(s_lim_mm/10,1)} cm)</span>`;
    }

    let avisoNorma = "";
    if (fck<20 || fck>50) avisoNorma += "‚Ä¢ fck fora da faixa t√≠pica (20‚Äì50 MPa).\n";
    if (fyk<400 || fyk>650) avisoNorma += "‚Ä¢ fyk barras fora da faixa usual CA-25/50/60.\n";
    if (fyk_st<400 || fyk_st>650) avisoNorma += "‚Ä¢ fyk estribos fora da faixa usual.\n";

    const lambda_x = (Lx_m*1000)/Math.sqrt(Ix_m4*1e12/Ac_mm2);
    const lambda_y = (Ly_m*1000)/Math.sqrt(Iy_m4*1e12/Ac_mm2);

    const resultPills = `
      <div class="result-pill-row">
        <div class="result-pill">Nsd: <strong>${format(Nsd_kN,1)}</strong> kN</div>
        <div class="result-pill">Mx,1¬™: <strong>${format(Msdx_kNm,1)}</strong> kN¬∑m</div>
        <div class="result-pill">My,1¬™: <strong>${format(Msdy_kNm,1)}</strong> kN¬∑m</div>
        <div class="result-pill">Mx,2¬™: <strong>${format(Msdx2_Nmm/1e6,2)}</strong> kN¬∑m</div>
        <div class="result-pill">My,2¬™: <strong>${format(Msdy2_Nmm/1e6,2)}</strong> kN¬∑m</div>
        <div class="result-pill">FS_biax: <strong>${format(FS_biax,2)}</strong></div>
        <div class="result-pill">Œªx: <strong>${format(lambda_x,1)}</strong></div>
        <div class="result-pill">Œªy: <strong>${format(lambda_y,1)}</strong></div>
      </div>
    `;

    document.getElementById("resultados").innerHTML = `
      <h3>Resumo dos resultados</h3>
      ${resultPills}

      <p class="section-title">Identifica√ß√£o</p>
      <ul>
        <li><b>Obra:</b> ${obra}</li>
        <li><b>Projeto:</b> ${projeto}</li>
        <li><b>Pilar:</b> ${pilarID}</li>
        <li><b>Eng. respons√°vel / CREA:</b> ${engenheiro}</li>
      </ul>

      <p class="section-title">Se√ß√£o e materiais</p>
      <ul>
        <li>Se√ß√£o: <strong>${tipoDesc}</strong></li>
        <li>fck = <strong>${format(fck,0)}</strong> MPa, fyk barras = <strong>${format(fyk,0)}</strong> MPa, fyk estribos = <strong>${format(fyk_st,0)}</strong> MPa</li>
        <li>Cobrimento = <strong>${format(cob_cm,2)}</strong> cm, √ò barras long. = <strong>${format(phi_long_mm,1)}</strong> mm</li>
        <li>d ‚âà <strong>${format(d_mm/10,2)}</strong> cm, d' ‚âà <strong>${format(dLinha_mm/10,2)}</strong> cm</li>
        <li>fcd = <strong>${format(fcd,2)}</strong> MPa, fyd = <strong>${format(fyd,2)}</strong> MPa, fydw ‚âà <strong>${format(fydw,2)}</strong> MPa</li>
      </ul>

      <p class="section-title">Armadura longitudinal</p>
      ${taxaTag}
      <ul>
        <li>As,total = <strong>${format(As_tot_mm2,1)}</strong> mm¬≤ = <strong>${format(As_tot_cm2,2)}</strong> cm¬≤</li>
        <li>œÅ = As/Ac ‚âà <strong>${format(rho*100,3)}</strong> %</li>
        <li>œÅm√≠n (pilar) ‚âà <strong>${format(rho_min*100,3)}</strong> % ‚Üí As,m√≠n ‚âà <strong>${format(rho_min*Ac_mm2,1)}</strong> mm¬≤</li>
        <li>œÅm√°x (pilar) ‚âà <strong>${format(rho_max*100,3)}</strong> % ‚Üí As,m√°x ‚âà <strong>${format(rho_max*Ac_mm2,1)}</strong> mm¬≤</li>
        <li>N¬∫ de barras longitudinais: <strong>${n_barras}</strong></li>
      </ul>

      <h4>1) ULS ‚Äì Flexo-Compress√£o Uniaxial em X e Y (N + Mx, N + My)</h4>
      ${dominio_tag}
      <ul>
        <li>Nsd = <strong>${format(Nsd_kN,1)}</strong> kN</li>
        <li>Msd,x (1¬™) = <strong>${format(Msdx_kNm,1)}</strong> kN¬∑m, Mrd,x ‚âà <strong>${format(Mrdx_Nmm/1e6,2)}</strong> kN¬∑m</li>
        <li>Msd,y (1¬™) = <strong>${format(Msdy_kNm,1)}</strong> kN¬∑m, Mrd,y ‚âà <strong>${format(Mrdy_Nmm/1e6,2)}</strong> kN¬∑m</li>
        <li>FS_Mx (1¬™) ‚âà <strong>${format(FS_Mx_1,2)}</strong>, FS_My (1¬™) ‚âà <strong>${format(FS_My_1,2)}</strong></li>
        <li>x ‚âà <strong>${format(x_mm,2)}</strong> mm ‚áí x/d ‚âà <strong>${format(x_d,3)}</strong></li>
      </ul>
      <p class="note">Dom√≠nio aproximado: ${dominio_msg}</p>

      <p class="section-title">Deforma√ß√µes no ELU</p>
      <ul>
        <li>Œµc topo ‚âà <strong>${format(eps_c*1000,3)}</strong> ‚Ä∞</li>
        <li>Œµs tra√ß√£o ‚âà <strong>${format(eps_s*1000,3)}</strong> ‚Ä∞, Œµy ‚âà <strong>${format(eps_y*1000,3)}</strong> ‚Ä∞ ‚Üí ${status_eps_s}</li>
        <li>Œµs' compress√£o ‚âà <strong>${format(eps_s_comp*1000,3)}</strong> ‚Ä∞ ‚Üí ${status_eps_s_comp}</li>
      </ul>

      <h4>2) 2¬™ Ordem em X e Y (Œ≥z,x / Œ≥z,y)</h4>
      ${gammaTagX} ${gammaTagY}
      <ul>
        <li>L = <strong>${format(L_m,2)}</strong> m, kx = <strong>${format(kx,2)}</strong>, ky = <strong>${format(ky,2)}</strong></li>
        <li>‚Ñì0,x = kx¬∑L ‚âà <strong>${format(Lx_m,2)}</strong> m, ‚Ñì0,y = ky¬∑L ‚âà <strong>${format(Ly_m,2)}</strong> m</li>
        <li>Ncr,x ‚âà <strong>${format(Ncrx_kN,1)}</strong> kN, Ncr,y ‚âà <strong>${format(Ncry_kN,1)}</strong> kN</li>
        <li>Œ≥z,x ‚âà <strong>${format(gamma_zx,2)}</strong>, Œ≥z,y ‚âà <strong>${format(gamma_zy,2)}</strong></li>
        <li>Msd,x (2¬™) = Œ≥z,x¬∑Msd,x ‚âà <strong>${format(Msdx2_Nmm/1e6,2)}</strong> kN¬∑m</li>
        <li>Msd,y (2¬™) = Œ≥z,y¬∑Msd,y ‚âà <strong>${format(Msdy2_Nmm/1e6,2)}</strong> kN¬∑m</li>
        <li>FS_Mx (2¬™) ‚âà <strong>${format(FS_Mx_2,2)}</strong>, FS_My (2¬™) ‚âà <strong>${format(FS_My_2,2)}</strong></li>
      </ul>

      <h4>3) Intera√ß√£o Biaxial N‚ÄìMx‚ÄìMy (Bresler)</h4>
      ${biax_tag}
      <ul>
        <li>Raz√£o biaxial: Mx,2/MRx + My,2/MRy ‚âà <strong>${format(biax_ratio,3)}</strong></li>
        <li>FS_biax ‚âà <strong>${format(FS_biax,2)}</strong></li>
      </ul>

      <h4>4) Excentricidades (ELS ‚Äì coer√™ncia de modelo)</h4>
      <ul>
        <li>e1x = Msd,x/Nsd ‚âà <strong>${format(e1x_cm,2)}</strong> cm, e1y ‚âà <strong>${format(e1y_cm,2)}</strong> cm</li>
        <li>e0x,ser = Mser,x/Nser ‚âà <strong>${format(e0x_cm,2)}</strong> cm, e0y,ser ‚âà <strong>${format(e0y_cm,2)}</strong> cm</li>
        <li>e_min geom,x ‚âà <strong>${format(e_min_geom_x_cm,2)}</strong> cm, e_min geom,y ‚âà <strong>${format(e_min_geom_y_cm,2)}</strong> cm</li>
        <li>e_min normativa (aprox.) x ‚âà <strong>${format(e_min_norm_x_cm,2)}</strong> cm, y ‚âà <strong>${format(e_min_norm_y_cm,2)}</strong> cm</li>
      </ul>

      <hr>

      <h4>5) Cisalhamento (VRd2 x Vsd)</h4>
      ${cis_tag}
      <ul>
        <li>Vsd = <strong>${format(Vsd_kN,1)}</strong> kN</li>
        <li>VRd2 ‚âà <strong>${format(VRd2_N/1e3,2)}</strong> kN, Vc0 ‚âà <strong>${format(Vc0_N/1e3,2)}</strong> kN</li>
        <li>ŒΩEd ‚âà <strong>${format(vEd_MPa,3)}</strong> MPa, ŒΩRd2 ‚âà <strong>${format(vRd2_MPa,3)}</strong> MPa</li>
        <li>FS_V = VRd2 / Vsd ‚âà <strong>${format(FS_V,2)}</strong></li>
        <li>${cis_msg}</li>
      </ul>

      <h4>6) Detalhamento ‚Äì Estribos (regras aproximadas)</h4>
      ${estriboTag}
      <ul>
        <li>√ò estribo = <strong>${format(phi_st,1)}</strong> mm, s adotado = <strong>${format(s_st_cm,1)}</strong> cm</li>
        <li>Limites t√≠picos:
          <ul>
            <li>s ‚â§ 16¬∑√òlong ‚Üí ${format(s_lim1_mm/10,1)} cm</li>
            <li>s ‚â§ 48¬∑√òestribo ‚Üí ${format(s_lim2_mm/10,1)} cm</li>
            <li>s ‚â§ h (se√ß√£o) ‚Üí ${format(s_lim3_mm/10,1)} cm</li>
            <li>s ‚â§ 20 cm</li>
          </ul>
        </li>
        <li>s_lim adotado ‚âà <strong>${format(s_lim_mm/10,1)}</strong> cm</li>
      </ul>

      <hr>
      <p class="note">
        Modelo avan√ßado para <b>1 pilar</b> com N + Mx + My, 2¬™ ordem global nas duas dire√ß√µes e intera√ß√£o biaxial via Bresler.
        Para an√°lises de p√≥rtico completo, pilares muito esbeltos e diagramas de intera√ß√£o refinados (N‚ÄìMx‚ÄìMy 3D),
        ainda √© recomend√°vel um software dedicado (TQS, Cype, etc.), mas este n√∫cleo j√° cobre boa parte dos checks normativos de um pilar isolado.
      </p>
      ${
        avisoNorma
          ? `<p class="note"><b>Observa√ß√µes de validade:</b><br>${avisoNorma.replace(/\n/g,"<br>")}</p>`
          : ""
      }
    `;

    // -------- TXT --------
    let txt = "";
    txt += "============================================================\n";
    txt += "RELAT√ìRIO DE PILAR DE CONCRETO ARMADO - NBR 6118\n";
    txt += "============================================================\n\n";
    txt += "IDENTIFICA√á√ÉO\n";
    txt += "  Obra   : " + obra + "\n";
    txt += "  Projeto: " + projeto + "\n";
    txt += "  Pilar  : " + pilarID + "\n";
    txt += "  Eng. resp. / CREA: " + engenheiro + "\n\n";
    txt += "  N√∫cleo de c√°lculo especificado por: Wilson Fernandes Junior\n\n";

    txt += "SE√á√ÉO E MATERIAIS\n";
    txt += "  Se√ß√£o              : " + tipoDesc + "\n";
    txt += "  fck                : " + format(fck,0) + " MPa\n";
    txt += "  fyk barras         : " + format(fyk,0) + " MPa\n";
    txt += "  fyk estribos       : " + format(fyk_st,0) + " MPa\n";
    txt += "  Es                 : " + format(Es,0) + " MPa\n";
    txt += "  Cobrimento         : " + format(cob_cm,2) + " cm\n";
    txt += "  √ò barras long.     : " + format(phi_long_mm,1) + " mm\n";
    txt += "  d                  : " + format(d_mm/10,2) + " cm\n";
    txt += "  d'                 : " + format(dLinha_mm/10,2) + " cm\n";
    txt += "  fcd                : " + format(fcd,2) + " MPa\n";
    txt += "  fyd                : " + format(fyd,2) + " MPa\n";
    txt += "  fydw               : " + format(fydw,2) + " MPa\n";
    txt += "  fctm               : " + format(fctm,2) + " MPa\n";
    txt += "  fctd               : " + format(fctd,2) + " MPa\n\n";

    txt += "ARMADURA LONGITUDINAL\n";
    txt += "  As,total           : " + format(As_tot_mm2,1) + " mm¬≤ (" + format(As_tot_cm2,2) + " cm¬≤)\n";
    txt += "  N¬∫ de barras       : " + n_barras + "\n";
    txt += "  œÅ (As/Ac)          : " + format(rho*100,3) + " %\n";
    txt += "  œÅm√≠n (pilar)       : " + format(rho_min*100,3) + " %\n";
    txt += "  œÅm√°x (pilar)       : " + format(rho_max*100,3) + " %\n\n";

    txt += "ESFOR√áOS ULTIMOS (ELU)\n";
    txt += "  Nsd                : " + format(Nsd_kN,1) + " kN\n";
    txt += "  Msd,x              : " + format(Msdx_kNm,1) + " kN¬∑m\n";
    txt += "  Msd,y              : " + format(Msdy_kNm,1) + " kN¬∑m\n";
    txt += "  Vsd                : " + format(Vsd_kN,1) + " kN\n\n";

    txt += "EQUIL√çBRIO UNIAXIAL (X e Y)\n";
    txt += "  x/d                : " + format(x_d,3) + "\n";
    txt += "  Mrd,x              : " + format(Mrdx_Nmm/1e6,2) + " kN¬∑m\n";
    txt += "  Mrd,y              : " + format(Mrdy_Nmm/1e6,2) + " kN¬∑m\n";
    txt += "  FS_Mx (1¬™ ordem)   : " + format(FS_Mx_1,2) + "\n";
    txt += "  FS_My (1¬™ ordem)   : " + format(FS_My_1,2) + "\n\n";

    txt += "DEFORMA√á√ïES NO ELU\n";
    txt += "  Œµc topo            : " + format(eps_c*1000,3) + " ‚Ä∞\n";
    txt += "  Œµs tra√ß√£o          : " + format(eps_s*1000,3) + " ‚Ä∞ (" + status_eps_s + ")\n";
    txt += "  Œµs' compress√£o     : " + format(eps_s_comp*1000,3) + " ‚Ä∞ (" + status_eps_s_comp + ")\n";
    txt += "  Dom√≠nio (aprox.)   : " + dominio_msg + "\n\n";

    txt += "2¬™ ORDEM EM X E Y (Œ≥z,x / Œ≥z,y)\n";
    txt += "  L                  : " + format(L_m,2) + " m\n";
    txt += "  kx                 : " + format(kx,2) + "\n";
    txt += "  ky                 : " + format(ky,2) + "\n";
    txt += "  ‚Ñì0,x               : " + format(Lx_m,2) + " m\n";
    txt += "  ‚Ñì0,y               : " + format(Ly_m,2) + " m\n";
    txt += "  Ncr,x              : " + format(Ncrx_kN,1) + " kN\n";
    txt += "  Ncr,y              : " + format(Ncry_kN,1) + " kN\n";
    txt += "  Œ≥z,x               : " + format(gamma_zx,2) + "\n";
    txt += "  Œ≥z,y               : " + format(gamma_zy,2) + "\n";
    txt += "  Msd,x (2¬™)         : " + format(Msdx2_Nmm/1e6,2) + " kN¬∑m\n";
    txt += "  Msd,y (2¬™)         : " + format(Msdy2_Nmm/1e6,2) + " kN¬∑m\n";
    txt += "  FS_Mx (2¬™)         : " + format(FS_Mx_2,2) + "\n";
    txt += "  FS_My (2¬™)         : " + format(FS_My_2,2) + "\n\n";

    txt += "INTERA√á√ÉO BIAXIAL (BRESLER)\n";
    txt += "  Soma (Mx,2/MRx + My,2/MRy) : " + format(biax_ratio,3) + "\n";
    txt += "  FS_biax            : " + format(FS_biax,2) + "\n\n";

    txt += "EXCENTRICIDADES (SERVI√áO)\n";
    txt += "  Nser               : " + format(Nser_kN,1) + " kN\n";
    txt += "  Mser,x             : " + format(Mserx_kNm,1) + " kN¬∑m\n";
    txt += "  Mser,y             : " + format(Msery_kNm,1) + " kN¬∑m\n";
    txt += "  e1x (ELU)          : " + format(e1x_cm,2) + " cm\n";
    txt += "  e1y (ELU)          : " + format(e1y_cm,2) + " cm\n";
    txt += "  e0x (servi√ßo)      : " + format(e0x_cm,2) + " cm\n";
    txt += "  e0y (servi√ßo)      : " + format(e0y_cm,2) + " cm\n";
    txt += "  e_min geom,x       : " + format(e_min_geom_x_cm,2) + " cm\n";
    txt += "  e_min geom,y       : " + format(e_min_geom_y_cm,2) + " cm\n";
    txt += "  e_min normativa x  : " + format(e_min_norm_x_cm,2) + " cm\n";
    txt += "  e_min normativa y  : " + format(e_min_norm_y_cm,2) + " cm\n\n";

    txt += "CISALHAMENTO (VRd2 x Vsd)\n";
    txt += "  Vsd                : " + format(Vsd_kN,1) + " kN\n";
    txt += "  VRd2               : " + format(VRd2_N/1e3,2) + " kN\n";
    txt += "  Vc0                : " + format(Vc0_N/1e3,2) + " kN\n";
    txt += "  ŒΩEd                : " + format(vEd_MPa,3) + " MPa\n";
    txt += "  ŒΩRd2               : " + format(vRd2_MPa,3) + " MPa\n";
    txt += "  FS_V               : " + format(FS_V,2) + "\n\n";

    txt += "ESTRIBOS (REGRAS APROXIMADAS)\n";
    txt += "  √ò estribo          : " + format(phi_st,1) + " mm\n";
    txt += "  s adotado          : " + format(s_st_cm,2) + " cm\n";
    txt += "  Limites t√≠picos:\n";
    txt += "    s ‚â§ 16¬∑√òlong     : " + format(s_lim1_mm/10,2) + " cm\n";
    txt += "    s ‚â§ 48¬∑√òestribo  : " + format(s_lim2_mm/10,2) + " cm\n";
    txt += "    s ‚â§ h (se√ß√£o)    : " + format(s_lim3_mm/10,2) + " cm\n";
    txt += "    s ‚â§ 20 cm\n";
    txt += "  s_lim adotado      : " + format(s_lim_mm/10,2) + " cm\n\n";

    if (avisoNorma) {
      txt += "OBSERVA√á√ïES DE VALIDADE NORMATIVA\n";
      txt += avisoNorma;
    }

    txt += "============================================================\n";
    txt += "FIM DO RELAT√ìRIO ‚Äì N√∫cleo especificado por Wilson Fernandes Junior\n";
    txt += "============================================================\n";

    lastReportTxt = txt;
  }

  function exportarTXT() {
    if (!lastReportTxt || lastReportTxt.trim()==="") {
      alert("Primeiro realize um c√°lculo para gerar o relat√≥rio em TXT.");
      return;
    }
    const blob = new Blob([lastReportTxt],{type:"text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    const nomeObra = (document.getElementById("obra").value || "obra").replace(/[^a-z0-9_\-]+/gi,"_");
    const nomePilar = (document.getElementById("pilar").value || "pilar").replace(/[^a-z0-9_\-]+/gi,"_");
    a.href = url;
    a.download = `Relatorio_Pilar_${nomeObra}_${nomePilar}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>
</body>
</html>
