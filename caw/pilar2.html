<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Pilar CA â€“ NBR 6118 (N+Mx+My, 2Âª ordem, fluÃªncia, As por face)</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Arial, Helvetica, sans-serif;
    }
    html, body { margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #020617 0%, #020617 45%, #000 100%);
      color: #e5e7eb;
      font-size: 14px;
      line-height: 1.5;
    }
    .container {
      max-width: 1380px;
      margin: 20px auto 40px;
      padding: 22px 22px 26px;
      background: rgba(15, 23, 42, 0.97);
      border-radius: 20px;
      border: 1px solid #1f2937;
      box-shadow: 0 24px 70px rgba(0,0,0,0.9);
    }
    h1,h2,h3,h4 { margin-top: 0; font-weight: 700; letter-spacing: 0.01em; }
    h1 { text-align:center; font-size:26px; margin-bottom:4px; }
    .subtitle { text-align:center; font-size:13px; color:#9ca3af; margin-bottom:6px; }
    .credit { text-align:center; font-size:11px; color:#6b7280; margin-bottom:12px; }
    .badge {
      display:inline-flex; align-items:center; gap:6px;
      padding:3px 10px; border-radius:999px; font-size:11px;
      border:1px solid rgba(148,163,184,0.5);
      background:radial-gradient(circle at top left,#0f172a,#020617);
      color:#e5e7eb;
    }
    .badge-dot {
      width:6px;height:6px;border-radius:999px;
      background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,0.6);
    }
    .project-bar {
      display:grid;grid-template-columns:1.4fr 1.2fr 1.1fr 0.9fr;
      gap:10px;margin-bottom:14px;align-items:center;
      border-radius:16px;padding:10px 14px;
      background:radial-gradient(circle at top left,#020617,#020617 50%,#020617 100%);
      border:1px solid #111827;
    }
    .project-field label {
      display:block;font-size:11px;margin-bottom:2px;color:#e5e7eb;
    }
    .project-field input {
      width:100%;padding:5px 10px;border-radius:999px;
      border:1px solid #374151;background:#020617;color:#e5e7eb;font-size:12px;
    }
    .project-field input:focus {
      outline:none;border-color:#22c55e;
      box-shadow:0 0 0 1px #22c55e55;background:#02081b;
    }
    .layout-grid {
      display:grid;grid-template-columns:1.1fr 1.1fr 1.2fr;
      gap:16px;align-items:flex-start;
    }
    .card {
      background:radial-gradient(circle at top left,#020617,#020617 40%,#020617 100%);
      border-radius:16px;padding:12px 14px 14px;
      border:1px solid #111827;position:relative;overflow:hidden;
    }
    .card::before {
      content:"";position:absolute;inset:0;
      background:linear-gradient(135deg,
        rgba(34,197,94,0.05),
        transparent 40%,
        transparent 60%,
        rgba(59,130,246,0.04)
      );
      pointer-events:none;
    }
    .card-header {
      display:flex;align-items:center;justify-content:space-between;
      margin-bottom:6px;position:relative;z-index:1;
    }
    .card-header h2 { font-size:15px;margin:0;display:flex;align-items:center;gap:6px; }
    .card-header h2 span.icon { font-size:14px;opacity:0.9; }
    .card-subtitle {
      font-size:11px;color:#9ca3af;margin-bottom:8px;position:relative;z-index:1;
    }
    .chip {
      padding:2px 8px;border-radius:999px;font-size:10px;
      border:1px solid #374151;color:#9ca3af;background:rgba(15,23,42,0.9);
    }
    label { display:block;font-size:11px;margin-bottom:3px;color:#e5e7eb; }
    input[type="number"], select {
      width:100%;padding:6px 8px;border-radius:8px;border:1px solid #374151;
      background:#020617;color:#e5e7eb;font-size:12px;
      transition:border-color 0.1s, box-shadow 0.1s, background 0.1s;
    }
    input[type="number"]:focus, select:focus {
      outline:none;border-color:#22c55e;
      box-shadow:0 0 0 1px #22c55e55;background:#02081b;
    }
    .field { margin-bottom:8px;position:relative;z-index:1; }
    .units { font-size:10px;color:#9ca3af; }
    .two-cols { display:grid;grid-template-columns:1fr 1fr;gap:8px; }
    .three-cols { display:grid;grid-template-columns:repeat(3,1fr);gap:8px; }
    .field-group-title {
      margin:8px 0 4px;font-size:11px;text-transform:uppercase;
      letter-spacing:0.08em;color:#9ca3af;display:flex;align-items:center;gap:6px;
    }
    .field-group-title::before {
      content:"";width:10px;height:2px;border-radius:999px;
      background:linear-gradient(90deg,#22c55e,transparent);
    }
    .btn-row {
      display:flex;gap:10px;margin-top:8px;margin-bottom:6px;
      justify-content:center;flex-wrap:wrap;
    }
    button {
      border-radius:999px;border:none;padding:8px 16px;font-size:13px;
      cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:6px;
      transition:transform 0.1s,box-shadow 0.1s,background 0.15s,border-color 0.1s;
    }
    button.primary {
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#022c22;box-shadow:0 10px 26px rgba(34,197,94,0.4);
    }
    button.secondary {
      background:#020617;color:#e5e7eb;border:1px solid #374151;
    }
    button.tertiary {
      background:#020617;color:#e5e7eb;border:1px dashed #4b5563;
      font-size:12px;padding-inline:12px;
    }
    button span.icon { font-size:14px; }
    button:hover { transform:translateY(-1px);box-shadow:0 15px 32px rgba(0,0,0,0.6); }
    button:active { transform:translateY(0);box-shadow:none; }
    .results {
      margin-top:4px;border-radius:14px;background:#020617;border:1px solid #111827;
      padding:12px 14px 14px;font-size:13px;line-height:1.6;
      max-height:620px;overflow-y:auto;position:relative;
    }
    .results h3 {
      margin-top:0;font-size:15px;display:flex;align-items:center;gap:8px;
    }
    .results h3::before {
      content:"";width:5px;height:18px;border-radius:999px;
      background:linear-gradient(180deg,#22c55e,#0ea5e9);
    }
    .tag {
      display:inline-block;padding:2px 8px;border-radius:999px;
      font-size:11px;margin-left:4px;
    }
    .tag-ok { background:rgba(22,163,74,0.12);color:#4ade80;border:1px solid rgba(22,163,74,0.7); }
    .tag-warn { background:rgba(234,179,8,0.12);color:#facc15;border:1px solid rgba(234,179,8,0.7); }
    .tag-err { background:rgba(239,68,68,0.12);color:#f87171;border:1px solid rgba(239,68,68,0.7); }
    .note { font-size:11px;color:#9ca3af;margin-top:6px; }
    .section-title {
      margin-top:10px;margin-bottom:4px;font-weight:700;font-size:13px;
      display:flex;align-items:center;gap:6px;
    }
    .section-title::before {
      content:"";width:8px;height:8px;border-radius:999px;
      background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,0.6);
    }
    ul { margin-top:4px;margin-bottom:6px;padding-left:18px; }
    ul li { margin-bottom:2px; }
    .results hr {
      border:none;border-top:1px dashed #1f2937;margin:10px 0;
    }
    .result-pill-row { display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px; }
    .result-pill {
      padding:3px 9px;border-radius:999px;font-size:11px;
      background:rgba(15,23,42,0.9);border:1px solid #1f2937;color:#cbd5f5;
    }
    .result-pill strong { color:#e5e7eb; }
    .footer-credit {
      margin-top:18px;text-align:right;font-size:11px;color:#6b7280;
    }
    ::-webkit-scrollbar { width:7px; }
    ::-webkit-scrollbar-track { background:#020617;border-radius:999px; }
    ::-webkit-scrollbar-thumb { background:#111827;border-radius:999px; }
    ::-webkit-scrollbar-thumb:hover { background:#1f2937; }

    @media (max-width:1100px){
      .layout-grid{grid-template-columns:1fr 1fr;}
      .layout-grid>.card:nth-child(3){grid-column:1/-1;}
      .project-bar{grid-template-columns:1.4fr 1.2fr;}
    }
    @media (max-width:800px){
      .layout-grid{grid-template-columns:1fr;}
      .project-bar{grid-template-columns:1fr;border-radius:14px;}
    }

    @media print {
      *{box-shadow:none!important;}
      body{background:#fff;color:#000;font-size:10pt;line-height:1.4;}
      .container{box-shadow:none;border-radius:0;border:none;background:#fff;padding:10mm 8mm;}
      .project-bar{background:#fff;border-color:#000;}
      .card{border-color:#000;background:#fff;}
      .results{max-height:none;border-color:#000;}
      h1,h2,h3,h4{color:#000;}
      .subtitle,.credit{color:#000;}
      .badge,.btn-row,.chip{display:none!important;}
      .section-title::before,.results h3::before{background:#000;box-shadow:none;}
      .tag-ok,.tag-warn,.tag-err{border-color:#000;color:#000;background:#fff;}
      input,select{border:1px solid #000;background:#fff;color:#000;}
      .footer-credit{color:#000;}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Pilar de Concreto Armado â€“ NBR 6118</h1>
  <div class="subtitle">
    ULS (N + Mx + My, 2Âª ordem global + local com fluÃªncia) + taxas de aÃ§o, cisalhamento e estribos.<br>
    SeÃ§Ã£o retangular ou circular, As por face, armadura passiva.
  </div>
  <div class="credit">
    NÃºcleo de cÃ¡lculo especificado por <b>Wilson Fernandes Junior</b>. Modo de cÃ¡lculo: <b>somente verificaÃ§Ã£o</b> (As informada).
  </div>

  <div style="display:flex;justify-content:center;margin-bottom:10px;">
    <div class="badge">
      <span class="badge-dot"></span>
      Nâ€“Mxâ€“My, 2Âª ordem global/local, Esbeltez Î» calibrada para quadro deslocÃ¡vel/nÃ£o
    </div>
  </div>

  <!-- IdentificaÃ§Ã£o -->
  <div class="project-bar">
    <div class="project-field">
      <label>Nome da obra</label>
      <input type="text" id="obra" placeholder="Ex: Residencial / GalpÃ£o / Infraestrutura">
    </div>
    <div class="project-field">
      <label>Nome do projeto</label>
      <input type="text" id="projeto" placeholder="Ex: Estruturas â€“ Bloco B">
    </div>
    <div class="project-field">
      <label>IdentificaÃ§Ã£o do pilar</label>
      <input type="text" id="pilar" placeholder="Ex: P1-E1">
    </div>
    <div class="project-field">
      <label>Eng. responsÃ¡vel / CREA</label>
      <input type="text" id="engenheiro" placeholder="Ex: Eng. Fulano â€“ CREA 000000-0">
    </div>
  </div>

  <div class="layout-grid">
    <!-- Coluna 1 â€“ Materiais & SeÃ§Ã£o -->
    <div class="card">
      <div class="card-header">
        <h2><span class="icon">ğŸ§±</span> Materiais & SeÃ§Ã£o</h2>
        <span class="chip">Concreto, aÃ§o, geometria</span>
      </div>
      <div class="card-subtitle">
        SeÃ§Ã£o retangular ou circular, com armadura longitudinal por face e estribos bÃ¡sicos.
      </div>

      <div class="field-group-title">Materiais</div>
      <div class="two-cols">
        <div class="field">
          <label>fck (MPa)</label>
          <input type="number" id="fck" value="30" step="1">
        </div>
        <div class="field">
          <label>fyk barras (MPa)</label>
          <input type="number" id="fyk" value="500" step="10">
        </div>
        <div class="field">
          <label>fyk estribos (MPa)</label>
          <input type="number" id="fyk_st" value="500" step="10">
        </div>
        <div class="field">
          <label>Es (MPa) â€“ mÃ³dulo do aÃ§o</label>
          <input type="number" id="Es" value="210000" step="1000">
        </div>
      </div>

      <div class="field-group-title">Tipo de seÃ§Ã£o</div>
      <div class="field">
        <label>SeÃ§Ã£o transversal</label>
        <select id="tipo_secao">
          <option value="ret">Retangular (b Ã— h)</option>
          <option value="circ">Circular (diÃ¢metro)</option>
        </select>
      </div>

      <div id="secao_ret" class="two-cols">
        <div class="field">
          <label>Largura b (cm)</label>
          <input type="number" id="b" value="25" step="0.5">
        </div>
        <div class="field">
          <label>Altura h (cm)</label>
          <input type="number" id="h" value="45" step="0.5">
        </div>
      </div>

      <div id="secao_circ" class="field" style="display:none;">
        <label>DiÃ¢metro D (cm)</label>
        <input type="number" id="D" value="35" step="0.5">
      </div>

      <div class="two-cols">
        <div class="field">
          <label>Cobrimento (cm)</label>
          <input type="number" id="cobertura" value="3" step="0.5">
        </div>
        <div class="field">
          <label>Ã˜ barras longitudinais (mm)</label>
          <input type="number" id="phi_long" value="16" step="2">
        </div>
      </div>

      <div class="field-group-title">Armadura longitudinal global</div>
      <div class="two-cols">
        <div class="field">
          <label>As,total (cmÂ²) â€“ referÃªncia global</label>
          <input type="number" id="As_tot" value="12.0" step="0.1">
        </div>
        <div class="field">
          <label>NÂº total de barras</label>
          <input type="number" id="n_barras" value="8" step="1">
        </div>
      </div>

      <div class="field-group-title">Armadura por face (cmÂ²) â€“ assimÃ©trica</div>
      <div class="two-cols">
        <div class="field">
          <label>As inferior (face tracionada em +Mx)</label>
          <input type="number" id="As_inf" value="0" step="0.1">
        </div>
        <div class="field">
          <label>As superior (face comprimida em +Mx)</label>
          <input type="number" id="As_sup" value="0" step="0.1">
        </div>
        <div class="field">
          <label>As direita (face tracionada em +My)</label>
          <input type="number" id="As_dir" value="0" step="0.1">
        </div>
        <div class="field">
          <label>As esquerda (face comprimida em +My)</label>
          <input type="number" id="As_esq" value="0" step="0.1">
        </div>
      </div>
      <div class="note">
        Se todas as As por face forem 0, o app assume As,total distribuÃ­da aproximadamente simÃ©trica  
        (metade traÃ§Ã£o + metade compressÃ£o em cada direÃ§Ã£o). Aqui o modo Ã© <b>somente verificaÃ§Ã£o</b>: vocÃª define As, ele sÃ³ calcula Mrd e FS.
      </div>

      <div class="field-group-title">Estribos</div>
      <div class="two-cols">
        <div class="field">
          <label>Ã˜ estribo (mm)</label>
          <input type="number" id="phi_stirrup" value="6.3" step="0.1">
        </div>
        <div class="field">
          <label>s (cm) â€“ espaÃ§amento adotado</label>
          <input type="number" id="s_st" value="10" step="0.5">
        </div>
      </div>
    </div>

    <!-- Coluna 2 â€“ EsforÃ§os, 2Âª ordem global/local, esbeltez -->
    <div class="card">
      <div class="card-header">
        <h2><span class="icon">âš™ï¸</span> EsforÃ§os & 2Âª Ordem (Global / Local)</h2>
        <span class="chip">N + Mx + My, Î³z,x / Î³z,y, Ec,eff</span>
      </div>
      <div class="card-subtitle">
        N, Mx, My, V, comprimentos equivalentes, frame deslocÃ¡vel/nÃ£o, fluÃªncia e inÃ©rcia fissurada.
      </div>

      <div class="field-group-title">Modo de cÃ¡lculo</div>
      <div class="field">
        <label>Modo</label>
        <select id="modo_calc">
          <option value="verificacao">Somente verificaÃ§Ã£o (As informada, calcula FS em Nâ€“Mxâ€“My)</option>
        </select>
        <span class="units">O app <b>nÃ£o dimensiona As automaticamente</b> nesta versÃ£o, apenas verifica.</span>
      </div>

      <div class="field-group-title">ULS â€“ EsforÃ§os de cÃ¡lculo (primeira ordem)</div>
      <div class="two-cols">
        <div class="field">
          <label>Nsd (kN) â€“ compressÃ£o positiva</label>
          <input type="number" id="Nsd" value="1200" step="10">
        </div>
        <div class="field">
          <label>Vsd (kN) â€“ cortante</label>
          <input type="number" id="Vsd" value="50" step="1">
        </div>
        <div class="field">
          <label>Msd,x (kNÂ·m)</label>
          <input type="number" id="Msdx" value="80" step="1">
          <span class="units">Momento em torno de X (traciona a face <b>inferior</b> se positivo).</span>
        </div>
        <div class="field">
          <label>Msd,y (kNÂ·m)</label>
          <input type="number" id="Msdy" value="40" step="1">
          <span class="units">Momento em torno de Y (traciona a face <b>direita</b> se positivo).</span>
        </div>
      </div>

      <div class="field-group-title">Comprimentos e quadro (2Âª ordem global)</div>
      <div class="two-cols">
        <div class="field">
          <label>L (m) â€“ altura real do pilar</label>
          <input type="number" id="L" value="3.0" step="0.1">
        </div>
        <div class="field">
          <label>Tipo de quadro (global)</label>
          <select id="tipo_quadro">
            <option value="nÃ£o-deslocavel">NÃ£o-deslocÃ¡vel (pÃ³rtico travado â€“ braced)</option>
            <option value="deslocavel">DeslocÃ¡vel (pÃ³rtico sem travamento rÃ­gido)</option>
          </select>
        </div>
      </div>

      <div class="field-group-title">Fatores kx / ky (condiÃ§Ãµes de apoio)</div>
      <div class="two-cols">
        <div class="field">
          <label>k<sub>x</sub> â€“ fator de comprimento em X</label>
          <select id="kx_sel">
            <option value="0.7">Engastadoâ€“Engastado (â‰ˆ0,7)</option>
            <option value="0.85">Engastadoâ€“Rotulado (â‰ˆ0,85)</option>
            <option value="1.0" selected>Rotuladoâ€“Rotulado (â‰ˆ1,0)</option>
            <option value="2.0">Engastadoâ€“Livre (â‰ˆ2,0)</option>
          </select>
          <span class="units">Altere o numÃ©rico abaixo se quiser outro valor.</span>
        </div>
        <div class="field">
          <label>k<sub>x</sub> numÃ©rico</label>
          <input type="number" id="kx" value="1.0" step="0.05">
        </div>
        <div class="field">
          <label>k<sub>y</sub> â€“ fator de comprimento em Y</label>
          <select id="ky_sel">
            <option value="0.7">Engastadoâ€“Engastado (â‰ˆ0,7)</option>
            <option value="0.85">Engastadoâ€“Rotulado (â‰ˆ0,85)</option>
            <option value="1.0" selected>Rotuladoâ€“Rotulado (â‰ˆ1,0)</option>
            <option value="2.0">Engastadoâ€“Livre (â‰ˆ2,0)</option>
          </select>
        </div>
        <div class="field">
          <label>k<sub>y</sub> numÃ©rico</label>
          <input type="number" id="ky" value="1.0" step="0.05">
        </div>
      </div>

      <div class="field-group-title">ServiÃ§o â€“ para excentricidades</div>
      <div class="two-cols">
        <div class="field">
          <label>Nser (kN)</label>
          <input type="number" id="Nser" value="900" step="10">
        </div>
        <div class="field">
          <label>Mser,x (kNÂ·m)</label>
          <input type="number" id="Mserx" value="60" step="1">
        </div>
        <div class="field">
          <label>Mser,y (kNÂ·m)</label>
          <input type="number" id="Msery" value="30" step="1">
        </div>
      </div>

      <div class="field-group-title">AvanÃ§ado â€“ Pilar esbelto, fluÃªncia, 2Âª ordem local</div>
      <div class="two-cols">
        <div class="field">
          <label>Ï† â€“ coef. de fluÃªncia (adimensional)</label>
          <input type="number" id="phi_creep" value="2.0" step="0.1">
          <span class="units">Ec,eff = Ec / (1 + Ï†) â€“ efeito de longo prazo.</span>
        </div>
        <div class="field">
          <label>Îµ<sub>sh</sub> â€“ retraÃ§Ã£o (â€°)</label>
          <input type="number" id="eps_sh" value="0.3" step="0.05">
          <span class="units">Apenas reportado; intensidade tÃ­pica 0,2â€“0,4 â€°.</span>
        </div>
        <div class="field">
          <label>Î±<sub>I,eff</sub> â€“ fator de inÃ©rcia fissurada</label>
          <input type="number" id="alpha_I" value="0.5" step="0.05">
          <span class="units">Ieff = Î±Â·I (0,3â€“0,7; padrÃ£o 0,5).</span>
        </div>
        <div class="field">
          <label>Uso do modelo local</label>
          <select id="modo_local">
            <option value="auto">AutomÃ¡tico (sÃ³ se pilar esbelto â€“ Î» &gt; limite NBR)</option>
            <option value="forcar">ForÃ§ar 2Âª ordem local em ambos os eixos</option>
            <option value="off">Desligar 2Âª ordem local (sÃ³ Î³z global)</option>
          </select>
        </div>
      </div>

      <div class="note">
        2Âª ordem global: Î³z,x, Î³z,y com Ec e I.  
        2Âª ordem local: Ec,eff = Ec/(1+Ï†) e Ieff = Î±Â·I â‡’ Ncr,loc,x e Ncr,loc,y,  
        gerando amplificadores Î³loc,x e Î³loc,y. Momento total â‰ˆ MsdÂ·Î³zÂ·Î³loc.  
        Limites de esbeltez Î» calibrados conforme tipo de quadro (valores usuais da NBR para ignorar 2Âª ordem).
      </div>
    </div>

    <!-- Coluna 3 â€“ Resultados -->
    <div class="card">
      <div class="card-header">
        <h2><span class="icon">ğŸ“Š</span> Resultados</h2>
        <span class="chip">Nâ€“Mxâ€“My, 2Âª global/local, Î», VRd2, estribos</span>
      </div>

      <div class="btn-row">
        <button class="primary" onclick="calcular()">
          <span class="icon">âš™ï¸</span> Calcular
        </button>
        <button class="secondary" onclick="limparResultados()">
          <span class="icon">ğŸ§¹</span> Limpar
        </button>
        <button class="tertiary" onclick="window.print()">
          <span class="icon">ğŸ§¾</span> Gerar PDF
        </button>
        <button class="tertiary" onclick="exportarTXT()">
          <span class="icon">ğŸ“„</span> Exportar TXT
        </button>
      </div>

      <div class="results" id="resultados">
        <h3>Resultados aparecerÃ£o aquiâ€¦</h3>
        <p class="note">
          Preencha materiais, seÃ§Ã£o (incluindo As por face, se quiser assimetria), esforÃ§os (N, Mx, My, V),  
          comprimentos (L, kx, ky) e parÃ¢metros de fluÃªncia / inÃ©rcia fissurada e clique em <b>Calcular</b>.  
          Modo atual: <b>somente verificaÃ§Ã£o</b> â€“ o app nÃ£o dimensiona As, apenas verifica FS em Nâ€“Mxâ€“My.
        </p>
      </div>
    </div>
  </div>

  <div class="footer-credit">
    App de pilares em concreto armado â€“ nÃºcleo especificado por <b>Wilson Fernandes Junior</b>.
  </div>
</div>

<script>
  let lastReportTxt = "";

  function format(n, dec = 2) {
    if (isNaN(n) || !isFinite(n)) return "-";
    return n.toLocaleString("pt-BR", {
      minimumFractionDigits: dec,
      maximumFractionDigits: dec
    });
  }

  function limparResultados() {
    document.getElementById("resultados").innerHTML = `
      <h3>Resultados aparecerÃ£o aquiâ€¦</h3>
      <p class="note">
        Preencha dados de identificaÃ§Ã£o, materiais, seÃ§Ã£o, esforÃ§os e comprimentos e clique em <b>Calcular</b>.
      </p>
    `;
    lastReportTxt = "";
  }

  document.addEventListener("DOMContentLoaded", () => {
    const tipo = document.getElementById("tipo_secao");
    tipo.addEventListener("change", () => {
      const val = tipo.value;
      document.getElementById("secao_ret").style.display = (val === "ret") ? "grid" : "none";
      document.getElementById("secao_circ").style.display = (val === "circ") ? "block" : "none";
    });
    document.getElementById("kx_sel").addEventListener("change", e => {
      document.getElementById("kx").value = e.target.value;
    });
    document.getElementById("ky_sel").addEventListener("change", e => {
      document.getElementById("ky").value = e.target.value;
    });
  });

  function rhoMinPilar() { return 0.004; } // 0,4%
  function rhoMaxPilar() { return 0.08; }  // 8%

  // EquilÃ­brio N -> x e Mrd (uniaxial) com As_t e As_c explÃ­citos
  function calc_Mrd_uniaxial(Nsd_N, b_mm, d_mm, dLinha_mm, fcd, fyd, x_lim_ratio, As_t_mm2, As_c_mm2) {
    const maxIter = 60;
    const tol = 1e-6;
    const x_max = x_lim_ratio * d_mm;
    let a = 1e-6;
    let c = x_max;

    function f(x) {
      const Cc = 0.68 * fcd * b_mm * x;
      const Cs = As_c_mm2 * fyd;
      const T  = As_t_mm2 * fyd;
      const Nres = Cc + Cs - T;
      return Nres - Nsd_N;
    }

    let fa = f(a);
    let fc = f(c);
    if (fa * fc > 0) return null;

    let x = 0;
    for (let i = 0; i < maxIter; i++) {
      x = 0.5 * (a + c);
      const fx = f(x);
      if (Math.abs(fx) < tol) break;
      if (fa * fx < 0) { c = x; fc = fx; } else { a = x; fa = fx; }
    }

    const Cc_N = 0.68 * fcd * b_mm * x;
    const Cs_N = As_c_mm2 * fyd;
    const T_N  = As_t_mm2 * fyd;
    const yC = 0.4 * x;
    const yS = dLinha_mm;
    const yT = d_mm;

    const N_int = Cc_N + Cs_N - T_N;
    const Mrd_Nmm = Cc_N * yC + Cs_N * yS - T_N * yT;
    const errN = Math.abs(N_int - Nsd_N) / Math.max(Math.abs(Nsd_N), 1e-3) * 100;

    return { x_mm: x, Cc_N, Cs_N, T_N, N_int, Mrd_Nmm, errN };
  }

  function calcular() {
    const fck = parseFloat(document.getElementById("fck").value);
    const fyk = parseFloat(document.getElementById("fyk").value);
    const fyk_st = parseFloat(document.getElementById("fyk_st").value);
    const Es = parseFloat(document.getElementById("Es").value);
    const tipo_secao = document.getElementById("tipo_secao").value;

    const b_cm = parseFloat(document.getElementById("b").value || "0");
    const h_cm = parseFloat(document.getElementById("h").value || "0");
    const D_cm = parseFloat(document.getElementById("D").value || "0");
    const cob_cm = parseFloat(document.getElementById("cobertura").value);
    const phi_long = parseFloat(document.getElementById("phi_long").value);
    const As_tot_cm2 = parseFloat(document.getElementById("As_tot").value);
    const n_barras = parseInt(document.getElementById("n_barras").value, 10);

    const As_inf_cm2 = parseFloat(document.getElementById("As_inf").value || "0");
    const As_sup_cm2 = parseFloat(document.getElementById("As_sup").value || "0");
    const As_dir_cm2 = parseFloat(document.getElementById("As_dir").value || "0");
    const As_esq_cm2 = parseFloat(document.getElementById("As_esq").value || "0");

    const phi_st = parseFloat(document.getElementById("phi_stirrup").value);
    const s_st_cm = parseFloat(document.getElementById("s_st").value);

    const modo_calc = document.getElementById("modo_calc").value;

    const Nsd_kN = parseFloat(document.getElementById("Nsd").value);
    const Vsd_kN = parseFloat(document.getElementById("Vsd").value);
    const Msdx_kNm = parseFloat(document.getElementById("Msdx").value);
    const Msdy_kNm = parseFloat(document.getElementById("Msdy").value);
    const L_m = parseFloat(document.getElementById("L").value);
    const tipo_quadro = document.getElementById("tipo_quadro").value;
    const kx = parseFloat(document.getElementById("kx").value);
    const ky = parseFloat(document.getElementById("ky").value);

    const Nser_kN = parseFloat(document.getElementById("Nser").value);
    const Mserx_kNm = parseFloat(document.getElementById("Mserx").value);
    const Msery_kNm = parseFloat(document.getElementById("Msery").value);

    const phi_creep = parseFloat(document.getElementById("phi_creep").value);
    const eps_sh_â€° = parseFloat(document.getElementById("eps_sh").value);
    const alpha_I = parseFloat(document.getElementById("alpha_I").value);
    const modo_local = document.getElementById("modo_local").value;

    const obra = document.getElementById("obra").value || "-";
    const projeto = document.getElementById("projeto").value || "-";
    const pilarID = document.getElementById("pilar").value || "-";
    const engenheiro = document.getElementById("engenheiro").value || "-";

    const resDiv = document.getElementById("resultados");

    if (
      [fck,fyk,fyk_st,Es,cob_cm,phi_long,As_tot_cm2,n_barras,
       Nsd_kN,Msdx_kNm,Msdy_kNm,L_m,kx,ky,phi_creep,alpha_I].some(v => isNaN(v) || v <= 0)
    ) {
      resDiv.innerHTML = `
        <h3>Erro de entrada</h3>
        <p class="note">
          Verifique se todos os campos principais (materiais, seÃ§Ã£o, armadura, N, Mx, My, L, kx, ky, Ï†, Î±_I) estÃ£o preenchidos com valores vÃ¡lidos.
        </p>
      `;
      lastReportTxt = "";
      return;
    }
    if (Nsd_kN <= 0) {
      resDiv.innerHTML = `
        <h3>Erro â€“ Nsd</h3>
        <p class="note">
          O modelo considera apenas pilar em compressÃ£o (Nsd &gt; 0). Verifique o sinal da forÃ§a normal.
        </p>
      `;
      lastReportTxt = "";
      return;
    }

    const cob_mm = cob_cm * 10;
    const phi_long_mm = phi_long;

    let b_mm, h_mm, D_mm, tipoDesc;
    if (tipo_secao === "ret") {
      if (b_cm <= 0 || h_cm <= 0) {
        resDiv.innerHTML = `<h3>Erro na seÃ§Ã£o retangular</h3><p class="note">b e h devem ser &gt; 0.</p>`;
        lastReportTxt = "";
        return;
      }
      b_mm = b_cm * 10;
      h_mm = h_cm * 10;
      D_mm = null;
      tipoDesc = `Retangular ${format(b_cm,1)} Ã— ${format(h_cm,1)} cm`;
    } else {
      if (D_cm <= 0) {
        resDiv.innerHTML = `<h3>Erro na seÃ§Ã£o circular</h3><p class="note">DiÃ¢metro deve ser &gt; 0.</p>`;
        lastReportTxt = "";
        return;
      }
      D_mm = D_cm * 10;
      b_mm = D_mm;
      h_mm = D_mm;
      tipoDesc = `Circular D = ${format(D_cm,1)} cm`;
    }

    const d_mm = h_mm - cob_mm - phi_long_mm/2;
    const dLinha_mm = cob_mm + phi_long_mm/2;
    if (d_mm <= 0) {
      resDiv.innerHTML = `<h3>Geometria invÃ¡lida</h3><p class="note">d ficou negativo ou muito pequeno. Verifique h, cobrimento e diÃ¢metro das barras.</p>`;
      lastReportTxt = "";
      return;
    }

    const gamma_c = 1.4;
    const gamma_s = 1.15;
    const alpha_cc = 0.85;

    const fcd = alpha_cc * fck / gamma_c;
    const fyd = fyk / gamma_s;
    const fydw_lim = 435;
    const fydw = Math.min(fyk_st / gamma_s, fydw_lim);

    const fctm = 0.3 * Math.pow(fck, 2.0/3.0);
    const fctk_inf = 0.7 * fctm;
    const fctd = fctk_inf / gamma_c;

    const Nsd_N = Nsd_kN * 1e3;
    const Vsd_N = Vsd_kN * 1e3;
    const Msdx_Nmm = Msdx_kNm * 1e6;
    const Msdy_Nmm = Msdy_kNm * 1e6;

    let Ac_mm2, Ix_m4, Iy_m4;
    if (tipo_secao === "ret") {
      Ac_mm2 = b_mm * h_mm;
      const b_m = b_mm / 1000, h_m = h_mm / 1000;
      Ix_m4 = b_m * Math.pow(h_m,3) / 12;
      Iy_m4 = h_m * Math.pow(b_m,3) / 12;
    } else {
      Ac_mm2 = Math.PI * Math.pow(D_mm,2) / 4;
      const D_m = D_mm / 1000;
      const I_m4 = Math.PI * Math.pow(D_m,4) / 64;
      Ix_m4 = I_m4;
      Iy_m4 = I_m4;
    }

    const As_tot_mm2 = As_tot_cm2 * 100;
    const As_faces_mm2 = (As_inf_cm2 + As_sup_cm2 + As_dir_cm2 + As_esq_cm2) * 100;
    const As_para_rho_mm2 = (As_faces_mm2 > 0) ? As_faces_mm2 : As_tot_mm2;
    const rho = As_para_rho_mm2 / Ac_mm2;
    const rho_min = rhoMinPilar();
    const rho_max = rhoMaxPilar();
    let taxaTag = "";
    if (rho < rho_min - 1e-6) {
      taxaTag = `<span class="tag tag-err">Ï &lt; ÏmÃ­n (0,4% para pilares)</span>`;
    } else if (rho > rho_max + 1e-6) {
      taxaTag = `<span class="tag tag-err">Ï &gt; ÏmÃ¡x (8% para pilares)</span>`;
    } else {
      taxaTag = `<span class="tag tag-ok">Taxa de armadura dentro de 0,4%â€“8%</span>`;
    }

    const x_lim_ratio = 0.45;
    const x_lim_mm = x_lim_ratio * d_mm;

    // As por direÃ§Ã£o (se nada informado, assume simÃ©trica com As_tot)
    const As_inf_mm2 = As_inf_cm2 * 100;
    const As_sup_mm2 = As_sup_cm2 * 100;
    const As_dir_mm2 = As_dir_cm2 * 100;
    const As_esq_mm2 = As_esq_cm2 * 100;

    const As_t_x_mm2 = (As_inf_mm2 > 0 || As_sup_mm2 > 0)
      ? (As_inf_mm2 || As_sup_mm2) // se sÃ³ um, usa esse como referÃªncia
      : As_tot_mm2 / 2;
    const As_c_x_mm2 = (As_inf_mm2 > 0 || As_sup_mm2 > 0)
      ? (As_sup_mm2 || As_inf_mm2)
      : As_tot_mm2 / 2;

    const As_t_y_mm2 = (As_dir_mm2 > 0 || As_esq_mm2 > 0)
      ? (As_dir_mm2 || As_esq_mm2)
      : As_tot_mm2 / 2;
    const As_c_y_mm2 = (As_dir_mm2 > 0 || As_esq_mm2 > 0)
      ? (As_esq_mm2 || As_dir_mm2)
      : As_tot_mm2 / 2;

    // Flexo-compressÃ£o uniaxial em X
    const Mx_res = calc_Mrd_uniaxial(Nsd_N, b_mm, d_mm, dLinha_mm, fcd, fyd, x_lim_ratio, As_t_x_mm2, As_c_x_mm2);
    if (!Mx_res || Mx_res.x_mm <= 0 || Mx_res.x_mm > x_lim_mm) {
      resDiv.innerHTML = `
        <h3>Falha no equilÃ­brio Nâ€“Mx</h3>
        <p class="note">
          Com a seÃ§Ã£o e armaduras (inferior/superior) informadas, nÃ£o foi possÃ­vel equilibrar Nsd em flexo-compressÃ£o uniaxial em X com x/d â‰¤ ${format(x_lim_ratio,2)}.
        </p>
      `;
      lastReportTxt = "";
      return;
    }

    // Flexo-compressÃ£o uniaxial em Y
    let d_y_mm, dLinha_y_mm, bw_y_mm;
    if (tipo_secao === "ret") {
      bw_y_mm = h_mm;
      d_y_mm = b_mm - cob_mm - phi_long_mm/2;
      dLinha_y_mm = cob_mm + phi_long_mm/2;
    } else {
      bw_y_mm = b_mm;
      d_y_mm = d_mm;
      dLinha_y_mm = dLinha_mm;
    }
    const My_res = calc_Mrd_uniaxial(Nsd_N, bw_y_mm, d_y_mm, dLinha_y_mm, fcd, fyd, x_lim_ratio, As_t_y_mm2, As_c_y_mm2);
    if (!My_res || My_res.x_mm <= 0 || My_res.x_mm > x_lim_ratio * d_y_mm) {
      resDiv.innerHTML = `
        <h3>Falha no equilÃ­brio Nâ€“My</h3>
        <p class="note">
          Com a seÃ§Ã£o e armaduras (direita/esquerda) informadas, nÃ£o foi possÃ­vel equilibrar Nsd em flexo-compressÃ£o uniaxial em Y com x/d â‰¤ ${format(x_lim_ratio,2)}.
        </p>
      `;
      lastReportTxt = "";
      return;
    }

    const x_mm = Mx_res.x_mm;
    const x_d = x_mm / d_mm;

    const eps_cu = 0.0035;
    const eps_c = eps_cu;
    const eps_y = fyd / Es;
    const eps_s = (eps_c * (d_mm - x_mm)) / x_mm;
    const eps_s_comp = (eps_c * (x_mm - dLinha_mm)) / x_mm;
    const status_eps_s = (eps_s >= eps_y) ? "aÃ§o tracionado no escoamento" : "aÃ§o tracionado abaixo do escoamento";
    const status_eps_s_comp = (eps_s_comp >= eps_y) ? "aÃ§o comprimido no escoamento" : "aÃ§o comprimido abaixo do escoamento";

    let dominio_msg = "";
    if (x_d <= 0.259) dominio_msg = "DomÃ­nio 2 (flexo-compressÃ£o moderada).";
    else if (x_d <= 0.628) dominio_msg = "DomÃ­nio 3.";
    else dominio_msg = "DomÃ­nio 4 (nÃ£o desejÃ¡vel).";

    let dominio_tag = "";
    if (x_d <= x_lim_ratio + 1e-4) {
      dominio_tag = `<span class="tag tag-ok">x/d â‰¤ ${format(x_lim_ratio,2)} (ductilidade mÃ­nima atendida)</span>`;
    } else {
      dominio_tag = `<span class="tag tag-err">x/d &gt; limite de ductilidade adotado</span>`;
    }

    const Eci = 5600 * Math.sqrt(fck);
    const Ec = 0.85 * Eci;
    const Ec_eff = Ec / (1 + phi_creep);

    const Lx_m = kx * L_m;
    const Ly_m = ky * L_m;

    const Ncrx_kN = Math.PI*Math.PI*Ec*Ix_m4/(Lx_m*Lx_m)/1e3;
    const Ncry_kN = Math.PI*Math.PI*Ec*Iy_m4/(Ly_m*Ly_m)/1e3;

    let gamma_zx = 1.0, gamma_zy = 1.0;
    const gamma_max = (tipo_quadro === "deslocavel") ? 1.4 : 1.3;
    let gammaTagX="", gammaTagY="";

    if (Ncrx_kN > 0) {
      gamma_zx = 1/(1 - Nsd_kN/Ncrx_kN);
      if (gamma_zx < 1) gamma_zx = 1;
      if (gamma_zx > gamma_max) gamma_zx = gamma_max;
      gammaTagX = (gamma_zx > 1)
        ? `<span class="tag tag-warn">2Âª ordem global em X (Î³z,x â‰ˆ ${format(gamma_zx,2)})</span>`
        : `<span class="tag tag-ok">2Âª ordem global pequena em X (Î³z,x â‰ˆ 1,0)</span>`;
    } else {
      gammaTagX = `<span class="tag tag-err">Ncr,x global nÃ£o definido (verifique dados).</span>`;
    }

    if (Ncry_kN > 0) {
      gamma_zy = 1/(1 - Nsd_kN/Ncry_kN);
      if (gamma_zy < 1) gamma_zy = 1;
      if (gamma_zy > gamma_max) gamma_zy = gamma_max;
      gammaTagY = (gamma_zy > 1)
        ? `<span class="tag tag-warn">2Âª ordem global em Y (Î³z,y â‰ˆ ${format(gamma_zy,2)})</span>`
        : `<span class="tag tag-ok">2Âª ordem global pequena em Y (Î³z,y â‰ˆ 1,0)</span>`;
    } else {
      gammaTagY = `<span class="tag tag-err">Ncr,y global nÃ£o definido (verifique dados).</span>`;
    }

    const Msdx2_glob_Nmm = gamma_zx * Msdx_Nmm;
    const Msdy2_glob_Nmm = gamma_zy * Msdy_Nmm;

    const Ix_eff_m4 = alpha_I * Ix_m4;
    const Iy_eff_m4 = alpha_I * Iy_m4;

    const Ncrx_loc_kN = Math.PI*Math.PI*Ec_eff*Ix_eff_m4/(Lx_m*Lx_m)/1e3;
    const Ncry_loc_kN = Math.PI*Math.PI*Ec_eff*Iy_eff_m4/(Ly_m*Ly_m)/1e3;

    const lambda_x = (Lx_m*1000)/Math.sqrt(Ix_m4*1e12/Ac_mm2);
    const lambda_y = (Ly_m*1000)/Math.sqrt(Iy_m4*1e12/Ac_mm2);

    // Limites de esbeltez aproximados conforme tipo de quadro
    const lambda_lim_x = (tipo_quadro === "nÃ£o-deslocavel") ? 90 : 140;
    const lambda_lim_y = (tipo_quadro === "nÃ£o-deslocavel") ? 90 : 140;

    const esbelto_x = lambda_x > lambda_lim_x;
    const esbelto_y = lambda_y > lambda_lim_y;

    let slenderTagX = esbelto_x
      ? `<span class="tag tag-warn">Î»x = ${format(lambda_x,1)} &gt; Î»lim,x â‰ˆ ${format(lambda_lim_x,0)} (pilar esbelto em X)</span>`
      : `<span class="tag tag-ok">Î»x = ${format(lambda_x,1)} â‰¤ Î»lim,x â‰ˆ ${format(lambda_lim_x,0)}</span>`;

    let slenderTagY = esbelto_y
      ? `<span class="tag tag-warn">Î»y = ${format(lambda_y,1)} &gt; Î»lim,y â‰ˆ ${format(lambda_lim_y,0)} (pilar esbelto em Y)</span>`
      : `<span class="tag tag-ok">Î»y = ${format(lambda_y,1)} â‰¤ Î»lim,y â‰ˆ ${format(lambda_lim_y,0)}</span>`;

    let gamma_loc_x = 1.0, gamma_loc_y = 1.0;
    let modoLocalDesc = "";

    let usarLocalX = false, usarLocalY = false;
    if (modo_local === "forcar") {
      usarLocalX = usarLocalY = true;
      modoLocalDesc = "ForÃ§ado pelo usuÃ¡rio (2Âª ordem local nos dois eixos).";
    } else if (modo_local === "off") {
      usarLocalX = usarLocalY = false;
      modoLocalDesc = "Desligado, apenas 2Âª ordem global.";
    } else {
      usarLocalX = esbelto_x;
      usarLocalY = esbelto_y;
      modoLocalDesc = "AutomÃ¡tico: sÃ³ considera local se Î» &gt; Î»lim em cada eixo.";
    }

    const gamma_max_loc = 1.5;
    if (usarLocalX && Ncrx_loc_kN > 0) {
      gamma_loc_x = 1/(1 - Nsd_kN/Ncrx_loc_kN);
      if (gamma_loc_x < 1) gamma_loc_x = 1;
      if (gamma_loc_x > gamma_max_loc) gamma_loc_x = gamma_max_loc;
    }
    if (usarLocalY && Ncry_loc_kN > 0) {
      gamma_loc_y = 1/(1 - Nsd_kN/Ncry_loc_kN);
      if (gamma_loc_y < 1) gamma_loc_y = 1;
      if (gamma_loc_y > gamma_max_loc) gamma_loc_y = gamma_max_loc;
    }

    const Msdx2_tot_Nmm = Msdx_Nmm * gamma_zx * gamma_loc_x;
    const Msdy2_tot_Nmm = Msdy_Nmm * gamma_zy * gamma_loc_y;

    const Mrdx_Nmm = Mx_res.Mrd_Nmm;
    const Mrdy_Nmm = My_res.Mrd_Nmm;

    const FS_Mx_1 = Mrdx_Nmm / Msdx_Nmm;
    const FS_My_1 = Mrdy_Nmm / Msdy_Nmm;
    const FS_Mx_2g = Mrdx_Nmm / Msdx2_glob_Nmm;
    const FS_My_2g = Mrdy_Nmm / Msdy2_glob_Nmm;
    const FS_Mx_tot = Mrdx_Nmm / Msdx2_tot_Nmm;
    const FS_My_tot = Mrdy_Nmm / Msdy2_tot_Nmm;

    const biax_ratio = (Msdx2_tot_Nmm/Mrdx_Nmm) + (Msdy2_tot_Nmm/Mrdy_Nmm);
    const FS_biax = 1 / biax_ratio;
    let biax_tag = "";
    if (biax_ratio <= 1) {
      biax_tag = `<span class="tag tag-ok">InteraÃ§Ã£o biaxial atendida (Mx,tot/MRx + My,tot/MRy â‰¤ 1)</span>`;
    } else {
      biax_tag = `<span class="tag tag-err">InteraÃ§Ã£o biaxial ULTRA-solicitada (Mx,tot/MRx + My,tot/MRy &gt; 1)</span>`;
    }

    const e1x_cm = Msdx_kNm / Nsd_kN * 100;
    const e1y_cm = Msdy_kNm / Nsd_kN * 100;
    const e0x_cm = Mserx_kNm / Math.max(Nser_kN,1e-3) * 100;
    const e0y_cm = Msery_kNm / Math.max(Nser_kN,1e-3) * 100;
    const e_min_geom_x_cm = Math.max(h_cm/30, b_cm/30, 2);
    const e_min_geom_y_cm = Math.max(b_cm/30, h_cm/30, 2);
    const e_min_norm_x_cm = Math.max(e_min_geom_x_cm, 2);
    const e_min_norm_y_cm = Math.max(e_min_geom_y_cm, 2);

    const alpha_v2 = 1.0 - fck/250.0;
    const VRd2_N = 0.27 * alpha_v2 * fcd * b_mm * d_mm;
    const Vc0_N = 0.6 * fctd * b_mm * d_mm;
    const vEd_MPa = Vsd_N / (b_mm * d_mm);
    const vRd2_MPa = VRd2_N / (b_mm * d_mm);
    const FS_V = VRd2_N / Math.max(Vsd_N,1e-3);

    let cis_tag="", cis_msg="";
    if (Vsd_N <= 1e-3) {
      cis_tag = `<span class="tag tag-ok">Vsd â‰ˆ 0 (cisalhamento irrelevante)</span>`;
      cis_msg = "Sem esforÃ§o cortante significativo informado.";
    } else if (Vsd_N > VRd2_N) {
      cis_tag = `<span class="tag tag-err">Vsd &gt; VRd2 (compressÃ£o diagonal nÃ£o verificada)</span>`;
      cis_msg = "Rever seÃ§Ã£o / fck ou modelo resistente para cisalhamento.";
    } else {
      cis_tag = `<span class="tag tag-ok">Vsd â‰¤ VRd2 (cisalhamento verificado)</span>`;
      cis_msg = "VRd2 suficiente para o Vsd informado.";
    }

    const s_st_mm = s_st_cm * 10;
    const s_lim1_mm = 16 * phi_long_mm;
    const s_lim2_mm = 48 * phi_st;
    const s_lim3_mm = h_mm;
    const s_lim4_mm = 200;
    const s_lim_mm = Math.min(s_lim1_mm,s_lim2_mm,s_lim3_mm,s_lim4_mm);
    let estriboTag="";
    if (s_st_mm <= s_lim_mm + 1e-6) {
      estriboTag = `<span class="tag tag-ok">EspaÃ§amento de estribos dentro dos limites usuais (â‰¤ ${format(s_lim_mm/10,1)} cm)</span>`;
    } else {
      estriboTag = `<span class="tag tag-err">s adotado &gt; limites tÃ­picos de estribos (mÃ¡x â‰ˆ ${format(s_lim_mm/10,1)} cm)</span>`;
    }

    let avisoNorma = "";
    if (fck < 20 || fck > 50) avisoNorma += "â€¢ fck fora da faixa tÃ­pica (20â€“50 MPa).\n";
    if (fyk < 400 || fyk > 650) avisoNorma += "â€¢ fyk barras fora da faixa usual CA-25/50/60.\n";
    if (fyk_st < 400 || fyk_st > 650) avisoNorma += "â€¢ fyk estribos fora da faixa usual.\n";

    const resultPills = `
      <div class="result-pill-row">
        <div class="result-pill">Nsd: <strong>${format(Nsd_kN,1)}</strong> kN</div>
        <div class="result-pill">Mx,1Âª: <strong>${format(Msdx_kNm,1)}</strong> kNÂ·m</div>
        <div class="result-pill">My,1Âª: <strong>${format(Msdy_kNm,1)}</strong> kNÂ·m</div>
        <div class="result-pill">Mx,tot: <strong>${format(Msdx2_tot_Nmm/1e6,2)}</strong> kNÂ·m</div>
        <div class="result-pill">My,tot: <strong>${format(Msdy2_tot_Nmm/1e6,2)}</strong> kNÂ·m</div>
        <div class="result-pill">FS_biax: <strong>${format(FS_biax,2)}</strong></div>
        <div class="result-pill">Î»x: <strong>${format(lambda_x,1)}</strong></div>
        <div class="result-pill">Î»y: <strong>${format(lambda_y,1)}</strong></div>
      </div>
    `;

    document.getElementById("resultados").innerHTML = `
      <h3>Resumo dos resultados</h3>
      ${resultPills}

      <p class="section-title">IdentificaÃ§Ã£o</p>
      <ul>
        <li><b>Obra:</b> ${obra}</li>
        <li><b>Projeto:</b> ${projeto}</li>
        <li><b>Pilar:</b> ${pilarID}</li>
        <li><b>Eng. responsÃ¡vel / CREA:</b> ${engenheiro}</li>
        <li><b>Modo de cÃ¡lculo:</b> Somente verificaÃ§Ã£o (As informada).</li>
      </ul>

      <p class="section-title">SeÃ§Ã£o e materiais</p>
      <ul>
        <li>SeÃ§Ã£o: <strong>${tipoDesc}</strong></li>
        <li>fck = <strong>${format(fck,0)}</strong> MPa, fyk barras = <strong>${format(fyk,0)}</strong> MPa, fyk estribos = <strong>${format(fyk_st,0)}</strong> MPa</li>
        <li>Cobrimento = <strong>${format(cob_cm,2)}</strong> cm, Ã˜ barras long. = <strong>${format(phi_long_mm,1)}</strong> mm</li>
        <li>d â‰ˆ <strong>${format(d_mm/10,2)}</strong> cm, d' â‰ˆ <strong>${format(dLinha_mm/10,2)}</strong> cm</li>
        <li>fcd = <strong>${format(fcd,2)}</strong> MPa, fyd = <strong>${format(fyd,2)}</strong> MPa, fydw â‰ˆ <strong>${format(fydw,2)}</strong> MPa</li>
        <li>Eci â‰ˆ <strong>${format(Eci,0)}</strong> MPa, Ec â‰ˆ <strong>${format(Ec,0)}</strong> MPa, Ec,eff = Ec/(1+Ï†) â‰ˆ <strong>${format(Ec_eff,0)}</strong> MPa</li>
      </ul>

      <p class="section-title">Armadura longitudinal</p>
      ${taxaTag}
      <ul>
        <li>As,total (ref.) = <strong>${format(As_tot_mm2,1)}</strong> mmÂ² = <strong>${format(As_tot_cm2,2)}</strong> cmÂ²</li>
        <li>As inferior (+Mx traÃ§Ã£o) = <strong>${format(As_inf_cm2,2)}</strong> cmÂ²; As superior = <strong>${format(As_sup_cm2,2)}</strong> cmÂ²</li>
        <li>As direita (+My traÃ§Ã£o) = <strong>${format(As_dir_cm2,2)}</strong> cmÂ²; As esquerda = <strong>${format(As_esq_cm2,2)}</strong> cmÂ²</li>
        <li>As usada para Ï = <strong>${format(As_para_rho_mm2,1)}</strong> mmÂ² â‡’ Ï â‰ˆ <strong>${format(rho*100,3)}</strong> %</li>
        <li>ÏmÃ­n (pilar) â‰ˆ <strong>${format(rho_min*100,3)}</strong> % â†’ As,mÃ­n â‰ˆ <strong>${format(rho_min*Ac_mm2,1)}</strong> mmÂ²</li>
        <li>ÏmÃ¡x (pilar) â‰ˆ <strong>${format(rho_max*100,3)}</strong> % â†’ As,mÃ¡x â‰ˆ <strong>${format(rho_max*Ac_mm2,1)}</strong> mmÂ²</li>
        <li>NÂº total de barras: <strong>${n_barras}</strong></li>
      </ul>

      <h4>1) ULS â€“ Flexo-CompressÃ£o Uniaxial em X e Y (N + Mx, N + My)</h4>
      ${dominio_tag}
      <ul>
        <li>Nsd = <strong>${format(Nsd_kN,1)}</strong> kN</li>
        <li>Msd,x (1Âª) = <strong>${format(Msdx_kNm,1)}</strong> kNÂ·m, Mrd,x â‰ˆ <strong>${format(Mrdx_Nmm/1e6,2)}</strong> kNÂ·m</li>
        <li>Msd,y (1Âª) = <strong>${format(Msdy_kNm,1)}</strong> kNÂ·m, Mrd,y â‰ˆ <strong>${format(Mrdy_Nmm/1e6,2)}</strong> kNÂ·m</li>
        <li>FS_Mx (1Âª) â‰ˆ <strong>${format(FS_Mx_1,2)}</strong>, FS_My (1Âª) â‰ˆ <strong>${format(FS_My_1,2)}</strong></li>
        <li>x â‰ˆ <strong>${format(x_mm,2)}</strong> mm â‡’ x/d â‰ˆ <strong>${format(x_d,3)}</strong></li>
      </ul>
      <p class="note">DomÃ­nio aproximado: ${dominio_msg}</p>

      <p class="section-title">DeformaÃ§Ãµes no ELU</p>
      <ul>
        <li>Îµc topo â‰ˆ <strong>${format(eps_c*1000,3)}</strong> â€°</li>
        <li>Îµs traÃ§Ã£o â‰ˆ <strong>${format(eps_s*1000,3)}</strong> â€°, Îµy â‰ˆ <strong>${format(eps_y*1000,3)}</strong> â€° â†’ ${status_eps_s}</li>
        <li>Îµs' compressÃ£o â‰ˆ <strong>${format(eps_s_comp*1000,3)}</strong> â€° â†’ ${status_eps_s_comp}</li>
      </ul>

      <h4>2) Esbeltez Î» (NBR â€“ calibraÃ§Ã£o por tipo de quadro)</h4>
      ${slenderTagX} ${slenderTagY}
      <ul>
        <li>Tipo de quadro: <strong>${tipo_quadro}</strong></li>
        <li>â„“0,x = kxÂ·L â‰ˆ <strong>${format(Lx_m,2)}</strong> m, â„“0,y = kyÂ·L â‰ˆ <strong>${format(Ly_m,2)}</strong> m</li>
        <li>Î»x â‰ˆ <strong>${format(lambda_x,1)}</strong>, Î»y â‰ˆ <strong>${format(lambda_y,1)}</strong></li>
        <li>Î»lim,x â‰ˆ <strong>${format(lambda_lim_x,0)}</strong>, Î»lim,y â‰ˆ <strong>${format(lambda_lim_y,0)}</strong> (valores usuais para ignorar 2Âª ordem)</li>
      </ul>

      <h4>3) 2Âª Ordem Global (Î³z,x / Î³z,y)</h4>
      ${gammaTagX} ${gammaTagY}
      <ul>
        <li>Ncr,x (global) â‰ˆ <strong>${format(Ncrx_kN,1)}</strong> kN, Ncr,y (global) â‰ˆ <strong>${format(Ncry_kN,1)}</strong> kN</li>
        <li>Msd,x (2Âª global) = Î³z,xÂ·Msd,x â‰ˆ <strong>${format(Msdx2_glob_Nmm/1e6,2)}</strong> kNÂ·m</li>
        <li>Msd,y (2Âª global) = Î³z,yÂ·Msd,y â‰ˆ <strong>${format(Msdy2_glob_Nmm/1e6,2)}</strong> kNÂ·m</li>
        <li>FS_Mx (2Âª global) â‰ˆ <strong>${format(FS_Mx_2g,2)}</strong>, FS_My (2Âª global) â‰ˆ <strong>${format(FS_My_2g,2)}</strong></li>
      </ul>

      <h4>4) 2Âª Ordem Local (pilar esbelto, fluÃªncia, I fissurada)</h4>
      <ul>
        <li>Ï† (fluÃªncia) = <strong>${format(phi_creep,2)}</strong>, Îµsh â‰ˆ <strong>${format(eps_sh_â€°,2)}</strong> â€°</li>
        <li>Î±_I (I fissurada) = <strong>${format(alpha_I,2)}</strong> â†’ Ieff,x = Î±Â·Ix, Ieff,y = Î±Â·Iy</li>
        <li>Ncr,x (local) â‰ˆ <strong>${format(Ncrx_loc_kN,1)}</strong> kN, Ncr,y (local) â‰ˆ <strong>${format(Ncry_loc_kN,1)}</strong> kN</li>
        <li>Modo de uso local: <strong>${modoLocalDesc}</strong></li>
        <li>Î³loc,x â‰ˆ <strong>${format(gamma_loc_x,2)}</strong> (usado? ${usarLocalX ? "sim" : "nÃ£o"})</li>
        <li>Î³loc,y â‰ˆ <strong>${format(gamma_loc_y,2)}</strong> (usado? ${usarLocalY ? "sim" : "nÃ£o"})</li>
        <li>Msd,x total = Msd,xÂ·Î³z,xÂ·Î³loc,x â‰ˆ <strong>${format(Msdx2_tot_Nmm/1e6,2)}</strong> kNÂ·m</li>
        <li>Msd,y total = Msd,yÂ·Î³z,yÂ·Î³loc,y â‰ˆ <strong>${format(Msdy2_tot_Nmm/1e6,2)}</strong> kNÂ·m</li>
        <li>FS_Mx (global+local) â‰ˆ <strong>${format(FS_Mx_tot,2)}</strong>, FS_My (global+local) â‰ˆ <strong>${format(FS_My_tot,2)}</strong></li>
      </ul>

      <h4>5) InteraÃ§Ã£o Biaxial Nâ€“Mxâ€“My (Bresler com momentos totais)</h4>
      ${biax_tag}
      <ul>
        <li>Soma biaxial: Mx,tot/MRx + My,tot/MRy â‰ˆ <strong>${format(biax_ratio,3)}</strong></li>
        <li>FS_biax â‰ˆ <strong>${format(FS_biax,2)}</strong></li>
      </ul>

      <h4>6) Excentricidades (ELS â€“ coerÃªncia de modelo)</h4>
      <ul>
        <li>e1x = Msd,x/Nsd â‰ˆ <strong>${format(e1x_cm,2)}</strong> cm, e1y â‰ˆ <strong>${format(e1y_cm,2)}</strong> cm</li>
        <li>e0x = Mser,x/Nser â‰ˆ <strong>${format(e0x_cm,2)}</strong> cm, e0y â‰ˆ <strong>${format(e0y_cm,2)}</strong> cm</li>
        <li>e_min geom,x â‰ˆ <strong>${format(e_min_geom_x_cm,2)}</strong> cm, e_min geom,y â‰ˆ <strong>${format(e_min_geom_y_cm,2)}</strong> cm</li>
        <li>e_min normativa (aprox.) x â‰ˆ <strong>${format(e_min_norm_x_cm,2)}</strong> cm, y â‰ˆ <strong>${format(e_min_norm_y_cm,2)}</strong> cm</li>
      </ul>

      <hr>

      <h4>7) Cisalhamento (VRd2 x Vsd)</h4>
      ${cis_tag}
      <ul>
        <li>Vsd = <strong>${format(Vsd_kN,1)}</strong> kN</li>
        <li>VRd2 â‰ˆ <strong>${format(VRd2_N/1e3,2)}</strong> kN, Vc0 â‰ˆ <strong>${format(Vc0_N/1e3,2)}</strong> kN</li>
        <li>Î½Ed â‰ˆ <strong>${format(vEd_MPa,3)}</strong> MPa, Î½Rd2 â‰ˆ <strong>${format(vRd2_MPa,3)}</strong> MPa</li>
        <li>FS_V = VRd2 / Vsd â‰ˆ <strong>${format(FS_V,2)}</strong></li>
        <li>${cis_msg}</li>
      </ul>

      <h4>8) Detalhamento â€“ Estribos (regras aproximadas)</h4>
      ${estriboTag}
      <ul>
        <li>Ã˜ estribo = <strong>${format(phi_st,1)}</strong> mm, s adotado = <strong>${format(s_st_cm,1)}</strong> cm</li>
        <li>Limites tÃ­picos:
          <ul>
            <li>s â‰¤ 16Â·Ã˜long â†’ ${format(s_lim1_mm/10,1)} cm</li>
            <li>s â‰¤ 48Â·Ã˜estribo â†’ ${format(s_lim2_mm/10,1)} cm</li>
            <li>s â‰¤ h (seÃ§Ã£o) â†’ ${format(s_lim3_mm/10,1)} cm</li>
            <li>s â‰¤ 20 cm</li>
          </ul>
        </li>
        <li>s_lim adotado â‰ˆ <strong>${format(s_lim_mm/10,1)}</strong> cm</li>
      </ul>

      <hr>
      <p class="note">
        NÃºcleo avanÃ§ado para <b>1 pilar</b> em concreto armado com N + Mx + My, 2Âª ordem global e local (via Ec,eff e I fissurada),
        esbeltez Î» calibrada por tipo de quadro, armadura assimÃ©trica por face e interaÃ§Ã£o biaxial via Bresler.
        Modo atual Ã© <b>somente verificaÃ§Ã£o</b>: As sÃ£o definidas pelo usuÃ¡rio e o programa verifica FS em todas as verificaÃ§Ãµes principais.
      </p>
      ${
        avisoNorma
          ? `<p class="note"><b>ObservaÃ§Ãµes de validade:</b><br>${avisoNorma.replace(/\n/g,"<br>")}</p>`
          : ""
      }
    `;

    // ---------- TXT ----------
    let txt = "";
    txt += "============================================================\n";
    txt += "RELATÃ“RIO DE PILAR DE CONCRETO ARMADO - NBR 6118\n";
    txt += "MODO: SOMENTE VERIFICAÃ‡ÃƒO (As INFORMADA)\n";
    txt += "============================================================\n\n";
    txt += "IDENTIFICAÃ‡ÃƒO\n";
    txt += "  Obra   : " + obra + "\n";
    txt += "  Projeto: " + projeto + "\n";
    txt += "  Pilar  : " + pilarID + "\n";
    txt += "  Eng. resp. / CREA: " + engenheiro + "\n\n";
    txt += "  NÃºcleo de cÃ¡lculo especificado por: Wilson Fernandes Junior\n\n";

    txt += "SEÃ‡ÃƒO E MATERIAIS\n";
    txt += "  SeÃ§Ã£o              : " + tipoDesc + "\n";
    txt += "  fck                : " + format(fck,0) + " MPa\n";
    txt += "  fyk barras         : " + format(fyk,0) + " MPa\n";
    txt += "  fyk estribos       : " + format(fyk_st,0) + " MPa\n";
    txt += "  Es                 : " + format(Es,0) + " MPa\n";
    txt += "  Cobrimento         : " + format(cob_cm,2) + " cm\n";
    txt += "  Ã˜ barras long.     : " + format(phi_long_mm,1) + " mm\n";
    txt += "  d                  : " + format(d_mm/10,2) + " cm\n";
    txt += "  d'                 : " + format(dLinha_mm/10,2) + " cm\n";
    txt += "  fcd                : " + format(fcd,2) + " MPa\n";
    txt += "  fyd                : " + format(fyd,2) + " MPa\n";
    txt += "  fydw               : " + format(fydw,2) + " MPa\n";
    txt += "  fctm               : " + format(fctm,2) + " MPa\n";
    txt += "  fctd               : " + format(fctd,2) + " MPa\n";
    txt += "  Eci                : " + format(Eci,0) + " MPa\n";
    txt += "  Ec                 : " + format(Ec,0) + " MPa\n";
    txt += "  Ec,eff (fluÃªncia)  : " + format(Ec_eff,0) + " MPa\n\n";

    txt += "ARMADURA LONGITUDINAL\n";
    txt += "  As,total (ref.)    : " + format(As_tot_mm2,1) + " mmÂ² (" + format(As_tot_cm2,2) + " cmÂ²)\n";
    txt += "  As inferior         : " + format(As_inf_cm2,2) + " cmÂ²\n";
    txt += "  As superior         : " + format(As_sup_cm2,2) + " cmÂ²\n";
    txt += "  As direita          : " + format(As_dir_cm2,2) + " cmÂ²\n";
    txt += "  As esquerda         : " + format(As_esq_cm2,2) + " cmÂ²\n";
    txt += "  As p/ Ï            : " + format(As_para_rho_mm2,1) + " mmÂ²\n";
    txt += "  Ï (As/Ac)          : " + format(rho*100,3) + " %\n";
    txt += "  ÏmÃ­n (pilar)       : " + format(rho_min*100,3) + " %\n";
    txt += "  ÏmÃ¡x (pilar)       : " + format(rho_max*100,3) + " %\n";
    txt += "  NÂº de barras       : " + n_barras + "\n\n";

    txt += "ESFORÃ‡OS ULTIMOS (ELU)\n";
    txt += "  Nsd                : " + format(Nsd_kN,1) + " kN\n";
    txt += "  Msd,x              : " + format(Msdx_kNm,1) + " kNÂ·m\n";
    txt += "  Msd,y              : " + format(Msdy_kNm,1) + " kNÂ·m\n";
    txt += "  Vsd                : " + format(Vsd_kN,1) + " kN\n\n";

    txt += "UNIAXIAL X E Y (N + Mx, N + My)\n";
    txt += "  x/d                : " + format(x_d,3) + "\n";
    txt += "  Mrd,x              : " + format(Mrdx_Nmm/1e6,2) + " kNÂ·m\n";
    txt += "  Mrd,y              : " + format(Mrdy_Nmm/1e6,2) + " kNÂ·m\n";
    txt += "  FS_Mx (1Âª ordem)   : " + format(FS_Mx_1,2) + "\n";
    txt += "  FS_My (1Âª ordem)   : " + format(FS_My_1,2) + "\n\n";

    txt += "DEFORMAÃ‡Ã•ES NO ELU\n";
    txt += "  Îµc topo            : " + format(eps_c*1000,3) + " â€°\n";
    txt += "  Îµs traÃ§Ã£o          : " + format(eps_s*1000,3) + " â€° (" + status_eps_s + ")\n";
    txt += "  Îµs' compressÃ£o     : " + format(eps_s_comp*1000,3) + " â€° (" + status_eps_s_comp + ")\n";
    txt += "  DomÃ­nio (aprox.)   : " + dominio_msg + "\n\n";

    txt += "ESBELTEZ Î»\n";
    txt += "  Tipo de quadro     : " + tipo_quadro + "\n";
    txt += "  â„“0,x               : " + format(Lx_m,2) + " m\n";
    txt += "  â„“0,y               : " + format(Ly_m,2) + " m\n";
    txt += "  Î»x                 : " + format(lambda_x,1) + "\n";
    txt += "  Î»y                 : " + format(lambda_y,1) + "\n";
    txt += "  Î»lim,x             : " + format(lambda_lim_x,0) + "\n";
    txt += "  Î»lim,y             : " + format(lambda_lim_y,0) + "\n\n";

    txt += "2Âª ORDEM GLOBAL\n";
    txt += "  Ncr,x (global)     : " + format(Ncrx_kN,1) + " kN\n";
    txt += "  Ncr,y (global)     : " + format(Ncry_kN,1) + " kN\n";
    txt += "  Î³z,x               : " + format(gamma_zx,2) + "\n";
    txt += "  Î³z,y               : " + format(gamma_zy,2) + "\n";
    txt += "  Msd,x (2Âª global)  : " + format(Msdx2_glob_Nmm/1e6,2) + " kNÂ·m\n";
    txt += "  Msd,y (2Âª global)  : " + format(Msdy2_glob_Nmm/1e6,2) + " kNÂ·m\n";
    txt += "  FS_Mx (2Âª global)  : " + format(FS_Mx_2g,2) + "\n";
    txt += "  FS_My (2Âª global)  : " + format(FS_My_2g,2) + "\n\n";

    txt += "2Âª ORDEM LOCAL (PILAR ESBELTO, FLUÃŠNCIA, I FISSURADA)\n";
    txt += "  Ï† (fluÃªncia)       : " + format(phi_creep,2) + "\n";
    txt += "  Îµsh                : " + format(eps_sh_â€°,2) + " â€°\n";
    txt += "  Î±_I (I fissurada)  : " + format(alpha_I,2) + "\n";
    txt += "  Ncr,x (local)      : " + format(Ncrx_loc_kN,1) + " kN\n";
    txt += "  Ncr,y (local)      : " + format(Ncry_loc_kN,1) + " kN\n";
    txt += "  Î³loc,x             : " + format(gamma_loc_x,2) + " (usado? " + (usarLocalX ? "sim" : "nÃ£o") + ")\n";
    txt += "  Î³loc,y             : " + format(gamma_loc_y,2) + " (usado? " + (usarLocalY ? "sim" : "nÃ£o") + ")\n";
    txt += "  Msd,x total        : " + format(Msdx2_tot_Nmm/1e6,2) + " kNÂ·m\n";
    txt += "  Msd,y total        : " + format(Msdy2_tot_Nmm/1e6,2) + " kNÂ·m\n";
    txt += "  FS_Mx (global+loc) : " + format(FS_Mx_tot,2) + "\n";
    txt += "  FS_My (global+loc) : " + format(FS_My_tot,2) + "\n\n";

    txt += "INTERAÃ‡ÃƒO BIAXIAL (BRESLER, MOMENTOS TOTAIS)\n";
    txt += "  Soma (Mx,tot/MRx + My,tot/MRy) : " + format(biax_ratio,3) + "\n";
    txt += "  FS_biax            : " + format(FS_biax,2) + "\n\n";

    txt += "EXCENTRICIDADES E SERVIÃ‡O\n";
    txt += "  Nser               : " + format(Nser_kN,1) + " kN\n";
    txt += "  Mser,x             : " + format(Mserx_kNm,1) + " kNÂ·m\n";
    txt += "  Mser,y             : " + format(Msery_kNm,1) + " kNÂ·m\n";
    txt += "  e1x (ELU)          : " + format(e1x_cm,2) + " cm\n";
    txt += "  e1y (ELU)          : " + format(e1y_cm,2) + " cm\n";
    txt += "  e0x (serviÃ§o)      : " + format(e0x_cm,2) + " cm\n";
    txt += "  e0y (serviÃ§o)      : " + format(e0y_cm,2) + " cm\n";
    txt += "  e_min geom,x       : " + format(e_min_geom_x_cm,2) + " cm\n";
    txt += "  e_min geom,y       : " + format(e_min_geom_y_cm,2) + " cm\n";
    txt += "  e_min normativa x  : " + format(e_min_norm_x_cm,2) + " cm\n";
    txt += "  e_min normativa y  : " + format(e_min_norm_y_cm,2) + " cm\n\n";

    txt += "CISALHAMENTO (VRd2 x Vsd)\n";
    txt += "  Vsd                : " + format(Vsd_kN,1) + " kN\n";
    txt += "  VRd2               : " + format(VRd2_N/1e3,2) + " kN\n";
    txt += "  Vc0                : " + format(Vc0_N/1e3,2) + " kN\n";
    txt += "  Î½Ed                : " + format(vEd_MPa,3) + " MPa\n";
    txt += "  Î½Rd2               : " + format(vRd2_MPa,3) + " MPa\n";
    txt += "  FS_V               : " + format(FS_V,2) + "\n\n";

    txt += "ESTRIBOS (REGRAS APROXIMADAS)\n";
    txt += "  Ã˜ estribo          : " + format(phi_st,1) + " mm\n";
    txt += "  s adotado          : " + format(s_st_cm,2) + " cm\n";
    txt += "  Limites tÃ­picos:\n";
    txt += "    s â‰¤ 16Â·Ã˜long     : " + format(s_lim1_mm/10,2) + " cm\n";
    txt += "    s â‰¤ 48Â·Ã˜estribo  : " + format(s_lim2_mm/10,2) + " cm\n";
    txt += "    s â‰¤ h (seÃ§Ã£o)    : " + format(s_lim3_mm/10,2) + " cm\n";
    txt += "    s â‰¤ 20 cm\n";
    txt += "  s_lim adotado      : " + format(s_lim_mm/10,2) + " cm\n\n";

    if (avisoNorma) {
      txt += "OBSERVAÃ‡Ã•ES DE VALIDADE NORMATIVA\n";
      txt += avisoNorma;
    }

    txt += "============================================================\n";
    txt += "FIM DO RELATÃ“RIO â€“ NÃºcleo especificado por Wilson Fernandes Junior\n";
    txt += "============================================================\n";

    lastReportTxt = txt;
  }

  function exportarTXT() {
    if (!lastReportTxt || lastReportTxt.trim() === "") {
      alert("Primeiro realize um cÃ¡lculo para gerar o relatÃ³rio em TXT.");
      return;
    }
    const blob = new Blob([lastReportTxt], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    const nomeObra = (document.getElementById("obra").value || "obra").replace(/[^a-z0-9_\-]+/gi, "_");
    const nomePilar = (document.getElementById("pilar").value || "pilar").replace(/[^a-z0-9_\-]+/gi, "_");
    a.href = url;
    a.download = `Relatorio_Pilar_${nomeObra}_${nomePilar}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>
</body>
</html>


