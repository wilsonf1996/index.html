<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Pilar CA ‚Äì NBR 6118 (N+M, 2¬™ ordem, V, Detalhamento)</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Arial, Helvetica, sans-serif;
    }
    html, body { margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #020617 0%, #020617 45%, #000 100%);
      color: #e5e7eb;
      font-size: 14px;
      line-height: 1.5;
    }
    .container {
      max-width: 1380px;
      margin: 20px auto 40px;
      padding: 22px 22px 26px;
      background: rgba(15, 23, 42, 0.97);
      border-radius: 20px;
      border: 1px solid #1f2937;
      box-shadow: 0 24px 70px rgba(0,0,0,0.9);
    }
    h1,h2,h3,h4 {
      margin-top: 0;
      font-weight: 700;
      letter-spacing: 0.01em;
    }
    h1 {
      text-align: center;
      font-size: 26px;
      margin-bottom: 4px;
    }
    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .credit {
      text-align: center;
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 12px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(148,163,184,0.5);
      background: radial-gradient(circle at top left, #0f172a, #020617);
      color: #e5e7eb;
    }
    .badge-dot {
      width: 6px; height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.6);
    }
    .project-bar {
      display: grid;
      grid-template-columns: 1.4fr 1.2fr 1.1fr 0.9fr;
      gap: 10px;
      margin-bottom: 14px;
      align-items: center;
      border-radius: 16px;
      padding: 10px 14px;
      background: radial-gradient(circle at top left, #020617, #020617 50%, #020617 100%);
      border: 1px solid #111827;
    }
    .project-field label {
      display: block;
      font-size: 11px;
      margin-bottom: 2px;
      color: #e5e7eb;
    }
    .project-field input {
      width: 100%;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 12px;
    }
    .project-field input:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px #22c55e55;
      background: #02081b;
    }
    .layout-grid {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr 1.2fr;
      gap: 16px;
      align-items: flex-start;
    }
    .card {
      background: radial-gradient(circle at top left, #020617, #020617 40%, #020617 100%);
      border-radius: 16px;
      padding: 12px 14px 14px;
      border: 1px solid #111827;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg,
        rgba(34,197,94,0.05),
        transparent 40%,
        transparent 60%,
        rgba(59,130,246,0.04)
      );
      pointer-events: none;
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
    }
    .card-header h2 {
      font-size: 15px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card-header h2 span.icon { font-size: 14px; opacity: 0.9; }
    .card-subtitle {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }
    .chip {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid #374151;
      color: #9ca3af;
      background: rgba(15,23,42,0.9);
    }
    label {
      display: block;
      font-size: 11px;
      margin-bottom: 3px;
      color: #e5e7eb;
    }
    input[type="number"], select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 12px;
      transition: border-color 0.1s, box-shadow 0.1s, background 0.1s;
    }
    input[type="number"]:focus, select:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px #22c55e55;
      background: #02081b;
    }
    .field { margin-bottom: 8px; position: relative; z-index: 1; }
    .units { font-size: 10px; color: #9ca3af; }
    .two-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .three-cols {
      display: grid;
      grid-template-columns: repeat(3,1fr);
      gap: 8px;
    }
    .field-group-title {
      margin: 8px 0 4px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .field-group-title::before {
      content: "";
      width: 10px; height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg,#22c55e,transparent);
    }
    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 8px;
      margin-bottom: 6px;
      justify-content: center;
      flex-wrap: wrap;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.1s, box-shadow 0.1s, background 0.15s, border-color 0.1s;
    }
    button.primary {
      background: linear-gradient(135deg,#22c55e,#16a34a);
      color: #022c22;
      box-shadow: 0 10px 26px rgba(34,197,94,0.4);
    }
    button.secondary {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #374151;
    }
    button.tertiary {
      background: #020617;
      color: #e5e7eb;
      border: 1px dashed #4b5563;
      font-size: 12px;
      padding-inline: 12px;
    }
    button span.icon { font-size: 14px; }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 15px 32px rgba(0,0,0,0.6);
    }
    button:active { transform: translateY(0); box-shadow: none; }
    .results {
      margin-top: 4px;
      border-radius: 14px;
      background: #020617;
      border: 1px solid #111827;
      padding: 12px 14px 14px;
      font-size: 13px;
      line-height: 1.6;
      max-height: 620px;
      overflow-y: auto;
      position: relative;
    }
    .results h3 {
      margin-top: 0;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .results h3::before {
      content: "";
      width: 5px; height: 18px;
      border-radius: 999px;
      background: linear-gradient(180deg,#22c55e,#0ea5e9);
    }
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      margin-left: 4px;
    }
    .tag-ok {
      background: rgba(22,163,74,0.12);
      color:#4ade80;
      border:1px solid rgba(22,163,74,0.7);
    }
    .tag-warn {
      background: rgba(234,179,8,0.12);
      color:#facc15;
      border:1px solid rgba(234,179,8,0.7);
    }
    .tag-err {
      background: rgba(239,68,68,0.12);
      color:#f87171;
      border:1px solid rgba(239,68,68,0.7);
    }
    .note {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
    }
    .section-title {
      margin-top: 10px;
      margin-bottom: 4px;
      font-weight: 700;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .section-title::before {
      content: "";
      width: 8px; height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.6);
    }
    ul { margin-top: 4px; margin-bottom: 6px; padding-left: 18px; }
    ul li { margin-bottom: 2px; }
    .results hr {
      border: none;
      border-top: 1px dashed #1f2937;
      margin: 10px 0;
    }
    .result-pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }
    .result-pill {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(15,23,42,0.9);
      border: 1px solid #1f2937;
      color: #cbd5f5;
    }
    .result-pill strong { color: #e5e7eb; }
    .footer-credit {
      margin-top: 18px;
      text-align: right;
      font-size: 11px;
      color: #6b7280;
    }
    ::-webkit-scrollbar { width: 7px; }
    ::-webkit-scrollbar-track {
      background: #020617;
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb {
      background: #111827;
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover { background: #1f2937; }

    @media (max-width:1100px) {
      .layout-grid {
        grid-template-columns: 1fr 1fr;
      }
      .layout-grid > .card:nth-child(3) {
        grid-column: 1 / -1;
      }
      .project-bar {
        grid-template-columns: 1.4fr 1.2fr;
      }
    }
    @media (max-width:800px) {
      .layout-grid { grid-template-columns: 1fr; }
      .project-bar { grid-template-columns: 1fr; border-radius: 14px; }
    }

    /* IMPRESS√ÉO / PDF */
    @media print {
      * { box-shadow:none !important; }
      body {
        background:#ffffff;
        color:#000000;
        font-size:10pt;
        line-height:1.4;
      }
      .container {
        box-shadow:none;
        border-radius:0;
        border:none;
        background:#ffffff;
        padding:10mm 8mm 10mm;
      }
      .project-bar { background:#ffffff; border-color:#000; }
      .card { border-color:#000; background:#ffffff; }
      .results { max-height:none; border-color:#000; }
      h1,h2,h3,h4 { color:#000; }
      .subtitle,.credit { color:#000; }
      .badge,.btn-row,.chip { display:none !important; }
      .section-title::before,.results h3::before {
        background:#000; box-shadow:none;
      }
      .tag-ok,.tag-warn,.tag-err {
        border-color:#000; color:#000; background:#fff;
      }
      input,select {
        border:1px solid #000;
        background:#fff;
        color:#000;
      }
      .footer-credit { color:#000; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Pilar de Concreto Armado ‚Äì NBR 6118</h1>
    <div class="subtitle">
      Verifica√ß√£o ULS (N+M, pilar curto, 2¬™ ordem global simplificada, cisalhamento) + taxas de a√ßo e detalhamento m√≠nimo.<br>
      Se√ß√£o retangular ou circular, concreto normal, armadura passiva.
    </div>
    <div class="credit">
      N√∫cleo de c√°lculo especificado por <b>Wilson Fernandes Junior</b>.
    </div>

    <div style="display:flex;justify-content:center;margin-bottom:10px;">
      <div class="badge">
        <span class="badge-dot"></span>
        N√∫cleo N‚ÄìM‚ÄìV com 2¬™ ordem (Œ≥z) + detalhamento de pilares
      </div>
    </div>

    <!-- Identifica√ß√£o -->
    <div class="project-bar">
      <div class="project-field">
        <label>Nome da obra</label>
        <input type="text" id="obra" placeholder="Ex: Residencial / Galp√£o / Infraestrutura">
      </div>
      <div class="project-field">
        <label>Nome do projeto</label>
        <input type="text" id="projeto" placeholder="Ex: Estruturas ‚Äì Bloco B">
      </div>
      <div class="project-field">
        <label>Identifica√ß√£o do pilar</label>
        <input type="text" id="pilar" placeholder="Ex: P1-E1">
      </div>
      <div class="project-field">
        <label>Eng. respons√°vel / CREA</label>
        <input type="text" id="engenheiro" placeholder="Ex: Eng. Fulano ‚Äì CREA 000000-0">
      </div>
    </div>

    <div class="layout-grid">
      <!-- Coluna 1 ‚Äì Materiais & Se√ß√£o -->
      <div class="card">
        <div class="card-header">
          <h2><span class="icon">üß±</span> Materiais & Se√ß√£o</h2>
          <span class="chip">Concreto, a√ßo, geometria</span>
        </div>
        <div class="card-subtitle">
          Escolha o tipo de se√ß√£o (retangular ou circular) e defina fck, fyk e geometria.
        </div>

        <div class="field-group-title">Materiais</div>
        <div class="two-cols">
          <div class="field">
            <label>fck (MPa)</label>
            <input type="number" id="fck" value="30" step="1">
          </div>
          <div class="field">
            <label>fyk barras (MPa)</label>
            <input type="number" id="fyk" value="500" step="10">
          </div>
          <div class="field">
            <label>fyk estribos (MPa)</label>
            <input type="number" id="fyk_st" value="500" step="10">
          </div>
          <div class="field">
            <label>Es (MPa) ‚Äì m√≥dulo do a√ßo</label>
            <input type="number" id="Es" value="210000" step="1000">
          </div>
        </div>

        <div class="field-group-title">Tipo de se√ß√£o</div>
        <div class="field">
          <label>Se√ß√£o transversal</label>
          <select id="tipo_secao">
            <option value="ret">Retangular (b √ó h)</option>
            <option value="circ">Circular (di√¢metro)</option>
          </select>
        </div>

        <div id="secao_ret" class="two-cols">
          <div class="field">
            <label>Largura b (cm)</label>
            <input type="number" id="b" value="25" step="0.5">
          </div>
          <div class="field">
            <label>Altura h (cm)</label>
            <input type="number" id="h" value="45" step="0.5">
          </div>
        </div>

        <div id="secao_circ" class="field" style="display:none;">
          <label>Di√¢metro D (cm)</label>
          <input type="number" id="D" value="35" step="0.5">
        </div>

        <div class="two-cols">
          <div class="field">
            <label>Cobrimento (cm)</label>
            <input type="number" id="cobertura" value="3" step="0.5">
          </div>
          <div class="field">
            <label>√ò barras longitudinais (mm)</label>
            <input type="number" id="phi_long" value="16" step="2">
          </div>
        </div>

        <div class="field-group-title">Armadura longitudinal global</div>
        <div class="two-cols">
          <div class="field">
            <label>As,total (cm¬≤) ‚Äì soma de todas as barras</label>
            <input type="number" id="As_tot" value="12.0" step="0.1">
          </div>
          <div class="field">
            <label>N¬∫ de barras longitudinais</label>
            <input type="number" id="n_barras" value="8" step="1">
          </div>
        </div>

        <div class="field-group-title">Estribos (detalhamento m√≠nimo)</div>
        <div class="two-cols">
          <div class="field">
            <label>√ò estribo (mm)</label>
            <input type="number" id="phi_stirrup" value="6.3" step="0.1">
          </div>
          <div class="field">
            <label>s (cm) ‚Äì espa√ßamento adotado</label>
            <input type="number" id="s_st" value="10" step="0.5">
          </div>
        </div>

        <div class="note">
          Suposi√ß√£o padr√£o: armadura distribu√≠da aproximadamente sim√©trica,
          metade em cada lado (tra√ß√£o/compress√£o) para flexo-compress√£o uniaxial.
        </div>
      </div>

      <!-- Coluna 2 ‚Äì Esfor√ßos, 2¬™ Ordem, Cisalhamento -->
      <div class="card">
        <div class="card-header">
          <h2><span class="icon">‚öôÔ∏è</span> Esfor√ßos & 2¬™ Ordem</h2>
          <span class="chip">N, M, V, Œ≥z</span>
        </div>
        <div class="card-subtitle">
          Informe esfor√ßos de c√°lculo no ELU, dados de comprimento equivalente e a√ß√µes de servi√ßo.
        </div>

        <div class="field-group-title">ULS ‚Äì Esfor√ßos de c√°lculo (primeira ordem)</div>
        <div class="two-cols">
          <div class="field">
            <label>Nsd (kN) ‚Äì compress√£o positiva</label>
            <input type="number" id="Nsd" value="1200" step="10">
          </div>
          <div class="field">
            <label>Msd (kN¬∑m) ‚Äì momento uniaxial</label>
            <input type="number" id="Msd" value="80" step="1">
            <span class="units">Momento em torno do eixo que gera tra√ß√£o em uma face principal.</span>
          </div>
          <div class="field">
            <label>Vsd (kN) ‚Äì cortante</label>
            <input type="number" id="Vsd" value="50" step="1">
          </div>
          <div class="field">
            <label>Dire√ß√£o do momento</label>
            <select id="dir_m">
              <option value="h">Eixo paralelo √† altura h (compress√£o em fibra pr√≥xima a h)</option>
              <option value="b">Eixo paralelo √† largura b</option>
            </select>
          </div>
        </div>

        <div class="field-group-title">Comprimento equivalente e 2¬™ ordem (Œ≥z)</div>
        <div class="two-cols">
          <div class="field">
            <label>‚Ñì0 (m) ‚Äì comprimento equivalente na dire√ß√£o de M</label>
            <input type="number" id="l0" value="3.0" step="0.1">
            <span class="units">Entre n√≥s de contraventamento da estrutura na dire√ß√£o considerada.</span>
          </div>
          <div class="field">
            <label>Tipo de quadro</label>
            <select id="tipo_quadro">
              <option value="n√£o-deslocavel">N√£o-desloc√°vel (n√≥s quase fixos)</option>
              <option value="deslocavel">Desloc√°vel (p√≥rtico com deslocamentos significativos)</option>
            </select>
          </div>
        </div>

        <div class="field-group-title">Combina√ß√£o de servi√ßo (para excentricidade, checagem b√°sica)</div>
        <div class="two-cols">
          <div class="field">
            <label>Nser (kN)</label>
            <input type="number" id="Nser" value="900" step="10">
          </div>
          <div class="field">
            <label>Mser (kN¬∑m)</label>
            <input type="number" id="Mser" value="60" step="1">
          </div>
        </div>

        <div class="note">
          Modelo de 2¬™ ordem: Œ≥z ‚âà 1/(1 ‚àí Nsd/Ncr), com Ncr = œÄ¬≤¬∑Ec¬∑I / ‚Ñì0¬≤.
          Msd,2¬™ = Œ≥z¬∑Msd, limitado a um valor m√°ximo para seguran√ßa.
        </div>
      </div>

      <!-- Coluna 3 ‚Äì Resultados -->
      <div class="card">
        <div class="card-header">
          <h2><span class="icon">üìä</span> Resultados</h2>
          <span class="chip">ULS + Detalhamento + TXT/PDF</span>
        </div>

        <div class="btn-row">
          <button class="primary" onclick="calcular()">
            <span class="icon">‚öôÔ∏è</span> Calcular
          </button>
          <button class="secondary" onclick="limparResultados()">
            <span class="icon">üßπ</span> Limpar
          </button>
          <button class="tertiary" onclick="window.print()">
            <span class="icon">üßæ</span> Gerar PDF
          </button>
          <button class="tertiary" onclick="exportarTXT()">
            <span class="icon">üìÑ</span> Exportar TXT
          </button>
        </div>

        <div class="results" id="resultados">
          <h3>Resultados aparecer√£o aqui‚Ä¶</h3>
          <p class="note">
            Informe materiais, se√ß√£o, armaduras, esfor√ßos e comprimento equivalente e clique em <b>Calcular</b>.<br>
            Use <b>Gerar PDF</b> (impress√£o em PDF do navegador) e <b>Exportar TXT</b> para relat√≥rio t√©cnico em texto.
          </p>
        </div>
      </div>
    </div>

    <div class="footer-credit">
      App de pilares em concreto armado ‚Äì n√∫cleo especificado por <b>Wilson Fernandes Junior</b>.
    </div>
  </div>

  <script>
    let lastReportTxt = "";

    function format(n, dec = 2) {
      if (isNaN(n) || !isFinite(n)) return "-";
      return n.toLocaleString("pt-BR", {
        minimumFractionDigits: dec,
        maximumFractionDigits: dec
      });
    }

    function limparResultados() {
      document.getElementById("resultados").innerHTML = `
        <h3>Resultados aparecer√£o aqui‚Ä¶</h3>
        <p class="note">
          Preencha dados de identifica√ß√£o, materiais, se√ß√£o, esfor√ßos e comprimento equivalente e clique em <b>Calcular</b>.
        </p>
      `;
      lastReportTxt = "";
    }

    // troca se√ß√£o ret / circ
    document.addEventListener("DOMContentLoaded", () => {
      const tipo = document.getElementById("tipo_secao");
      tipo.addEventListener("change", () => {
        const val = tipo.value;
        document.getElementById("secao_ret").style.display = (val === "ret") ? "grid" : "none";
        document.getElementById("secao_circ").style.display = (val === "circ") ? "block" : "none";
      });
    });

    // taxa m√≠nima de a√ßo para pilares (aprox. NBR: 0,4% a 8%)
    function rhoMinPilar() {
      return 0.004; // 0,4 %
    }
    function rhoMaxPilar() {
      return 0.08;  // 8 %
    }

    // resolve x para equil√≠brio N: Cc = 0,68 fcd b x; Cs = As_c fyd; T = As_t fyd
    function resolver_x_N(As_t_mm2, As_c_mm2, b_mm, fcd, fyd, Nsd_N, x_lim_ratio, d_mm) {
      const maxIter = 60;
      const tol = 1e-6;
      const x_max = x_lim_ratio * d_mm;
      let a = 1e-6;
      let c = x_max;

      function f(x) {
        const Cc = 0.68 * fcd * b_mm * x;
        const Cs = As_c_mm2 * fyd;
        const T = As_t_mm2 * fyd;
        const Nres = Cc + Cs - T;
        return Nres - Nsd_N;
      }

      let fa = f(a);
      let fc = f(c);
      if (fa * fc > 0) return null;

      let b = 0;
      for (let i = 0; i < maxIter; i++) {
        b = 0.5 * (a + c);
        const fb = f(b);
        if (Math.abs(fb) < tol) break;
        if (fa * fb < 0) { c = b; fc = fb; } else { a = b; fa = fb; }
      }
      return b;
    }

    function calcular() {
      const fck = parseFloat(document.getElementById("fck").value);
      const fyk = parseFloat(document.getElementById("fyk").value);
      const fyk_st = parseFloat(document.getElementById("fyk_st").value);
      const Es = parseFloat(document.getElementById("Es").value);
      const tipo_secao = document.getElementById("tipo_secao").value;
      const b_cm = parseFloat(document.getElementById("b").value || "0");
      const h_cm = parseFloat(document.getElementById("h").value || "0");
      const D_cm = parseFloat(document.getElementById("D").value || "0");
      const cob_cm = parseFloat(document.getElementById("cobertura").value);
      const phi_long = parseFloat(document.getElementById("phi_long").value);
      const As_tot_cm2 = parseFloat(document.getElementById("As_tot").value);
      const n_barras = parseInt(document.getElementById("n_barras").value, 10);
      const phi_st = parseFloat(document.getElementById("phi_stirrup").value);
      const s_st_cm = parseFloat(document.getElementById("s_st").value);

      const Nsd_kN = parseFloat(document.getElementById("Nsd").value);
      const Msd_kNm = parseFloat(document.getElementById("Msd").value);
      const Vsd_kN = parseFloat(document.getElementById("Vsd").value);
      const dir_m = document.getElementById("dir_m").value;
      const l0_m = parseFloat(document.getElementById("l0").value);
      const tipo_quadro = document.getElementById("tipo_quadro").value;
      const Nser_kN = parseFloat(document.getElementById("Nser").value);
      const Mser_kNm = parseFloat(document.getElementById("Mser").value);

      const obra = document.getElementById("obra").value || "-";
      const projeto = document.getElementById("projeto").value || "-";
      const pilarID = document.getElementById("pilar").value || "-";
      const engenheiro = document.getElementById("engenheiro").value || "-";

      const resDiv = document.getElementById("resultados");

      if (
        [fck,fyk,fyk_st,Es,cob_cm,phi_long,As_tot_cm2,n_barras,phi_st,s_st_cm,
         Nsd_kN,Msd_kNm,l0_m].some(v => isNaN(v) || v <= 0)
      ) {
        resDiv.innerHTML = `
          <h3>Erro de entrada</h3>
          <p class="note">
            Verifique se todos os campos principais (materiais, se√ß√£o, esfor√ßos, comprimento equivalente) est√£o preenchidos com valores num√©ricos positivos.
          </p>
        `;
        lastReportTxt = "";
        return;
      }
      if (Nsd_kN <= 0) {
        resDiv.innerHTML = `
          <h3>Erro ‚Äì Nsd</h3>
          <p class="note">O modelo atual considera apenas pilares em compress√£o (Nsd &gt; 0). Verifique o sinal da for√ßa normal.</p>
        `;
        lastReportTxt = "";
        return;
      }

      // convers√µes geom√©tricas
      const cob_mm = cob_cm * 10;
      const phi_long_mm = phi_long; // j√° em mm

      let b_mm, h_mm, D_mm, tipoDesc;
      if (tipo_secao === "ret") {
        if (b_cm <= 0 || h_cm <= 0) {
          resDiv.innerHTML = `<h3>Erro na se√ß√£o retangular</h3><p class="note">b e h devem ser &gt; 0.</p>`;
          lastReportTxt = "";
          return;
        }
        b_mm = b_cm * 10;
        h_mm = h_cm * 10;
        D_mm = null;
        tipoDesc = `Retangular ${format(b_cm,1)} √ó ${format(h_cm,1)} cm`;
      } else {
        if (D_cm <= 0) {
          resDiv.innerHTML = `<h3>Erro na se√ß√£o circular</h3><p class="note">Di√¢metro deve ser &gt; 0.</p>`;
          lastReportTxt = "";
          return;
        }
        D_mm = D_cm * 10;
        // se√ß√£o circular ‚Üí para flex√£o uniaxial usamos b equivalente = D, h equivalente = D
        b_mm = D_mm;
        h_mm = D_mm;
        tipoDesc = `Circular D = ${format(D_cm,1)} cm`;
      }

      const d_mm = h_mm - cob_mm - phi_long_mm/2;
      const dLinha_mm = cob_mm + phi_long_mm/2;
      if (d_mm <= 0) {
        resDiv.innerHTML = `<h3>Geometria inv√°lida</h3><p class="note">d ficou negativo ou muito pequeno. Verifique h, cobrimento e di√¢metro das barras.</p>`;
        lastReportTxt = "";
        return;
      }

      // materiais ‚Äì resist√™ncias
      const gamma_c = 1.4;
      const gamma_s = 1.15;
      const alpha_cc = 0.85;

      const fcd = alpha_cc * fck / gamma_c;
      const fyd = fyk / gamma_s;
      const fydw_lim = 435;
      const fydw = Math.min(fyk_st / gamma_s, fydw_lim);

      const fctm = 0.3 * Math.pow(fck, 2.0/3.0);
      const fctk_inf = 0.7 * fctm;
      const fctd = fctk_inf / gamma_c;

      const Nsd_N = Nsd_kN * 1e3;
      const Msd_Nmm = Msd_kNm * 1e6;
      const Vsd_N = Vsd_kN * 1e3;

      // √°rea e in√©rcias
      let Ac_mm2, Ix_m4, Iy_m4;
      if (tipo_secao === "ret") {
        Ac_mm2 = b_mm * h_mm;
        const b_m = b_mm / 1000, h_m = h_mm / 1000;
        Ix_m4 = b_m * Math.pow(h_m,3) / 12; // eixo x (em torno de b)
        Iy_m4 = h_m * Math.pow(b_m,3) / 12;
      } else {
        Ac_mm2 = Math.PI * Math.pow(D_mm,2) / 4;
        const D_m = D_mm / 1000;
        const I_m4 = Math.PI * Math.pow(D_m,4) / 64;
        Ix_m4 = I_m4;
        Iy_m4 = I_m4;
      }

      // dire√ß√£o do momento: usamos in√©rcia compat√≠vel
      const I_m4_dir = (dir_m === "h") ? Ix_m4 : Iy_m4;

      // taxas de armadura
      const As_tot_mm2 = As_tot_cm2 * 100;
      const rho = As_tot_mm2 / Ac_mm2;
      const rho_min = rhoMinPilar();
      const rho_max = rhoMaxPilar();

      let taxaTag = "";
      if (rho < rho_min - 1e-6) {
        taxaTag = `<span class="tag tag-err">œÅ &lt; œÅm√≠n (0,4% para pilares)</span>`;
      } else if (rho > rho_max + 1e-6) {
        taxaTag = `<span class="tag tag-err">œÅ &gt; œÅm√°x (8% para pilares)</span>`;
      } else {
        taxaTag = `<span class="tag tag-ok">Taxa de armadura dentro de 0,4%‚Äì8%</span>`;
      }

      // supomos As_t = As_c = As_tot/2
      const As_t_mm2 = As_tot_mm2 / 2;
      const As_c_mm2 = As_tot_mm2 / 2;

      // limite de ductilidade para pilares (usamos mesmo x/d dos beams: 0,45 para fck<=50)
      const x_lim_ratio = 0.45;
      const x_lim_mm = x_lim_ratio * d_mm;

      // equil√≠brio N para obter x e Mrd
      const x_mm = resolver_x_N(As_t_mm2, As_c_mm2, b_mm, fcd, fyd, Nsd_N, x_lim_ratio, d_mm);
      const resDivInner = document.getElementById("resultados");
      if (x_mm === null || x_mm <= 0 || x_mm > x_lim_mm) {
        resDivInner.innerHTML = `
          <h3>Falha no equil√≠brio N‚ÄìM</h3>
          <p class="note">
            Com a se√ß√£o e armadura informadas, n√£o foi poss√≠vel equilibrar Nsd com x/d ‚â§ ${format(x_lim_ratio,2)}.
            Isso indica que o pilar est√° supersolicitado em compress√£o ou com armadura mal distribu√≠da para o modelo adotado.
          </p>
        `;
        lastReportTxt = "";
        return;
      }

      const x_d = x_mm / d_mm;

      const Cc_N = 0.68 * fcd * b_mm * x_mm;
      const Cs_N = As_c_mm2 * fyd;
      const T_N = As_t_mm2 * fyd;
      const N_int = Cc_N + Cs_N - T_N;
      const err_N = Math.abs(N_int - Nsd_N) / Math.max(Math.abs(Nsd_N),1e-3) * 100;

      const yC_mm = 0.4 * x_mm;
      const yS_mm = dLinha_mm;
      const yT_mm = d_mm;
      const Mrd_Nmm = Cc_N * yC_mm + Cs_N * yS_mm - T_N * yT_mm;
      const FS_M1 = Mrd_Nmm / Msd_Nmm;

      // deforma√ß√µes no ELU
      const eps_cu = 0.0035;
      const eps_c = eps_cu;
      const eps_s = (eps_c * (d_mm - x_mm)) / x_mm;
      const eps_s_comp = (eps_c * (x_mm - dLinha_mm)) / x_mm;
      const eps_y = fyd / Es;
      const status_eps_s = (eps_s >= eps_y) ? "a√ßo tracionado no escoamento" : "a√ßo tracionado abaixo do escoamento";
      const status_eps_s_comp = (eps_s_comp >= eps_y) ? "a√ßo comprimido no escoamento" : "a√ßo comprimido abaixo do escoamento";

      let dominio_msg = "";
      if (x_d <= 0.259) dominio_msg = "Dom√≠nio 2 (flexo-compress√£o moderada, a√ßo bem tracionado).";
      else if (x_d <= 0.628) dominio_msg = "Dom√≠nio 3 (compress√£o mais intensa, a√ßo ainda em escoamento).";
      else dominio_msg = "Dom√≠nio 4 (n√£o desej√°vel para pilares).";

      let dominio_tag = "";
      if (x_d <= x_lim_ratio + 1e-4) {
        dominio_tag = `<span class="tag tag-ok">x/d ‚â§ ${format(x_lim_ratio,2)} (ductilidade m√≠nima atendida)</span>`;
      } else {
        dominio_tag = `<span class="tag tag-err">x/d &gt; limite de ductilidade adotado</span>`;
      }

      // 2¬™ ordem global (Œ≥z)
      const Eci = 5600 * Math.sqrt(fck);
      const Ec = 0.85 * Eci;
      const l0_m_val = l0_m;
      const Ncr_kN = Math.PI*Math.PI*Ec*I_m4_dir / (l0_m_val*l0_m_val) / 1e3;
      let gamma_z = 1.0;
      let gammaTag = "";
      if (Ncr_kN > 0) {
        gamma_z = 1 / (1 - Nsd_kN / Ncr_kN);
        let gamma_max = (tipo_quadro === "deslocavel") ? 1.4 : 1.3;
        if (gamma_z < 1.0) gamma_z = 1.0;
        if (gamma_z > gamma_max) gamma_z = gamma_max;
        gammaTag = (gamma_z > 1.0)
          ? `<span class="tag tag-warn">2¬™ ordem considerada (Œ≥z ‚âà ${format(gamma_z,2)})</span>`
          : `<span class="tag tag-ok">Efeitos de 2¬™ ordem pequenos (Œ≥z ‚âà 1,0)</span>`;
      } else {
        gammaTag = `<span class="tag tag-err">N√£o foi poss√≠vel calcular Ncr (verifique se√ß√£o e ‚Ñì0).</span>`;
      }
      const Msd2_Nmm = gamma_z * Msd_Nmm;
      const FS_M2 = Mrd_Nmm / Msd2_Nmm;

      // excentricidades
      const e1_m = Msd_kNm / Nsd_kN;
      const e1_cm = e1_m * 100;
      const e0m_m = Mser_kNm / Math.max(Nser_kN,1e-3);
      const e0m_cm = e0m_m * 100;
      const e_min_geom_cm = Math.max(h_cm/30, b_cm/30, 2); // bem simplificado
      const e_min_norm_cm = Math.max(e_min_geom_cm, 2);    // regra b√°sica de muitos livros

      // cisalhamento (VRd2 x Vsd)
      const alpha_v2 = 1.0 - fck / 250.0;
      const VRd2_N = 0.27 * alpha_v2 * fcd * b_mm * d_mm;
      const Vc0_N = 0.6 * fctd * b_mm * d_mm;
      const vEd_MPa = Vsd_N / (b_mm * d_mm);
      const vRd2_MPa = VRd2_N / (b_mm * d_mm);
      const FS_V = VRd2_N / Vsd_N;

      let cis_tag = "";
      let cis_msg = "";
      if (Vsd_N <= 1e-3) {
        cis_tag = `<span class="tag tag-ok">Sem esfor√ßo cortante relevante informado</span>`;
        cis_msg = "Vsd ‚âà 0, sem verifica√ß√£o relevante de cisalhamento.";
      } else if (Vsd_N > VRd2_N) {
        cis_tag = `<span class="tag tag-err">Vsd &gt; VRd2 (compress√£o diagonal n√£o verificada)</span>`;
        cis_msg = "√â necess√°rio rever se√ß√£o / fck ou introduzir elementos pr√≥prios para resistir ao cisalhamento.";
      } else {
        cis_tag = `<span class="tag tag-ok">Vsd ‚â§ VRd2 (compress√£o diagonal verificada)</span>`;
        cis_msg = "Para pilares usuais, o cisalhamento tende a ser pouco cr√≠tico; este check garante VRd2 ‚â• Vsd.";
      }

      // detalhamento de estribos (regras aproximadas)
      const s_st_mm = s_st_cm * 10;
      const phi_long_mm_max = phi_long_mm;
      const s_lim1_mm = 16*phi_long_mm_max;
      const s_lim2_mm = 48*phi_st;
      const s_lim3_mm = h_mm;
      const s_lim4_mm = 200; // 20 cm
      const s_lim_mm = Math.min(s_lim1_mm,s_lim2_mm,s_lim3_mm,s_lim4_mm);
      let estriboTag = "";
      if (s_st_mm <= s_lim_mm + 1e-6) {
        estriboTag = `<span class="tag tag-ok">Espa√ßamento de estribos dentro dos limites usuais (‚â§ ${format(s_lim_mm/10,1)} cm)</span>`;
      } else {
        estriboTag = `<span class="tag tag-err">s adotado &gt; limites normativos aproximados (m√°x ‚âà ${format(s_lim_mm/10,1)} cm)</span>`;
      }

      let avisoNorma = "";
      if (fck < 20 || fck > 50) {
        avisoNorma += "‚Ä¢ fck fora da faixa t√≠pica de concreto normal (20‚Äì50 MPa). Revise validade do modelo.\n";
      }
      if (fyk < 400 || fyk > 650) {
        avisoNorma += "‚Ä¢ fyk barras fora da faixa usual (CA-25/50/60). Usar com cautela.\n";
      }
      if (fyk_st < 400 || fyk_st > 650) {
        avisoNorma += "‚Ä¢ fyk estribos fora da faixa usual. Usar com cautela.\n";
      }

      const resultPills = `
        <div class="result-pill-row">
          <div class="result-pill">Nsd: <strong>${format(Nsd_kN,1)}</strong> kN</div>
          <div class="result-pill">Msd (1¬™): <strong>${format(Msd_kNm,1)}</strong> kN¬∑m</div>
          <div class="result-pill">Œ≥z: <strong>${format(gamma_z,2)}</strong></div>
          <div class="result-pill">Msd (2¬™): <strong>${format(Msd2_Nmm/1e6,2)}</strong> kN¬∑m</div>
          <div class="result-pill">FS_M (1¬™): <strong>${format(FS_M1,2)}</strong></div>
          <div class="result-pill">FS_M (2¬™): <strong>${format(FS_M2,2)}</strong></div>
          <div class="result-pill">Œª (aprox.): <strong>${format(
            (l0_m*1000)/Math.sqrt(I_m4_dir*1e12/Ac_mm2),2
          )}</strong></div>
        </div>
      `;

      document.getElementById("resultados").innerHTML = `
        <h3>Resumo dos resultados</h3>
        ${resultPills}

        <p class="section-title">Identifica√ß√£o</p>
        <ul>
          <li><b>Obra:</b> ${obra}</li>
          <li><b>Projeto:</b> ${projeto}</li>
          <li><b>Pilar:</b> ${pilarID}</li>
          <li><b>Eng. respons√°vel / CREA:</b> ${engenheiro}</li>
        </ul>

        <p class="section-title">Se√ß√£o e materiais</p>
        <ul>
          <li>Se√ß√£o: <strong>${tipoDesc}</strong></li>
          <li>fck = <strong>${format(fck,0)}</strong> MPa, fyk barras = <strong>${format(fyk,0)}</strong> MPa, fyk estribos = <strong>${format(fyk_st,0)}</strong> MPa</li>
          <li>Cobrimento = <strong>${format(cob_cm,2)}</strong> cm, √ò barras long. = <strong>${format(phi_long_mm,1)}</strong> mm</li>
          <li>d ‚âà <strong>${format(d_mm/10,2)}</strong> cm, d' ‚âà <strong>${format(dLinha_mm/10,2)}</strong> cm</li>
          <li>fcd = <strong>${format(fcd,2)}</strong> MPa, fyd = <strong>${format(fyd,2)}</strong> MPa, fydw ‚âà <strong>${format(fydw,2)}</strong> MPa</li>
        </ul>

        <p class="section-title">Armadura longitudinal</p>
        ${taxaTag}
        <ul>
          <li>As,total = <strong>${format(As_tot_mm2,1)}</strong> mm¬≤ = <strong>${format(As_tot_cm2,2)}</strong> cm¬≤</li>
          <li>œÅ = As/Ac ‚âà <strong>${format(rho*100,3)}</strong> %</li>
          <li>œÅm√≠n (pilar) ‚âà <strong>${format(rho_min*100,3)}</strong> % ‚Üí As,m√≠n ‚âà <strong>${format(rho_min*Ac_mm2,1)}</strong> mm¬≤</li>
          <li>œÅm√°x (pilar) ‚âà <strong>${format(rho_max*100,3)}</strong> % ‚Üí As,m√°x ‚âà <strong>${format(rho_max*Ac_mm2,1)}</strong> mm¬≤</li>
          <li>N¬∫ de barras longitudinais: <strong>${n_barras}</strong></li>
          <li>Hip√≥tese: As(trac) ‚âà As(comp) ‚âà As,total / 2</li>
        </ul>

        <h4>1) ULS ‚Äì Flexo-Compress√£o N+M (pilar curto)</h4>
        ${dominio_tag}
        <ul>
          <li>Nsd = <strong>${format(Nsd_kN,1)}</strong> kN (compress√£o)</li>
          <li>Msd (1¬™ ordem) = <strong>${format(Msd_kNm,1)}</strong> kN¬∑m</li>
          <li>x = <strong>${format(x_mm,2)}</strong> mm ‚áí x/d = <strong>${format(x_d,3)}</strong></li>
          <li>For√ßas internas: Cc ‚âà <strong>${format(Cc_N/1e3,2)}</strong> kN, Cs ‚âà <strong>${format(Cs_N/1e3,2)}</strong> kN, T ‚âà <strong>${format(T_N/1e3,2)}</strong> kN</li>
          <li>N_int = Cc + Cs ‚àí T ‚âà <strong>${format(N_int/1e3,2)}</strong> kN ‚áí erro |N_int‚àíNsd| ‚âà <strong>${format(err_N,2)}</strong> %</li>
          <li>Mrd (N-M) ‚âà <strong>${format(Mrd_Nmm/1e6,2)}</strong> kN¬∑m</li>
          <li>FS_M (1¬™ ordem) = Mrd / Msd ‚âà <strong>${format(FS_M1,2)}</strong></li>
        </ul>
        <p class="note">
          Dom√≠nio aproximado: ${dominio_msg}
        </p>

        <p class="section-title">Deforma√ß√µes no ELU</p>
        <ul>
          <li>Œµc topo ‚âà <strong>${format(eps_c*1000,3)}</strong> ‚Ä∞</li>
          <li>Œµs tra√ß√£o ‚âà <strong>${format(eps_s*1000,3)}</strong> ‚Ä∞, Œµy ‚âà <strong>${format(eps_y*1000,3)}</strong> ‚Ä∞ ‚Üí ${status_eps_s}</li>
          <li>Œµs' compress√£o ‚âà <strong>${format(eps_s_comp*1000,3)}</strong> ‚Ä∞ ‚Üí ${status_eps_s_comp}</li>
        </ul>

        <h4>2) 2¬™ ordem global (Œ≥z) ‚Äì P‚ÄìŒî</h4>
        ${gammaTag}
        <ul>
          <li>Ec ‚âà <strong>${format(Ec,0)}</strong> MPa (0,85¬∑Eci)</li>
          <li>‚Ñì0 = <strong>${format(l0_m,2)}</strong> m, tipo de quadro: <strong>${tipo_quadro}</strong></li>
          <li>Ncr (dire√ß√£o do momento) ‚âà <strong>${format(Ncr_kN,1)}</strong> kN</li>
          <li>Œ≥z ‚âà <strong>${format(gamma_z,2)}</strong></li>
          <li>Msd,2¬™ = Œ≥z¬∑Msd ‚âà <strong>${format(Msd2_Nmm/1e6,2)}</strong> kN¬∑m</li>
          <li>FS_M (2¬™ ordem) = Mrd / (Œ≥z¬∑Msd) ‚âà <strong>${format(FS_M2,2)}</strong></li>
        </ul>

        <h4>3) Excentricidades (cheque r√°pido de coer√™ncia)</h4>
        <ul>
          <li>e1 = Msd / Nsd ‚âà <strong>${format(e1_cm,2)}</strong> cm (ELU)</li>
          <li>e0,ser = Mser / Nser ‚âà <strong>${format(e0m_cm,2)}</strong> cm (servi√ßo)</li>
          <li>e_min geom√©trica aprox. ‚âà <strong>${format(e_min_geom_cm,2)}</strong> cm</li>
          <li>e_min normativa simplificada (m√°x entre geom. e 2 cm) ‚âà <strong>${format(e_min_norm_cm,2)}</strong> cm</li>
        </ul>

        <hr>

        <h4>4) Cisalhamento (VRd2 x Vsd)</h4>
        ${cis_tag}
        <ul>
          <li>Vsd = <strong>${format(Vsd_kN,1)}</strong> kN</li>
          <li>VRd2 ‚âà <strong>${format(VRd2_N/1e3,1)}</strong> kN ‚áí ŒΩRd2 ‚âà <strong>${format(vRd2_MPa,3)}</strong> MPa</li>
          <li>ŒΩEd ‚âà <strong>${format(vEd_MPa,3)}</strong> MPa</li>
          <li>FS_V = VRd2 / Vsd ‚âà <strong>${format(FS_V,2)}</strong></li>
          <li>${cis_msg}</li>
        </ul>

        <h4>5) Detalhamento ‚Äì Estribos (regras aproximadas)</h4>
        ${estriboTag}
        <ul>
          <li>√ò estribo = <strong>${format(phi_st,1)}</strong> mm, s adotado = <strong>${format(s_st_cm,1)}</strong> cm</li>
          <li>Limites t√≠picos (NBR, aproximados):
            <ul>
              <li>s ‚â§ 16¬∑√òlong ‚Üí ${format(s_lim1_mm/10,1)} cm</li>
              <li>s ‚â§ 48¬∑√òestribo ‚Üí ${format(s_lim2_mm/10,1)} cm</li>
              <li>s ‚â§ h (dimens√£o da se√ß√£o) ‚Üí ${format(s_lim3_mm/10,1)} cm</li>
              <li>s ‚â§ 20 cm</li>
            </ul>
          </li>
          <li>s_lim adotado ‚âà <strong>${format(s_lim_mm/10,1)}</strong> cm</li>
        </ul>

        <hr>

        <p class="note">
          Este modelo considera pilar curto com flexo-compress√£o uniaxial, bloco retangular equivalente (0,68¬∑fcd),
          a√ßo tracionado/comprimido a fyd e 2¬™ ordem global simplificada via Œ≥z.  
          Para pilares muito esbeltos, p√≥rticos complexos, efeitos localizados (2¬™ ordem local) e dimensionamento fino de armaduras,
          recomenda-se uso de software especializado (TQS, Eberick, etc.) e leitura detalhada da NBR 6118 e livros de pilares.
        </p>
        ${
          avisoNorma
            ? `<p class="note"><b>Observa√ß√µes de validade:</b><br>${avisoNorma.replace(/\n/g,"<br>")}</p>`
            : ""
        }
      `;

      // TXT organizado
      let txt = "";
      txt += "============================================================\n";
      txt += "RELAT√ìRIO DE PILAR DE CONCRETO ARMADO - NBR 6118\n";
      txt += "============================================================\n\n";
      txt += "IDENTIFICA√á√ÉO\n";
      txt += "  Obra   : " + obra + "\n";
      txt += "  Projeto: " + projeto + "\n";
      txt += "  Pilar  : " + pilarID + "\n";
      txt += "  Eng. resp. / CREA: " + engenheiro + "\n\n";
      txt += "  N√∫cleo de c√°lculo especificado por: Wilson Fernandes Junior\n\n";

      txt += "SE√á√ÉO E MATERIAIS\n";
      txt += "  Se√ß√£o transversal   : " + tipoDesc + "\n";
      txt += "  fck                 : " + format(fck,0) + " MPa\n";
      txt += "  fyk barras          : " + format(fyk,0) + " MPa\n";
      txt += "  fyk estribos        : " + format(fyk_st,0) + " MPa\n";
      txt += "  Es                  : " + format(Es,0) + " MPa\n";
      txt += "  Cobrimento          : " + format(cob_cm,2) + " cm\n";
      txt += "  √ò barras long.      : " + format(phi_long_mm,1) + " mm\n";
      txt += "  d                   : " + format(d_mm/10,2) + " cm\n";
      txt += "  d'                  : " + format(dLinha_mm/10,2) + " cm\n";
      txt += "  fcd                 : " + format(fcd,2) + " MPa\n";
      txt += "  fyd                 : " + format(fyd,2) + " MPa\n";
      txt += "  fydw                : " + format(fydw,2) + " MPa\n";
      txt += "  fctm                : " + format(fctm,2) + " MPa\n";
      txt += "  fctd                : " + format(fctd,2) + " MPa\n\n";

      txt += "ARMADURA LONGITUDINAL\n";
      txt += "  As,total            : " + format(As_tot_mm2,1) + " mm¬≤ (" + format(As_tot_cm2,2) + " cm¬≤)\n";
      txt += "  N¬∫ de barras        : " + n_barras + "\n";
      txt += "  Taxa œÅ (As/Ac)      : " + format(rho*100,3) + " %\n";
      txt += "  œÅm√≠n (pilar)        : " + format(rho_min*100,3) + " %\n";
      txt += "  œÅm√°x (pilar)        : " + format(rho_max*100,3) + " %\n";
      txt += "  Hip√≥tese            : As tra√ß√£o ‚âà As compress√£o ‚âà As,total/2\n\n";

      txt += "ESFOR√áOS ULTIMOS (ELU)\n";
      txt += "  Nsd                 : " + format(Nsd_kN,1) + " kN (compress√£o)\n";
      txt += "  Msd (1¬™ ordem)      : " + format(Msd_kNm,1) + " kN¬∑m\n";
      txt += "  Vsd                 : " + format(Vsd_kN,1) + " kN\n";
      txt += "  Dire√ß√£o do momento  : " + (dir_m === "h" ? "eixo paralelo √† altura h" : "eixo paralelo √† largura b") + "\n\n";

      txt += "EQUIL√çBRIO N‚ÄìM (PILAR CURTO)\n";
      txt += "  x                   : " + format(x_mm,2) + " mm (x/d = " + format(x_d,3) + ")\n";
      txt += "  Cc                  : " + format(Cc_N/1e3,2) + " kN\n";
      txt += "  Cs                  : " + format(Cs_N/1e3,2) + " kN\n";
      txt += "  T                   : " + format(T_N/1e3,2) + " kN\n";
      txt += "  N_int               : " + format(N_int/1e3,2) + " kN\n";
      txt += "  Erro relativo N     : " + format(err_N,2) + " %\n";
      txt += "  Mrd (N-M)           : " + format(Mrd_Nmm/1e6,2) + " kN¬∑m\n";
      txt += "  FS_M (1¬™ ordem)     : " + format(FS_M1,2) + "\n\n";

      txt += "DEFORMA√á√ïES NO ELU\n";
      txt += "  Œµc topo             : " + format(eps_c*1000,3) + " ‚Ä∞\n";
      txt += "  Œµs tra√ß√£o           : " + format(eps_s*1000,3) + " ‚Ä∞ (" + status_eps_s + ")\n";
      txt += "  Œµs' compress√£o      : " + format(eps_s_comp*1000,3) + " ‚Ä∞ (" + status_eps_s_comp + ")\n";
      txt += "  Dom√≠nio (aprox.)    : " + dominio_msg + "\n\n";

      txt += "2¬™ ORDEM GLOBAL (Œ≥z)\n";
      txt += "  Eci                 : " + format(Eci,0) + " MPa\n";
      txt += "  Ec                  : " + format(Ec,0) + " MPa\n";
      txt += "  ‚Ñì0                  : " + format(l0_m,2) + " m\n";
      txt += "  Tipo de quadro      : " + tipo_quadro + "\n";
      txt += "  Ncr                 : " + format(Ncr_kN,1) + " kN\n";
      txt += "  Œ≥z                  : " + format(gamma_z,2) + "\n";
      txt += "  Msd,2¬™              : " + format(Msd2_Nmm/1e6,2) + " kN¬∑m\n";
      txt += "  FS_M (2¬™ ordem)     : " + format(FS_M2,2) + "\n\n";

      txt += "EXCENTRICIDADES (CHEQUE B√ÅSICO)\n";
      txt += "  e1 (ELU)            : " + format(e1_cm,2) + " cm\n";
      txt += "  Nser                : " + format(Nser_kN,1) + " kN\n";
      txt += "  Mser                : " + format(Mser_kNm,1) + " kN¬∑m\n";
      txt += "  e0 (servi√ßo)        : " + format(e0m_cm,2) + " cm\n";
      txt += "  e_min geom          : " + format(e_min_geom_cm,2) + " cm\n";
      txt += "  e_min normativa (ap): " + format(e_min_norm_cm,2) + " cm\n\n";

      txt += "CISALHAMENTO (VERIFICA√á√ÉO VRd2)\n";
      txt += "  Vsd                 : " + format(Vsd_kN,1) + " kN\n";
      txt += "  VRd2                : " + format(VRd2_N/1e3,2) + " kN\n";
      txt += "  ŒΩEd                 : " + format(vEd_MPa,3) + " MPa\n";
      txt += "  ŒΩRd2                : " + format(vRd2_MPa,3) + " MPa\n";
      txt += "  FS_V                : " + format(FS_V,2) + "\n\n";

      txt += "DETALHAMENTO ‚Äì ESTRIBOS (REGRAS APROXIMADAS)\n";
      txt += "  √ò estribo           : " + format(phi_st,1) + " mm\n";
      txt += "  s adotado           : " + format(s_st_cm,2) + " cm\n";
      txt += "  Limites t√≠picos     :\n";
      txt += "    s ‚â§ 16¬∑√òlong      : " + format(s_lim1_mm/10,2) + " cm\n";
      txt += "    s ‚â§ 48¬∑√òestribo   : " + format(s_lim2_mm/10,2) + " cm\n";
      txt += "    s ‚â§ h (se√ß√£o)     : " + format(s_lim3_mm/10,2) + " cm\n";
      txt += "    s ‚â§ 20 cm\n";
      txt += "  s_lim adotado       : " + format(s_lim_mm/10,2) + " cm\n\n";

      if (avisoNorma) {
        txt += "OBSERVA√á√ïES DE VALIDADE NORMATIVA\n";
        txt += avisoNorma;
      }

      txt += "============================================================\n";
      txt += "FIM DO RELAT√ìRIO ‚Äì N√∫cleo especificado por Wilson Fernandes Junior\n";
      txt += "============================================================\n";

      lastReportTxt = txt;
    }

    function exportarTXT() {
      if (!lastReportTxt || lastReportTxt.trim() === "") {
        alert("Primeiro realize um c√°lculo para gerar o relat√≥rio em TXT.");
        return;
      }
      const blob = new Blob([lastReportTxt], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const nomeObra = (document.getElementById("obra").value || "obra").replace(/[^a-z0-9_\-]+/gi, "_");
      const nomePilar = (document.getElementById("pilar").value || "pilar").replace(/[^a-z0-9_\-]+/gi, "_");
      a.href = url;
      a.download = `Relatorio_Pilar_${nomeObra}_${nomePilar}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
