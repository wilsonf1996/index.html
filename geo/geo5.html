<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geo App</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
  <style>
    #map {
      height: 400px;
      width: 100%;
    }
    #list-container {
      margin-top: 20px;
    }
    .list-item {
      padding: 10px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Geo App</h1>
  <div id="map"></div>
  <div id="list-container"></div>

  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Inicializando o Firebase
    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database().ref('registros');

    let map;
    let markers = [];
    let locationList = [];

    // Inicializa o mapa
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: -23.5505, lng: -46.6333 }, // Ponto central (São Paulo, por exemplo)
        zoom: 8
      });
    }

    // Limpa os marcadores do mapa
    function clearMapMarkers() {
      for (let i = 0; i < markers.length; i++) {
        markers[i].setMap(null);
      }
      markers = [];
    }

    // Atualiza os pontos no mapa
    function updateMapMarkers(locations) {
      clearMapMarkers();

      locations.forEach(location => {
        const marker = new google.maps.Marker({
          position: location,
          map: map,
          title: 'Registro'
        });
        markers.push(marker);
      });
    }

    // Exclui um registro do Firebase
    function deleteRecord(key) {
      firebase.database().ref('registros/' + key).remove()
        .then(() => {
          alert('Registro excluído com sucesso!');
        })
        .catch((error) => {
          alert('Erro ao excluir registro: ' + error.message);
        });
    }

    // Função para carregar registros e exibi-los
    function loadRecords() {
      dbRef.on('value', (snapshot) => {
        locationList = []; // Limpa a lista de locais
        const data = snapshot.val();
        const listContainer = document.getElementById('list-container');
        listContainer.innerHTML = ''; // Limpa a exibição da lista

        if (data) {
          Object.keys(data).forEach((key) => {
            const registro = data[key];
            const latitude = registro.latitude;
            const longitude = registro.longitude;

            // Adiciona o registro à lista de localizações para o mapa
            locationList.push({ lat: latitude, lng: longitude });

            // Cria o item da lista de exibição
            const listItem = document.createElement('div');
            listItem.classList.add('list-item');
            listItem.innerHTML = `
              <p>Nota: ${registro.nota}</p>
              <p>Temperatura: ${registro.temperatura}</p>
              <p>Clima: ${registro.clima}</p>
              <p>Coordenadas: (${latitude}, ${longitude})</p>
              <button onclick="deleteRecord('${key}')">Excluir</button>
            `;
            listContainer.appendChild(listItem);
          });

          // Atualiza os marcadores no mapa
          updateMapMarkers(locationList);
        }
      });
    }

    // Inicializa o mapa e carrega os registros
    window.onload = function() {
      initMap();
      loadRecords();
    };
  </script>
</body>
</html>

