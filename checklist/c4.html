<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App de Treino</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }

        div {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        a {
            color: #007bff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        #checklist-container {
            margin-top: 20px;
        }

        #checklist {
            list-style-type: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="login-container">
        <h2>Login</h2>
        <form id="login-form">
            <input type="text" id="username" placeholder="Nome de Usuário" required>
            <input type="password" id="password" placeholder="Senha" required>
            <button type="button" onclick="login()">Entrar</button>
        </form>
        <p>Não tem conta? <a href="javascript:void(0);" onclick="showRegister();">Registrar-se</a></p>
    </div>

    <div id="register-container" style="display:none;">
        <h2>Registrar</h2>
        <form id="register-form">
            <input type="text" id="register-username" placeholder="Nome de Usuário" required>
            <input type="password" id="register-password" placeholder="Senha (até 4 dígitos)" required>
            <button type="button" onclick="register()">Cadastrar</button>
        </form>
        <p>Já tem conta? <a href="javascript:void(0);" onclick="showLogin();">Fazer Login</a></p>
    </div>

    <div id="agenda-container" style="display:none;">
        <h2>Agenda de Treino</h2>
        <p>Bem-vindo, <span id="user-name"></span></p>
        <button onclick="logout()">Sair</button>
        <div id="checklist-container">
            <h3>Checklist de Treinos</h3>
            <!-- Aqui será inserido o checklist do usuário -->
            <ul id="checklist">
                <!-- Itens de checklist -->
            </ul>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-database.js"></script>
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAIp-rFuZZsBCNVJ3pSge4TE-XUuwYygrI",
            authDomain: "agenda-6accc.firebaseapp.com",
            databaseURL: "https://agenda-6accc-default-rtdb.firebaseio.com",
            projectId: "agenda-6accc",
            storageBucket: "agenda-6accc.appspot.com",
            messagingSenderId: "205960633520",
            appId: "1:205960633520:web:c9b1b9e166a8e3daed1dc6"
        };

        // Inicializa o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Variável para armazenar o ID do usuário logado
        let currentUserId = null;

        // Função para verificar se o usuário está logado
        window.onload = function() {
            checkUserLoggedIn();  // Verifica se o usuário já está logado
        };

        // Função para verificar se o usuário já está logado no localStorage
        function checkUserLoggedIn() {
            const storedUser = localStorage.getItem('username');
            if (storedUser) {
                currentUserId = storedUser;
                showAgenda();  // Se já estiver logado, mostra a agenda
            } else {
                showLogin();  // Caso contrário, exibe a tela de login
            }
        }

        // Função para exibir a tela de login
        function showLogin() {
            document.getElementById('login-container').style.display = 'block';
            document.getElementById('register-container').style.display = 'none';
            document.getElementById('agenda-container').style.display = 'none';
        }

        // Função para exibir a tela de registro
        function showRegister() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('register-container').style.display = 'block';
            document.getElementById('agenda-container').style.display = 'none';
        }

        // Função para exibir a agenda do usuário
        function showAgenda() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('register-container').style.display = 'none';
            document.getElementById('agenda-container').style.display = 'block';

            // Exibe o nome de usuário
            document.getElementById('user-name').innerText = currentUserId;

            // Carrega os dados de checklist
            loadChecklist();
        }

        // Função para login
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const userRef = database.ref('users/' + username);
            userRef.once('value', snapshot => {
                const userData = snapshot.val();
                if (userData && userData.password === password) {
                    currentUserId = username;
                    localStorage.setItem('username', username);  // Salva o nome de usuário no localStorage
                    showAgenda();  // Redireciona para a tela da agenda
                } else {
                    alert('Nome de usuário ou senha inválidos.');
                }
            });
        }

        // Função para registrar o usuário
        function register() {
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;

            if (!username || !/^[a-zA-Z0-9]+$/.test(username)) {
                alert('Nome de usuário inválido. Deve ser uma palavra sem espaços.');
                return;
            }

            if (!password || !/^\d{1,4}$/.test(password)) {
                alert('Senha inválida. Deve ser um número de até 4 dígitos.');
                return;
            }

            const userRef = database.ref('users/' + username);
            userRef.once('value', snapshot => {
                if (snapshot.exists()) {
                    alert('Este nome de usuário já existe!');
                    return;
                }

                userRef.set({ password: password })
                .then(() => {
                    alert('Usuário registrado com sucesso!');
                    showLogin();  // Redireciona para a tela de login
                })
                .catch(error => {
                    alert('Erro no registro: ' + error.message);
                });
            });
        }

        // Função para sair do login
        function logout() {
            localStorage.removeItem('username');  // Remove o nome de usuário do localStorage
            showLogin();  // Redireciona para a tela de login
        }

        // Função para carregar os dados de checklist
        function loadChecklist() {
            const checklistRef = database.ref('checklists/' + currentUserId);
            checklistRef.once('value', snapshot => {
                const checklistData = snapshot.val();
                const checklistContainer = document.getElementById('checklist');
                checklistContainer.innerHTML = '';  // Limpa a lista antes de carregar

                if (checklistData) {
                    Object.keys(checklistData).forEach(itemId => {
                        const listItem = document.createElement('li');
                        listItem.textContent = checklistData[itemId].name;
                        checklistContainer.appendChild(listItem);
                    });
                }
            });
        }
    </script>
</body>
</html>
