<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fafafa;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #262626;
        }
        #login-section, #profile-section, #posts-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin: 10px auto;
            padding: 20px;
            max-width: 600px;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #dbdbdb;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background-color: #0095f6;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #007bbf;
        }
        .post {
            border: 1px solid #dbdbdb;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            background: white;
        }
        .comment {
            margin-left: 20px;
            font-size: 0.9em;
            color: #555;
        }
        .post-author {
            font-weight: bold;
            color: #262626;
        }
        .edit-delete {
            display: inline-block;
            margin-left: 10px;
            font-size: 0.9em;
            color: #0095f6;
            cursor: pointer;
        }
        .edit-delete:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>Social App</h1>
    
    <!-- Seção de Login -->
    <div id="login-section">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Nome de usuário" required>
        <button id="login-button">Entrar</button>
    </div>

    <!-- Seção de Perfil -->
    <div id="profile-section">
        <h2>Perfil</h2>
        <p>Nome de usuário: <span id="profile-username"></span></p>
        <button id="logout-button">Sair</button>
    </div>

    <!-- Seção de Posts -->
    <div id="posts-section">
        <h2>Posts</h2>
        <textarea id="post-text" placeholder="Escreva um post..."></textarea>
        <button id="post-button">Publicar</button>
        <div id="posts-container"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js"></script>
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAIp-rFuZZsBCNVJ3pSge4TE-XUuwYygrI",
            authDomain: "agenda-6accc.firebaseapp.com",
            databaseURL: "https://agenda-6accc-default-rtdb.firebaseio.com",
            projectId: "agenda-6accc",
            storageBucket: "agenda-6accc.appspot.com",
            messagingSenderId: "205960633520",
            appId: "1:205960633520:web:c9b1b9e166a8e3daed1dc6"
        };

        // Inicializando Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentUsername = '';

        // Função para fazer login
        document.getElementById('login-button').addEventListener('click', () => {
            const usernameInput = document.getElementById('username').value;
            if (usernameInput) {
                currentUsername = usernameInput;
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('profile-section').style.display = 'block';
                document.getElementById('profile-username').innerText = currentUsername;
                document.getElementById('posts-section').style.display = 'block';
                loadPosts();
            } else {
                alert('Por favor, insira um nome de usuário.');
            }
        });

        // Função para sair
        document.getElementById('logout-button').addEventListener('click', () => {
            currentUsername = '';
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('profile-section').style.display = 'none';
            document.getElementById('posts-section').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('posts-container').innerHTML = ''; // Limpa posts ao sair
        });

        // Função para salvar um post
        document.getElementById('post-button').addEventListener('click', () => {
            const postText = document.getElementById('post-text').value;
            if (postText) {
                const postId = database.ref('posts').push().key;
                const postData = {
                    text: postText,
                    username: currentUsername,
                    comments: []
                };
                savePost(postId, postData);
            } else {
                alert('Por favor, escreva algo para postar.');
            }
        });

        // Função para salvar post no Firebase
        function savePost(postId, postData) {
            database.ref('posts/' + postId).set(postData).then(() => {
                loadPosts();
                document.getElementById('post-text').value = '';
            }).catch((error) => {
                console.error('Erro ao salvar o post:', error);
            });
        }

        // Função para carregar posts do Firebase
        function loadPosts() {
            database.ref('posts').once('value', (snapshot) => {
                const postsContainer = document.getElementById('posts-container');
                postsContainer.innerHTML = ''; // Limpa posts anteriores

                snapshot.forEach((childSnapshot) => {
                    const post = childSnapshot.val();
                    const postId = childSnapshot.key;
                    const postDiv = document.createElement('div');
                    postDiv.className = 'post';
                    postDiv.innerHTML = `<span class="post-author">${post.username}:</span> ${post.text}`;

                    // Botão de edição do post
                    if (post.username === currentUsername) {
                        const editButton = document.createElement('span');
                        editButton.innerText = 'Editar';
                        editButton.className = 'edit-delete';
                        editButton.addEventListener('click', () => editPost(postId, post.text));
                        postDiv.appendChild(editButton);

                        const deleteButton = document.createElement('span');
                        deleteButton.innerText = 'Excluir';
                        deleteButton.className = 'edit-delete';
                        deleteButton.addEventListener('click', () => deletePost(postId));
                        postDiv.appendChild(deleteButton);
                    }

                    // Seção de comentários
                    const commentsContainer = document.createElement('div');
                    if (Array.isArray(post.comments)) {
                        post.comments.forEach((comment) => {
                            const commentDiv = document.createElement('div');
                            commentDiv.className = 'comment';
                            commentDiv.innerText = comment;
                            commentsContainer.appendChild(commentDiv);
                        });
                    } else {
                        post.comments = []; // Garante que seja um array
                    }

                    // Campo para adicionar um comentário
                    const commentInput = document.createElement('input');
                    commentInput.type = 'text';
                    commentInput.placeholder = 'Escreva um comentário...';
                    const commentButton = document.createElement('button');
                    commentButton.innerText = 'Comentar';
                    commentButton.addEventListener('click', () => {
                        if (commentInput.value) {
                            post.comments.push(commentInput.value);
                            database.ref('posts/' + postId).set(post).then(() => {
                                loadPosts();
                            });
                            commentInput.value = ''; // Limpa o campo de entrada
                        } else {
                            alert('Por favor, escreva um comentário.');
                        }
                    });

                    // Adicionando elementos ao post
                    postDiv.appendChild(commentsContainer);
                    postDiv.appendChild(commentInput);
                    postDiv.appendChild(commentButton);
                    postsContainer.appendChild(postDiv);
                });
            }).catch((error) => {
                console.error('Erro ao carregar os posts:', error);
            });
        }

        // Função para editar um post
        function editPost(postId, postText) {
            const newPostText = prompt('Edite seu post:', postText);
            if (newPostText) {
                database.ref('posts/' + postId).update({ text: newPostText }).then(() => {
                    loadPosts();
                }).catch((error) => {
                    console.error('Erro ao editar o post:', error);
                });
            }
        }

        // Função para excluir um post
        function deletePost(postId) {
            if (confirm('Tem certeza que deseja excluir este post?')) {
                database.ref('posts/' + postId).remove().then(() => {
                    loadPosts();
                }).catch((error) => {
                    console.error('Erro ao excluir o post:', error);
                });
            }
        }
    </script>
</body>
</html>

