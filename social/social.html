<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social App</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-storage.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #login-section, #post-section, #posts {
            margin: 20px;
        }
        .post {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .post-header {
            font-weight: bold;
        }
        .timestamp {
            color: #777;
            font-size: 0.8em;
        }
    </style>
</head>
<body>

<h1>Social App</h1>

<!-- Seção de login -->
<div id="login-section">
    <input type="text" id="username" placeholder="Nome de usuário">
    <button onclick="login()">Entrar</button>
</div>

<!-- Seção de criação de postagem -->
<div id="post-section" style="display: none;">
    <h2>Criar uma Postagem</h2>
    <textarea id="post-text" placeholder="O que você está pensando?"></textarea>
    
    <!-- Opção para upload de imagens e vídeos -->
    <input type="file" id="media-upload" accept="image/*,video/*">
    
    <button onclick="createPost()">Postar</button>
</div>

<!-- Seção de exibição de posts -->
<div id="posts"></div>

<script>
    // Configuração do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAIp-rFuZZsBCNVJ3pSge4TE-XUuwYygrI",
        authDomain: "agenda-6accc.firebaseapp.com",
        databaseURL: "https://agenda-6accc-default-rtdb.firebaseio.com",
        projectId: "agenda-6accc",
        storageBucket: "agenda-6accc.appspot.com",
        messagingSenderId: "205960633520",
        appId: "1:205960633520:web:c9b1b9e166a8e3daed1dc6"
    };

    // Inicializando Firebase
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const database = firebase.database();
    const storage = firebase.storage();

    let currentUser = null;

    // Função de login simples com nome de usuário
    function login() {
        const username = document.getElementById('username').value;
        if (username !== "") {
            currentUser = username;
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('post-section').style.display = 'block';
            loadPosts();
        } else {
            alert('Por favor, insira um nome de usuário.');
        }
    }

    // Função para criar um post com upload de mídia (foto ou vídeo)
    function createPost() {
        const postText = document.getElementById('post-text').value;
        const mediaFile = document.getElementById('media-upload').files[0];

        if (postText !== "" && currentUser) {
            const postId = database.ref('posts').push().key;
            const postData = {
                text: postText,
                userName: currentUser,
                timestamp: Date.now(),
                mediaUrl: null,  // Iniciamos com a URL de mídia nula
                mediaType: null  // Tipo de mídia (imagem/vídeo)
            };

            if (mediaFile) {
                const storageRef = storage.ref('posts/' + postId + '/' + mediaFile.name);
                const uploadTask = storageRef.put(mediaFile);

                uploadTask.on('state_changed', 
                    (snapshot) => {
                        // Opcional: Exibe o progresso do upload
                    }, 
                    (error) => {
                        console.error('Erro no upload de mídia:', error);
                    }, 
                    () => {
                        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            postData.mediaUrl = downloadURL;
                            postData.mediaType = mediaFile.type.startsWith('image/') ? 'image' : 'video';

                            // Salva o post no banco de dados
                            database.ref('posts/' + postId).set(postData);
                            document.getElementById('post-text').value = '';
                            document.getElementById('media-upload').value = '';
                            loadPosts();
                        });
                    }
                );
            } else {
                // Salva o post no banco de dados sem mídia
                database.ref('posts/' + postId).set(postData);
                document.getElementById('post-text').value = '';
                loadPosts();
            }
        } else {
            alert('Post vazio ou usuário não logado!');
        }
    }

    // Função para carregar os posts e exibir mídia (fotos e vídeos)
    function loadPosts() {
        const postsRef = database.ref('posts');
        postsRef.on('value', (snapshot) => {
            const postsContainer = document.getElementById('posts');
            postsContainer.innerHTML = ''; // Limpa a timeline

            snapshot.forEach((childSnapshot) => {
                const post = childSnapshot.val();
                const postDiv = document.createElement('div');
                postDiv.classList.add('post');
                const postTime = new Date(post.timestamp).toLocaleString();

                let mediaContent = '';
                if (post.mediaUrl) {
                    if (post.mediaType === 'image') {
                        mediaContent = `<img src="${post.mediaUrl}" alt="Imagem" style="width: 100%; max-width: 600px; margin-top: 10px;">`;
                    } else if (post.mediaType === 'video') {
                        mediaContent = `<video controls style="width: 100%; max-width: 600px; margin-top: 10px;">
                                            <source src="${post.mediaUrl}" type="video/mp4">
                                            Seu navegador não suporta vídeos.
                                        </video>`;
                    }
                }

                postDiv.innerHTML = `
                    <div class="post-header">
                        <strong>${post.userName}</strong>
                        <span class="timestamp">${postTime}</span>
                    </div>
                    <p>${post.text}</p>
                    ${mediaContent}`;
                
                postsContainer.appendChild(postDiv);
            });
        });
    }
</script>

</body>
</html>

