<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MusicPro – Spotify Clone</title>
  <!-- Google Fonts: Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
  <style>
    /* ===============================
       Reset e Tipografia
    =============================== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Roboto', sans-serif; background: #f4f4f4; color: #333; }

    /* ===============================
       Loader (Spinner)
    =============================== */
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4A90E2;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 10px auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* ===============================
       Estilos para Modais (Login/Registro)
    =============================== */
    .modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .modal.active { opacity: 1; pointer-events: auto; }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 90%; max-width: 400px;
      animation: slideDown 0.3s ease;
    }
    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; }
    .form-group input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    .btn { display: inline-block; background: #4A90E2; color: #fff; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; transition: background 0.3s ease; }
    .btn:hover { background: #357ABD; }
    .toggle-link { color: #4A90E2; cursor: pointer; text-decoration: underline; margin-top: 10px; text-align: center; display: block; }

    /* ===============================
       Layout do App (após autenticação)
    =============================== */
    header {
      background: #203a43;
      padding: 15px;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 { font-size: 1.5rem; }
    header button { background: #4A90E2; border: none; padding: 8px 12px; border-radius: 4px; color: #fff; cursor: pointer; }
    .container { padding: 20px; }
    .playlist-list { display: flex; flex-wrap: wrap; gap: 15px; }
    .playlist-item {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 15px;
      width: calc(33.33% - 30px);
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .playlist-item:hover { transform: translateY(-5px); }
    .playlist-item h3 { font-size: 1.2rem; margin-bottom: 10px; }
    .btn-upload { margin-top: 10px; }

    /* ===============================
       Responsividade
    =============================== */
    @media(max-width:768px) {
      .playlist-item { width: calc(50% - 30px); }
    }
    @media(max-width:480px) {
      .playlist-item { width: 100%; }
    }
  </style>
</head>
<body>
  <!-- Modal de Autenticação (Login/Registro) -->
  <div id="auth-modal" class="modal active">
    <div class="modal-content">
      <h2 id="auth-title">Login</h2>
      <div id="auth-error" style="color: red; margin-bottom: 10px;"></div>
      <div class="form-group">
        <label for="auth-email">Email</label>
        <input type="email" id="auth-email" placeholder="Seu email">
      </div>
      <div class="form-group">
        <label for="auth-password">Senha (4 dígitos)</label>
        <input type="password" id="auth-password" placeholder="Ex: 1234">
      </div>
      <button id="auth-submit" class="btn">Entrar</button>
      <span id="toggle-auth" class="toggle-link">Não tem conta? Registre-se</span>
    </div>
  </div>

  <!-- Interface Principal do App -->
  <div id="app" style="display: none;">
    <header>
      <h1>MusicPro - Playlists</h1>
      <button onclick="signOut()">Sair</button>
    </header>
    <div class="container">
      <button class="btn" onclick="createPlaylist()">Criar Nova Playlist</button>
      <div id="playlists-container">
        <div id="loader" class="loader" style="display: none;"></div>
        <div id="playlist-list" class="playlist-list"></div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs (Auth, Firestore, Storage) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDxMWPu_CnXV-u4-vlDFd-IZ8fzlyKJHng",
      authDomain: "financeiro-5.firebaseapp.com",
      projectId: "financeiro-5",
      storageBucket: "financeiro-5.appspot.com",
      messagingSenderId: "686639785223",
      appId: "1:686639785223:web:0314689c82c6dd1c2951a2",
      measurementId: "G-Q5REWML5DX"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const firestore = firebase.firestore();
    const storage = firebase.storage();

    // Elementos do DOM para Autenticação
    const authModal = document.getElementById("auth-modal");
    const authTitle = document.getElementById("auth-title");
    const authEmail = document.getElementById("auth-email");
    const authPassword = document.getElementById("auth-password");
    const authSubmit = document.getElementById("auth-submit");
    const toggleAuth = document.getElementById("toggle-auth");
    const authError = document.getElementById("auth-error");

    let isRegisterMode = false;
    toggleAuth.addEventListener("click", () => {
      isRegisterMode = !isRegisterMode;
      if (isRegisterMode) {
        authTitle.textContent = "Registro";
        authSubmit.textContent = "Registrar";
        toggleAuth.textContent = "Já tem conta? Faça login";
      } else {
        authTitle.textContent = "Login";
        authSubmit.textContent = "Entrar";
        toggleAuth.textContent = "Não tem conta? Registre-se";
      }
      authError.textContent = "";
    });

    authSubmit.addEventListener("click", () => {
      const email = authEmail.value;
      const password = authPassword.value;
      if (isRegisterMode) {
        // Verifica se a senha tem exatamente 4 dígitos
        if (!/^\d{4}$/.test(password)) {
          authError.textContent = "A senha deve ter exatamente 4 dígitos.";
          return;
        }
        auth.createUserWithEmailAndPassword(email, password)
          .then(userCredential => {
            const user = userCredential.user;
            // Cria um documento de usuário no Firestore
            return firestore.collection("users").doc(user.uid).set({
              email: user.email,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
          })
          .catch(error => {
            authError.textContent = error.message;
          });
      } else {
        auth.signInWithEmailAndPassword(email, password)
          .catch(error => {
            authError.textContent = error.message;
          });
      }
    });

    // Monitoramento do estado de autenticação
    auth.onAuthStateChanged(user => {
      if (user) {
        authModal.classList.remove("active");
        document.getElementById("app").style.display = "block";
        loadPlaylists();
      } else {
        authModal.classList.add("active");
        document.getElementById("app").style.display = "none";
      }
    });

    function signOut() {
      auth.signOut();
    }

    // Funções de Loader
    function showLoader() {
      document.getElementById("loader").style.display = "block";
    }
    function hideLoader() {
      document.getElementById("loader").style.display = "none";
    }

    // Carrega as playlists do usuário autenticado
    async function loadPlaylists() {
      showLoader();
      const user = auth.currentUser;
      if (!user) return;
      const playlistsRef = firestore.collection("users").doc(user.uid).collection("playlists");
      playlistsRef.orderBy("createdAt", "desc").onSnapshot(snapshot => {
        const playlistList = document.getElementById("playlist-list");
        playlistList.innerHTML = "";
        snapshot.forEach(doc => {
          const playlist = doc.data();
          const div = document.createElement("div");
          div.className = "playlist-item";
          div.innerHTML = `<h3>${playlist.name}</h3>`;
          div.addEventListener("click", () => {
            openPlaylist(doc.id, playlist.name);
          });
          playlistList.appendChild(div);
        });
        hideLoader();
      });
    }

    // Cria uma nova playlist (pasta) para o usuário
    async function createPlaylist() {
      const user = auth.currentUser;
      if (!user) return;
      const name = prompt("Digite o nome da nova playlist:");
      if (!name) return;
      const playlistsRef = firestore.collection("users").doc(user.uid).collection("playlists");
      try {
        await playlistsRef.add({
          name: name,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert(`Playlist "${name}" criada com sucesso.`);
      } catch (error) {
        alert("Erro ao criar playlist: " + error.message);
      }
    }

    // Abre uma playlist (para exibir músicas – função a ser implementada)
    async function openPlaylist(playlistId, playlistName) {
      alert("Abrir playlist: " + playlistName + "\n(Implementar visualização e upload de músicas)");
      // Aqui você pode carregar a subcoleção "musicas" do documento da playlist
      // e exibir uma interface para reprodução, upload e remoção dos arquivos.
    }
  </script>
</body>
</html>
