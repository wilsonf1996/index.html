<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Music Player - Professional</title>
  <style>
    /* Reset e configurações básicas */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #232323;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    /* Container principal */
    #app-container {
      max-width: 600px;
      width: 100%;
      background-color: #2c2c2c;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 2rem;
    }
    h2 {
      margin-bottom: 15px;
      font-size: 1.2rem;
      text-align: center;
    }
    /* Estilo do input de arquivos */
    input[type="file"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 2px dashed #888;
      border-radius: 5px;
      background-color: #444;
      font-size: 16px;
      color: #fff;
    }
    /* Grupos de botões */
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    button {
      flex: 1;
      background-color: #5bc0de;
      border: none;
      border-radius: 5px;
      padding: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #4cae4c;
    }
    /* Listagem de pastas e arquivos */
    ul {
      list-style: none;
      margin-bottom: 15px;
    }
    li {
      background-color: #333;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
      flex-wrap: wrap;
    }
    .item-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    /* Estilos para players */
    audio, video {
      width: 100%;
      margin-top: 10px;
      border-radius: 5px;
    }
    input[type="range"] {
      width: 100%;
      margin-top: 10px;
    }
    /* Responsividade */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }
      button {
        font-size: 0.9rem;
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <div id="app-container">
    <h1>My Music Player</h1>
    <!-- Upload e gerenciamento de pastas -->
    <input type="file" id="fileInput" multiple>
    <div class="button-group">
      <button id="uploadButton">Upload</button>
      <button id="createFolderButton">Criar Pasta</button>
      <button id="goToRootButton">Pasta Principal</button>
      <button id="backHomeButton">Página Inicial</button>
    </div>
    <h2 id="currentPath">Pasta Atual: Pasta Principal</h2>
    
    <!-- Listagem de pastas e arquivos -->
    <ul id="folderList"></ul>
    <ul id="fileList"></ul>
    <p id="currentFileName">Nenhum arquivo selecionado</p>
    
    <!-- Players de áudio e vídeo -->
    <audio id="audioPlayer" controls style="display: none;"></audio>
    <video id="videoPlayer" controls style="display: none;"></video>
    
    <!-- Controles de reprodução -->
    <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.5">
    <div class="button-group">
      <button id="playPauseButton">Play</button>
      <button id="stopButton">Stop</button>
      <button id="prevButton">Anterior</button>
      <button id="nextButton">Próximo</button>
      <button id="fullscreenButton">Tela Cheia</button>
    </div>
  </div>

  <!-- Firebase SDK (versões compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
  <script>
    /*******************************
     * Configuração e Inicialização
     *******************************/
    const firebaseConfig = {
      apiKey: "AIzaSyDxMWPu_CnXV-u4-vlDFd-IZ8fzlyKJHng",
      authDomain: "financeiro-5.firebaseapp.com",
      projectId: "financeiro-5",
      storageBucket: "financeiro-5.appspot.com",
      messagingSenderId: "686639785223",
      appId: "1:686639785223:web:0314689c82c6dd1c2951a2",
      measurementId: "G-Q5REWML5DX"
    };
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    const storageRef = storage.ref();

    /*******************************
     * Seleção de Elementos DOM
     *******************************/
    const fileInput          = document.getElementById('fileInput');
    const uploadButton       = document.getElementById('uploadButton');
    const createFolderButton = document.getElementById('createFolderButton');
    const goToRootButton     = document.getElementById('goToRootButton');
    const backHomeButton     = document.getElementById('backHomeButton');
    const currentPathEl      = document.getElementById('currentPath');
    const folderListEl       = document.getElementById('folderList');
    const fileListEl         = document.getElementById('fileList');
    const currentFileNameEl  = document.getElementById('currentFileName');
    const audioPlayer        = document.getElementById('audioPlayer');
    const videoPlayer        = document.getElementById('videoPlayer');
    const volumeControl      = document.getElementById('volumeControl');
    const playPauseButton    = document.getElementById('playPauseButton');
    const stopButton         = document.getElementById('stopButton');
    const prevButton         = document.getElementById('prevButton');
    const nextButton         = document.getElementById('nextButton');
    const fullscreenButton   = document.getElementById('fullscreenButton');
    const appContainer       = document.getElementById('app-container');

    /*******************************
     * Estado da Aplicação
     *******************************/
    let currentPath = "";
    let currentFiles = [];    // Armazena a lista de arquivos para reprodução
    let currentFileIndex = 0; // Índice do arquivo atualmente em reprodução

    /*******************************
     * Eventos
     *******************************/
    uploadButton.addEventListener('click', uploadFiles);
    createFolderButton.addEventListener('click', createFolder);
    goToRootButton.addEventListener('click', () => {
      currentPath = "";
      updateCurrentPath();
      listItems();
    });
    backHomeButton.addEventListener('click', goToHomePage);
    playPauseButton.addEventListener('click', togglePlayPause);
    stopButton.addEventListener('click', stopPlayback);
    prevButton.addEventListener('click', playPrevious);
    nextButton.addEventListener('click', playNext);
    volumeControl.addEventListener('input', adjustVolume);
    fullscreenButton.addEventListener('click', toggleFullScreen);
    
    // Quando o player terminar a reprodução, passa para o próximo arquivo
    audioPlayer.addEventListener('ended', playNext);
    videoPlayer.addEventListener('ended', playNext);
    
    // Define o volume inicial
    adjustVolume();

    /*******************************
     * Funções Auxiliares e de UI
     *******************************/
    function updateCurrentPath() {
      currentPathEl.textContent = currentPath ? `Pasta Atual: ${currentPath}` : 'Pasta Atual: Pasta Principal';
    }

    function createButton(text, onClick) {
      const btn = document.createElement('button');
      btn.textContent = text;
      btn.addEventListener('click', onClick);
      return btn;
    }

    /*******************************
     * Funções de Upload e Gerenciamento
     *******************************/
    async function uploadFiles() {
      const files = fileInput.files;
      if (!files.length) {
        alert('Selecione um ou mais arquivos para upload.');
        return;
      }
      try {
        for (const file of files) {
          const fileRef = storageRef.child(currentPath + file.name);
          await fileRef.put(file);
        }
        alert('Upload concluído!');
        await listItems();
      } catch (error) {
        console.error('Upload Error:', error);
        alert(`Erro no upload: ${error.message}`);
      }
    }

    async function createFolder() {
      const folderName = prompt('Digite o nome da nova pasta:');
      if (!folderName) return;
      try {
        // Criação de "pasta" no Firebase Storage via Blob vazio
        const folderRef = storageRef.child(currentPath + folderName + '/');
        await folderRef.put(new Blob([]));
        alert(`Pasta "${folderName}" criada com sucesso!`);
        await listItems();
      } catch (error) {
        console.error('Create Folder Error:', error);
        alert(`Erro ao criar pasta: ${error.message}`);
      }
    }

    /*******************************
     * Listagem de Pastas e Arquivos
     *******************************/
    async function listItems() {
      try {
        // Limpa as listas antes de exibir os itens atualizados
        folderListEl.innerHTML = '';
        fileListEl.innerHTML = '';
        
        // Recupera itens e pastas da pasta atual
        const result = await storageRef.child(currentPath).listAll();

        // Exibe as pastas (prefixes)
        result.prefixes.forEach(prefix => {
          const li = document.createElement('li');
          li.classList.add('folder-item');
          const header = document.createElement('div');
          header.classList.add('item-header');
          header.textContent = prefix.name;
          const openBtn = createButton('Abrir', () => {
            currentPath = prefix.fullPath + '/';
            updateCurrentPath();
            listItems();
          });
          header.appendChild(openBtn);
          li.appendChild(header);
          folderListEl.appendChild(li);
        });

        // Exibe os arquivos (items)
        currentFiles = result.items;
        currentFiles.forEach((item, index) => {
          const li = document.createElement('li');
          li.classList.add('file-item');
          const header = document.createElement('div');
          header.classList.add('item-header');
          header.textContent = item.name;
          const actions = document.createElement('div');
          actions.classList.add('item-actions');
          const playBtn = createButton('Play', () => playSelected(index));
          const downloadBtn = createButton('Baixar', () => downloadFile(item));
          const deleteBtn = createButton('Excluir', () => deleteFile(item));
          actions.appendChild(playBtn);
          actions.appendChild(downloadBtn);
          actions.appendChild(deleteBtn);
          header.appendChild(actions);
          li.appendChild(header);
          fileListEl.appendChild(li);
        });
      } catch (error) {
        console.error('List Items Error:', error);
        alert(`Erro ao listar itens: ${error.message}`);
      }
    }

    /*******************************
     * Funções de Reprodução e Controles
     *******************************/
    async function playSelected(index) {
      try {
        const selectedItem = currentFiles[index];
        const url = await selectedItem.getDownloadURL();
        const fileExt = selectedItem.name.split('.').pop().toLowerCase();
        currentFileIndex = index;
        currentFileNameEl.textContent = `Arquivo: ${selectedItem.name}`;
        // Diferencia áudio e vídeo (adicione outros formatos se necessário)
        if (['mp4', 'webm', 'ogg'].includes(fileExt)) {
          audioPlayer.style.display = 'none';
          videoPlayer.style.display = 'block';
          videoPlayer.src = url;
          videoPlayer.play();
        } else {
          videoPlayer.style.display = 'none';
          audioPlayer.style.display = 'block';
          audioPlayer.src = url;
          audioPlayer.play();
        }
        playPauseButton.textContent = 'Pause';
      } catch (error) {
        console.error('Play Selected Error:', error);
        alert(`Erro ao reproduzir o arquivo: ${error.message}`);
      }
    }

    // Retorna o player ativo (vídeo se estiver visível ou áudio)
    function getActivePlayer() {
      return videoPlayer.style.display === 'block' ? videoPlayer : audioPlayer;
    }

    function togglePlayPause() {
      const player = getActivePlayer();
      if (!player.src) return;
      if (player.paused) {
        player.play();
        playPauseButton.textContent = 'Pause';
      } else {
        player.pause();
        playPauseButton.textContent = 'Play';
      }
    }

    function stopPlayback() {
      const player = getActivePlayer();
      player.pause();
      player.currentTime = 0;
      playPauseButton.textContent = 'Play';
    }

    function playNext() {
      if (currentFileIndex < currentFiles.length - 1) {
        playSelected(currentFileIndex + 1);
      }
    }

    function playPrevious() {
      if (currentFileIndex > 0) {
        playSelected(currentFileIndex - 1);
      }
    }

    function adjustVolume() {
      const volume = volumeControl.value;
      audioPlayer.volume = volume;
      videoPlayer.volume = volume;
    }

    async function downloadFile(item) {
      try {
        const url = await item.getDownloadURL();
        const link = document.createElement('a');
        link.href = url;
        link.download = item.name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch (error) {
        console.error('Download Error:', error);
        alert(`Erro ao baixar o arquivo: ${error.message}`);
      }
    }

    async function deleteFile(item) {
      if (confirm(`Deseja excluir "${item.name}"?`)) {
        try {
          await item.delete();
          alert('Arquivo excluído!');
          listItems();
        } catch (error) {
          console.error('Delete Error:', error);
          alert(`Erro ao excluir o arquivo: ${error.message}`);
        }
      }
    }

    function goToHomePage() {
      // Redireciona para a página inicial desejada
      window.location.href = 'https://wilsonf1996.github.io/index.html/';
    }

    /*******************************
     * Controle de Tela Cheia
     *******************************/
    function toggleFullScreen() {
      const player = getActivePlayer();
      if (!document.fullscreenElement) {
        if (player.requestFullscreen) {
          player.requestFullscreen();
        } else if (player.webkitRequestFullscreen) {
          player.webkitRequestFullscreen();
        } else if (player.msRequestFullscreen) {
          player.msRequestFullscreen();
        }
        fullscreenButton.textContent = 'Sair da Tela Cheia';
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
        fullscreenButton.textContent = 'Tela Cheia';
      }
    }

    /*******************************
     * Inicialização
     *******************************/
    updateCurrentPath();
    listItems();
  </script>
</body>
</html>
