<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Music Player</title>
  <style>
    /* Estilos inspirados no exemplo enviado – interface escura e responsiva */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #232323; /* Fundo escuro */
      color: #fff; /* Texto branco */
    }
    #app-container {
      padding: 20px;
      max-width: 480px; /* Largura máxima */
      margin: 0 auto; /* Centraliza */
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
    }
    input[type="file"] {
      display: block;
      margin: 0 auto 20px;
      padding: 10px;
      border: 2px dashed #888;
      border-radius: 5px;
      background-color: #444;
      font-size: 16px;
      color: #fff;
      width: 100%;
    }
    button {
      background-color: #5bc0de;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-bottom: 10px;
      width: 100%;
    }
    button:hover {
      background-color: #4cae4c;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    li {
      background-color: #333;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
    }
    li button {
      flex: 1;
      margin: 5px;
    }
    audio, video {
      width: 100%;
      margin-top: 10px;
      border-radius: 5px;
    }
    input[type="range"] {
      width: 100%;
      display: block;
      margin-top: 10px;
    }
    /* Tela cheia */
    .fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      z-index: 9999;
    }
    .hide-file-list {
      display: none;
    }
    @media (max-width: 480px) {
      #app-container {
        padding: 10px;
      }
      h1 {
        font-size: 20px;
      }
      button {
        font-size: 14px;
        padding: 8px 16px;
      }
      li {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="app-container">
    <h1>My Music Player</h1>
    <!-- Seletor de arquivos -->
    <input type="file" id="fileInput" multiple>
    <!-- Botões de ação -->
    <button id="uploadButton">Upload</button>
    <button id="createFolderButton">Create Folder</button>
    <button id="goToRootButton">Go to Root</button>
    <button onclick="goToHomePage()">Back to Homepage</button>
    <h2 id="currentPath">Current Path: /</h2>
    <!-- Lista de arquivos e pastas -->
    <ul id="fileList"></ul>
    <p id="currentFileName">File Name: None</p>
    <!-- Players de áudio e vídeo -->
    <audio id="audioPlayer" controls></audio>
    <video id="videoPlayer" controls style="display: none;"></video>
    <!-- Controle de volume -->
    <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.5">
    <!-- Controles do player -->
    <button id="playPauseButton">Play/Pause</button>
    <button id="stopButton">Stop</button>
    <button id="prevButton">Previous</button>
    <button id="nextButton">Next</button>
    <button id="fullscreenButton">Full Screen</button>
  </div>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
  <!-- Não usamos Firestore neste exemplo, seguindo o modelo do código fornecido -->

  <script>
    /*******************************
     * CONFIGURAÇÃO DO FIREBASE
     *******************************/
    const firebaseConfig = {
      apiKey: "AIzaSyDxMWPu_CnXV-u4-vlDFd-IZ8fzlyKJHng",
      authDomain: "financeiro-5.firebaseapp.com",
      projectId: "financeiro-5",
      storageBucket: "financeiro-5.appspot.com",
      messagingSenderId: "686639785223",
      appId: "1:686639785223:web:0314689c82c6dd1c2951a2",
      measurementId: "G-Q5REWML5DX"
    };
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    const storageRef = storage.ref();

    /*******************************
     * VARIÁVEIS GLOBAIS
     *******************************/
    let currentPath = ""; // Caminho atual ("" para raiz)
    let currentMusicIndex = 0;
    let fileItems = []; // Array para armazenar os itens (arquivos e pastas) listados
    const fileListEl = document.getElementById('fileList');
    const currentPathEl = document.getElementById('currentPath');
    const currentFileNameEl = document.getElementById('currentFileName');
    const audioPlayer = document.getElementById('audioPlayer');
    const videoPlayer = document.getElementById('videoPlayer');
    const volumeControl = document.getElementById('volumeControl');
    const playPauseButton = document.getElementById('playPauseButton');

    /*******************************
     * EVENTOS DOS BOTÕES
     *******************************/
    document.getElementById('uploadButton').addEventListener('click', uploadFiles);
    document.getElementById('createFolderButton').addEventListener('click', createFolder);
    document.getElementById('goToRootButton').addEventListener('click', goToRoot);
    document.getElementById('playPauseButton').addEventListener('click', togglePlayPause);
    document.getElementById('stopButton').addEventListener('click', stopMusic);
    document.getElementById('prevButton').addEventListener('click', playPreviousMusic);
    document.getElementById('nextButton').addEventListener('click', playNextMusic);
    volumeControl.addEventListener('input', adjustVolume);
    audioPlayer.addEventListener('ended', playNextMusic);
    document.getElementById('fullscreenButton').addEventListener('click', toggleFullScreen);

    /*******************************
     * FUNÇÃO: UPLOAD DE ARQUIVOS
     *******************************/
    function uploadFiles() {
      const fileInput = document.getElementById('fileInput');
      const files = fileInput.files;
      if (files.length === 0) {
        alert('Select one or more files to upload.');
        return;
      }
      Array.from(files).forEach(file => {
        // Permite apenas áudio e vídeo
        if (!file.type.startsWith('audio/') && !file.type.startsWith('video/')) {
          alert(`File ${file.name} is not allowed. Only audio and video are permitted.`);
          return;
        }
        const filePath = currentPath + file.name;
        const fileRef = storageRef.child(filePath);
        fileRef.put(file).then(() => {
          listFiles();
        }).catch(error => {
          alert(`Error uploading ${file.name}: ${error.message}`);
        });
      });
    }

    /*******************************
     * FUNÇÃO: LISTAR ARQUIVOS E PASTAS
     *******************************/
    function listFiles() {
      fileListEl.innerHTML = "";
      currentPathEl.textContent = "Current Path: /" + currentPath;
      fileItems = [];
      storageRef.child(currentPath).listAll().then(result => {
        // Primeiro, lista os “prefixos” (pastas)
        result.prefixes.forEach(prefix => {
          // Cada prefix representa uma pasta – criamos um item de pasta
          const li = document.createElement('li');
          li.textContent = prefix.name;
          const openFolderBtn = createButton('Open Folder', () => openFolder(prefix));
          li.appendChild(openFolderBtn);
          fileListEl.appendChild(li);
          fileItems.push({ type: 'folder', ref: prefix, name: prefix.name });
        });
        // Em seguida, lista os arquivos
        result.items.forEach((item, index) => {
          const li = document.createElement('li');
          li.textContent = item.name;
          const playBtn = createButton('Play', () => playSelectedFile(index + fileItems.length));
          const downloadBtn = createButton('Download', () => downloadFile(item));
          const deleteBtn = createButton('Delete', () => deleteFile(item));
          li.appendChild(playBtn);
          li.appendChild(downloadBtn);
          li.appendChild(deleteBtn);
          fileListEl.appendChild(li);
          fileItems.push({ type: 'file', ref: item, name: item.name });
        });
      }).catch(error => {
        alert(`Error listing files: ${error.message}`);
      });
    }

    /*******************************
     * FUNÇÃO: CRIAR PASTA
     *******************************/
    function createFolder() {
      const folderName = prompt('Enter folder name:');
      if (!folderName) return;
      const folderPath = currentPath + folderName + '/';
      const folderRef = storageRef.child(folderPath);
      // Envia um Blob vazio para criar a pasta
      folderRef.put(new Blob([])).then(() => {
        listFiles();
      }).catch(error => {
        alert(`Error creating folder ${folderName}: ${error.message}`);
      });
    }

    /*******************************
     * FUNÇÃO: ABRIR PASTA
     *******************************/
    function openFolder(prefixRef) {
      // Atualiza o currentPath para a pasta selecionada
      currentPath = prefixRef.fullPath + '/';
      listFiles();
    }

    /*******************************
     * FUNÇÃO: VOLTAR PARA A RAIZ
     *******************************/
    function goToRoot() {
      currentPath = "";
      listFiles();
    }

    /*******************************
     * FUNÇÃO: CRIAR BOTÃO (helper)
     *******************************/
    function createButton(text, onClick) {
      const btn = document.createElement('button');
      btn.textContent = text;
      btn.addEventListener('click', onClick);
      return btn;
    }

    /*******************************
     * FUNÇÃO: REPRODUZIR ARQUIVO SELECIONADO
     *******************************/
    function playSelectedFile(index) {
      // Como fileItems contém tanto pastas quanto arquivos, reproduz apenas se for arquivo
      const selectedItem = fileItems[index];
      if (!selectedItem || selectedItem.type !== 'file') {
        alert('Select a valid file to play.');
        return;
      }
      selectedItem.ref.getDownloadURL().then(url => {
        const ext = selectedItem.name.split('.').pop().toLowerCase();
        if (ext === 'mp4') {
          // Se for vídeo, exibe o player de vídeo
          audioPlayer.style.display = 'none';
          videoPlayer.style.display = 'block';
          videoPlayer.src = url;
          videoPlayer.play();
        } else {
          // Caso seja áudio
          videoPlayer.style.display = 'none';
          audioPlayer.style.display = 'block';
          audioPlayer.src = url;
          audioPlayer.play();
        }
        currentMusicIndex = index;
        document.getElementById('currentFileName').textContent = 'File Name: ' + selectedItem.name;
      }).catch(error => {
        alert(`Error getting playback URL: ${error.message}`);
      });
    }

    /*******************************
     * FUNÇÕES DO PLAYER
     *******************************/
    function togglePlayPause() {
      if (audioPlayer.style.display === 'block') {
        if (audioPlayer.paused) {
          audioPlayer.play();
          playPauseButton.textContent = 'Pause';
        } else {
          audioPlayer.pause();
          playPauseButton.textContent = 'Play';
        }
      } else if (videoPlayer.style.display === 'block') {
        if (videoPlayer.paused) {
          videoPlayer.play();
          playPauseButton.textContent = 'Pause';
        } else {
          videoPlayer.pause();
          playPauseButton.textContent = 'Play';
        }
      }
    }
    function stopMusic() {
      audioPlayer.pause();
      audioPlayer.currentTime = 0;
      playPauseButton.textContent = 'Play';
    }
    function playNextMusic() {
      // Se houver próximo arquivo na lista, reproduz o próximo
      if (currentMusicIndex < fileItems.length - 1) {
        currentMusicIndex++;
        playSelectedFile(currentMusicIndex);
      }
    }
    function playPreviousMusic() {
      if (currentMusicIndex > 0) {
        currentMusicIndex--;
        playSelectedFile(currentMusicIndex);
      }
    }
    function adjustVolume() {
      audioPlayer.volume = volumeControl.value;
      videoPlayer.volume = volumeControl.value;
    }
    function downloadFile(itemRef) {
      itemRef.getDownloadURL().then(url => {
        const link = document.createElement('a');
        link.href = url;
        link.setAttribute('download', itemRef.name);
        link.click();
      }).catch(error => {
        alert(`Error getting download URL: ${error.message}`);
      });
    }
    function deleteFile(itemRef) {
      if (confirm(`Are you sure you want to delete ${itemRef.name}?`)) {
        itemRef.delete().then(() => {
          listFiles();
        }).catch(error => {
          alert(`Error deleting ${itemRef.name}: ${error.message}`);
        });
      }
    }

    /*******************************
     * FUNÇÃO: FULLSCREEN
     *******************************/
    function toggleFullScreen() {
      const appContainer = document.getElementById('app-container');
      const fileListEl = document.getElementById('fileList');
      if (!document.fullscreenElement) {
        if (appContainer.requestFullscreen) {
          appContainer.requestFullscreen();
        } else if (appContainer.mozRequestFullScreen) {
          appContainer.mozRequestFullScreen();
        } else if (appContainer.webkitRequestFullscreen) {
          appContainer.webkitRequestFullscreen();
        } else if (appContainer.msRequestFullscreen) {
          appContainer.msRequestFullscreen();
        }
        appContainer.classList.add('fullscreen');
        fileListEl.classList.add('hide-file-list');
        document.getElementById('fullscreenButton').textContent = 'Exit Full Screen';
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
        appContainer.classList.remove('fullscreen');
        fileListEl.classList.remove('hide-file-list');
        document.getElementById('fullscreenButton').textContent = 'Full Screen';
      }
    }

    /*******************************
     * FUNÇÃO: REDIRECIONAR PARA A HOME
     *******************************/
    function goToHomePage() {
      window.location.href = 'https://wilsonf1996.github.io/index.html/';
      alert('Redirecting to Homepage.');
    }

    /*******************************
     * INICIALIZAÇÃO
     *******************************/
    // Ao carregar a página, lista os arquivos/pastas do currentPath (raiz inicialmente)
    listFiles();
  </script>
</body>
</html>


